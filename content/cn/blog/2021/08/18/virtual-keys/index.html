<!doctype html>
<html lang="cn" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/cn/blog/rss.xml" title="Apache Hudi! Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cn/blog/atom.xml" title="Apache Hudi! Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi!" href="/cn/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css"><title data-react-helmet="true">Adding support for Virtual Keys in Hudi | Apache Hudi!</title><meta data-react-helmet="true" property="og:title" content="Adding support for Virtual Keys in Hudi | Apache Hudi!"><meta data-react-helmet="true" name="description" content="Apache Hudi helps you build and manage data lakes with different table types, config knobs to cater to everyone&#x27;s need."><meta data-react-helmet="true" property="og:description" content="Apache Hudi helps you build and manage data lakes with different table types, config knobs to cater to everyone&#x27;s need."><meta data-react-helmet="true" property="og:url" content="https://hudi.apache.org/cn/blog/2021/08/18/virtual-keys"><meta data-react-helmet="true" name="docsearch:language" content="cn"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/cn/assets/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hudi.apache.org/cn/blog/2021/08/18/virtual-keys"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2021/08/18/virtual-keys" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/cn/blog/2021/08/18/virtual-keys" hreflang="cn"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2021/08/18/virtual-keys" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/cn/assets/css/styles.067d5900.css">
<link rel="preload" href="/cn/assets/js/runtime~main.b9689b19.js" as="script">
<link rel="preload" href="/cn/assets/js/main.d0765f1c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">⭐️ If you like Apache Hudi, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi">GitHub</a>! ⭐</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">×</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cn/"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/cn/docs/quick-start-guide">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Learn</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cn/blog">Blog</a></li><li><a class="dropdown__link" href="/cn/talks-articles">Talks &amp; Articles</a></li><li><a class="dropdown__link" href="/cn/learn/faq">FAQ</a></li><li><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Technical Wiki<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/contribute/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/cn/contribute/team">Team</a></li><li><a class="dropdown__link" href="/cn/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/cn/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/cn/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/cn/contribute/report-security-issues">Report Security Issues</a></li><li><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Report Issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a class="navbar__item navbar__link" href="/cn/powered-by">Who&#x27;s Using</a><a class="navbar__item navbar__link" href="/cn/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/cn/docs/overview">0.9.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/next/overview">Next</a></li><li><a class="dropdown__link" href="/cn/docs/overview">0.9.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.8.0/overview">0.8.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.7.0/overview">0.7.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.6.0/quick-start-guide">0.6.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.3/quick-start-guide">0.5.3</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.2/quick-start-guide">0.5.2</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.1/quick-start-guide">0.5.1</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Chinese</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2021/08/18/virtual-keys" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/cn/blog/2021/08/18/virtual-keys" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">Chinese</a></li></ul></div><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter-link" aria-label="Hudi Twitter Handle"></a><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Hudi Slack Channel"></a><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/cn/"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/quick-start-guide">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Learn</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/cn/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/talks-articles">Talks &amp; Articles</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/learn/faq">FAQ</a></li><li class="menu__list-item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/contribute/get-involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/contribute/team">Team</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/contribute/how-to-contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/contribute/developer-setup">Developer Setup</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/contribute/rfc-process">RFC Process</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/contribute/report-security-issues">Report Security Issues</a></li><li class="menu__list-item"><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Report Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/cn/powered-by">Who&#x27;s Using</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/releases/download">Download</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/next/overview">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/overview">0.9.0</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/0.8.0/overview">0.8.0</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/0.7.0/overview">0.7.0</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/0.6.0/quick-start-guide">0.6.0</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/0.5.3/quick-start-guide">0.5.3</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/0.5.2/quick-start-guide">0.5.2</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/0.5.1/quick-start-guide">0.5.1</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/blog/2021/08/18/virtual-keys" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/blog/2021/08/18/virtual-keys" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">Chinese</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li><li class="menu__list-item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="menu__link header-twitter-link" aria-label="Hudi Twitter Handle"></a></li><li class="menu__list-item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="menu__link header-slack-link" aria-label="Hudi Slack Channel"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/09/01/building-eb-level-data-lake-using-hudi-at-bytedance">Building an ExaByte-level Data Lake Using Apache Hudi at ByteDance</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/08/23/async-clustering">Asynchronous Clustering using Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/08/23/s3-events-source">Reliable ingestion from AWS S3 using Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/08/18/improving-marker-mechanism">Improving Marker Mechanism in Apache Hudi</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/cn/blog/2021/08/18/virtual-keys">Adding support for Virtual Keys in Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/08/16/kafka-custom-deserializer">Schema evolution with DeltaStreamer using KafkaSource</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/07/21/streaming-data-lake-platform">Apache Hudi - The Data Lake Platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/06/10/employing-right-configurations-for-hudi-cleaner">Employing correct configurations for Hudi&#x27;s cleaner table service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/03/01/hudi-file-sizing">Streaming Responsibly - How Apache Hudi maintains optimum sized files</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/cn/blog/2021/02/13/hudi-key-generators">Apache Hudi Key Generators</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="blogPostTitle_GeHD">Adding support for Virtual Keys in Hudi</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-08-18T00:00:00.000Z">August 18, 2021</time> · 5 min read</div><div class="avatar margin-vert--md"><div class="avatar__intro"><div class="avatar__name"><a>shivnarayan</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>Apache Hudi helps you build and manage data lakes with different table types, config knobs to cater to everyone&#x27;s need.
Hudi adds per record metadata fields like <code>_hoodie_record_key</code>, <code>_hoodie_partition path</code>, <code>_hoodie_commit_time</code> which serves multiple purposes.
They assist in avoiding re-computing the record key, partition path during merges, compaction and other table operations
and also assists in supporting <a href="/cn/blog/2021/07/21/streaming-data-lake-platform#readers">record-level</a> incremental queries (in comparison to other table formats, that merely track files).
In addition, it ensures data quality by ensuring unique key constraints are enforced even if the key field changes for a given table, during its lifetime.
But one of the repeated asks from the community is to leverage existing fields and not to add additional meta fields, for simple use-cases where such benefits are not desired or key changes are very rare.  </p><header><h1 class="h1Heading_27L5">Virtual Key support</h1></header><p>Hudi now supports virtual keys, where Hudi meta fields can be computed on demand from the data fields. Currently, the meta fields are
computed once and stored as per record metadata and re-used across various operations. If one does not need incremental query support,
they can start leveraging Hudi&#x27;s Virtual key support and still go about using Hudi to build and manage their data lake to reduce the storage
overhead due to per record metadata. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configurations"></a>Configurations<a class="hash-link" href="#configurations" title="Direct link to heading">#</a></h2><p>Virtual keys can be enabled for a given table using the below config. When set to <code>hoodie.populate.meta.fields=false</code>,
Hudi will use virtual keys for the corresponding table. Default value for this config is <code>true</code>, which means, all  meta fields will be added by default.</p><p>Once virtual keys are enabled, it can&#x27;t be disabled for a given hudi table, because already stored records may not have
the meta fields populated. But if you have an existing table from an older version of hudi, virtual keys can be enabled.
Another constraint w.r.t virtual key support is that, Key generator properties for a given table cannot be changed through
the course of the lifecycle of a given hudi table. In this model, the user also shares responsibility of ensuring uniqueness
of key within a table. For instance, if you configure record key to point to <code>field_5</code> for few batches of write and later switch to <code>field_10</code>,
Hudi cannot guarantee uniqueness of key, since older writes could have had duplicates for <code>field_10</code>. </p><p>With virtual keys, keys will have to be re-computed everytime when in need (merges, compaction, MOR snapshot read). Hence we
support virtual keys for all built-in key generators on Copy-On-Write tables. Supporting all key generators on Merge-On-Read table
would entail reading all fields out of base and delta logs, sacrificing core columnar query performance, which will be prohibitively expensive
for users. Thus, we support only simple key generators (the default key generator, where both record key and partition path refer
to an existing field ) for now.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supported-key-generators-with-copyonwritecow-table"></a>Supported Key Generators with CopyOnWrite(COW) table:<a class="hash-link" href="#supported-key-generators-with-copyonwritecow-table" title="Direct link to heading">#</a></h3><p>SimpleKeyGenerator, ComplexKeyGenerator, CustomKeyGenerator, TimestampBasedKeyGenerator and NonPartitionedKeyGenerator. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supported-key-generators-with-mergeonreadmor-table"></a>Supported Key Generators with MergeOnRead(MOR) table:<a class="hash-link" href="#supported-key-generators-with-mergeonreadmor-table" title="Direct link to heading">#</a></h3><p>SimpleKeyGenerator</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supported-index-types"></a>Supported Index types:<a class="hash-link" href="#supported-index-types" title="Direct link to heading">#</a></h3><p>Only &quot;SIMPLE&quot; and &quot;GLOBAL_SIMPLE&quot; index types are supported in the first cut. We plan to add support for other index
(BLOOM, etc) in future releases. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supported-operations"></a>Supported Operations<a class="hash-link" href="#supported-operations" title="Direct link to heading">#</a></h2><p>All existing features are supported for a hudi table with virtual keys, except the incremental
queries. Which means, cleaning, archiving, metadata table, clustering, etc can be enabled for a hudi table with
virtual keys enabled. So, you are able to merely use Hudi as a transactional table format with all the awesome
table service runtimes and platform services, if you wish to do so, without incurring any overheads associated with
support for incremental data processing.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sample-output"></a>Sample Output<a class="hash-link" href="#sample-output" title="Direct link to heading">#</a></h2><p>As called out earlier, one has to set <code>hoodie.populate.meta.fields=false</code> to enable virtual keys. Let&#x27;s see the
difference between records of a hudi table with and without virtual keys.</p><p>Here are some sample records for a regular hudi table (virtual keys disabled)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+--------------------------------------+--------------------------------------+---------+---------+-------------------+</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_hoodie_commit_time |           _hoodie_record_key         |        _hoodie_partition_path        |  rider  | driver  |        fare       |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+--------------------------------------+--------------------------------------+---------+---------+-------------------+</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | eb7819f1-6f04-429d-8371-df77620b9527 | americas/united_states/san_francisco |rider-284|driver-284|98.3428192817987  |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 37ea44f1-fda7-4ec4-84de-f43f5b5a4d84 | americas/united_states/san_francisco |rider-213|driver-213|19.179139106643607|</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | aa601d6b-7cc5-4b82-9687-675d0081616e | americas/united_states/san_francisco |rider-213|driver-213|93.56018115236618 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 494bc080-881c-48be-8f8a-8f1739781816 | americas/united_states/san_francisco |rider-284|driver-284|90.9053809533154  |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 09573277-e1c1-4cdd-9b45-57176f184d4d | americas/united_states/san_francisco |rider-284|driver-284|49.527694252432056|</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | c9b055ed-cd28-4397-9704-93da8b2e601f | americas/brazil/sao_paulo            |rider-213|driver-213|43.4923811219014  |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | e707355a-b8c0-432d-a80f-723b93dc13a8 | americas/brazil/sao_paulo            |rider-284|driver-284|63.72504913279929 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | d3c39c9e-d128-497a-bf3e-368882f45c28 | americas/brazil/sao_paulo            |rider-284|driver-284|91.99515909032544 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 159441b0-545b-460a-b671-7cc2d509f47b | asia/india/chennai                   |rider-284|driver-284|9.384124531808036 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 16031faf-ad8d-4968-90ff-16cead211d3c | asia/india/chennai                   |rider-284|driver-284|90.25710109008239 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+--------------------------------------+--------------------------------------+---------+----------+------------------+</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And here are some sample records for a hudi table with virtual keys enabled.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+------------------------+-------------------------+---------+---------+-------------------+</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_hoodie_commit_time |    _hoodie_record_key  |  _hoodie_partition_path |  rider  | driver  |        fare       |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+------------------------+-------------------------+---------+---------+-------------------+</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|98.3428192817987  |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-213|driver-213|19.179139106643607|</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-213|driver-213|93.56018115236618 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|90.9053809533154  |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|49.527694252432056|</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-213|driver-213|43.4923811219014  |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|63.72504913279929 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|91.99515909032544 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|9.384124531808036 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|90.25710109008239 |</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+------------------------+-------------------------+---------+----------+------------------+</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>As you could see, all meta fields are null in storage, but all users fields remain intact similar to a regular table.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="incremental-queries"></a>Incremental Queries<a class="hash-link" href="#incremental-queries" title="Direct link to heading">#</a></h2><p>Since hudi does not maintain any metadata (like commit time at a record level) for a table with virtual keys enabled,<br>
incremental queries are not supported. An exception will be thrown as below when an incremental query is triggered for such
a table.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">scala&gt; val tripsIncrementalDF = spark.read.format(&quot;hudi&quot;).</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     |   option(QUERY_TYPE_OPT_KEY, QUERY_TYPE_INCREMENTAL_OPT_VAL).</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     |   option(BEGIN_INSTANTTIME_OPT_KEY, &quot;20210827180901&quot;).load(basePath)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">org.apache.hudi.exception.HoodieException: Incremental queries are not supported when meta fields are disabled</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.hudi.IncrementalRelation.&lt;init&gt;(IncrementalRelation.scala:69)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.hudi.DefaultSource.createRelation(DefaultSource.scala:120)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.hudi.DefaultSource.createRelation(DefaultSource.scala:67)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:344)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:297)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:286)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at scala.Option.getOrElse(Option.scala:189)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:286)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:232)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ... 61 elided</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>Hope this blog was useful for you to learn yet another feature in Apache Hudi. If you are interested in
Hudi and looking to contribute, do check out <a href="https://hudi.apache.org/contribute/get-involved" target="_blank" rel="noopener noreferrer">here</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cn/blog/2021/08/18/improving-marker-mechanism"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Improving Marker Mechanism in Apache Hudi</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cn/blog/2021/08/16/kafka-custom-deserializer"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Schema evolution with DeltaStreamer using KafkaSource »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configurations" class="table-of-contents__link">Configurations</a><ul><li><a href="#supported-key-generators-with-copyonwritecow-table" class="table-of-contents__link">Supported Key Generators with CopyOnWrite(COW) table:</a></li><li><a href="#supported-key-generators-with-mergeonreadmor-table" class="table-of-contents__link">Supported Key Generators with MergeOnRead(MOR) table:</a></li><li><a href="#supported-index-types" class="table-of-contents__link">Supported Index types:</a></li></ul></li><li><a href="#supported-operations" class="table-of-contents__link">Supported Operations</a></li><li><a href="#sample-output" class="table-of-contents__link">Sample Output</a></li><li><a href="#incremental-queries" class="table-of-contents__link">Incremental Queries</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cn/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/contribute/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/releases/release-0.9.0">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/powered-by">Who&#x27;s Using</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cn/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/docker_demo">Docker Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/talks-articles">Talks &amp; Articles</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/learn/faq">FAQ</a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cn/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/ibm_cos_hoodie">IBM Cloud</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cn/contribute/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="col footer__col"><div class="footer__title">Apache</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://hudi.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/cn/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/cn/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>.
      Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation. <a href="/docs/privacy">Privacy Policy</a></div></div></div></footer></div>
<script src="/cn/assets/js/runtime~main.b9689b19.js"></script>
<script src="/cn/assets/js/main.d0765f1c.js"></script>
</body>
</html>