<!doctype html>
<html lang="cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.0.0 docs-doc-page docs-doc-id-flink-quick-start-guide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Flink 指南 | Apache Hudi</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hudi.apache.org/cn/docs/1.0.0/flink-quick-start-guide"><meta data-rh="true" property="og:locale" content="cn"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" name="keywords" content="apache hudi, data lake, lakehouse, big data, apache spark, apache flink, presto, trino, analytics, data engineering"><meta data-rh="true" name="docusaurus_version" content="1.0.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.0.0"><meta data-rh="true" name="docsearch:version" content="1.0.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.0.0"><meta data-rh="true" property="og:title" content="Flink 指南 | Apache Hudi"><meta data-rh="true" name="description" content="本指南提供了使用 Flink SQL 操作 Hudi 的文档。阅读本指南，您可以学习如何快速开始使用 Flink 读写 Hudi，同时对配置和任务优化有更深入的了解："><meta data-rh="true" property="og:description" content="本指南提供了使用 Flink SQL 操作 Hudi 的文档。阅读本指南，您可以学习如何快速开始使用 Flink 读写 Hudi，同时对配置和任务优化有更深入的了解："><link data-rh="true" rel="icon" href="/cn/assets/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://hudi.apache.org/cn/docs/1.0.0/flink-quick-start-guide"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/docs/1.0.0/flink-quick-start-guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/cn/docs/1.0.0/flink-quick-start-guide" hreflang="cn"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/docs/1.0.0/flink-quick-start-guide" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Flink 指南","item":"https://hudi.apache.org/cn/docs/1.0.0/flink-quick-start-guide"}]}</script><link rel="alternate" type="application/rss+xml" href="/cn/blog/rss.xml" title="Apache Hudi: User-Facing Analytics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cn/blog/atom.xml" title="Apache Hudi: User-Facing Analytics Atom Feed">
<link rel="alternate" type="application/json" href="/cn/blog/feed.json" title="Apache Hudi: User-Facing Analytics JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi" href="/cn/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/cn/videos/rss.xml" title="Apache Hudi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cn/videos/atom.xml" title="Apache Hudi Atom Feed">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css"><link rel="stylesheet" href="/cn/assets/css/styles.d44ac021.css">
<script src="/cn/assets/js/runtime~main.d22e7002.js" defer="defer"></script>
<script src="/cn/assets/js/main.2c515629.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" role="banner"><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like <b>Apache Hudi</b>, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi"><b>GitHub!<svg xmlns="http://www.w3.org/2000/svg\" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 -2 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></b></a> ⭐</div></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarWrapper_j_uY"><div class="navbar__inner navbarInnerStyle_KoMw"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cn/"><div class="navbar__logo navbarLogo_aghy"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/cn/docs/overview">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/learn/tutorial-series">Tutorial Series</a></li><li><a class="dropdown__link" href="/cn/talks">Talks</a></li><li><a class="dropdown__link" href="/cn/videos">Video Guides</a></li><li><a class="dropdown__link" href="/cn/docs/faq">FAQ</a></li><li><a class="dropdown__link" href="/cn/tech-specs">Tech Specs</a></li><li><a class="dropdown__link" href="/cn/tech-specs-1point0">Tech Specs 1.0</a></li><li><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="dropdown__link">Technical Wiki<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/contribute/developer-sync-call">Developer Sync Call</a></li><li><a class="dropdown__link" href="/cn/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/cn/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/cn/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/cn/contribute/report-security-issues">Report Security Issues</a></li><li><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="dropdown__link">Report Issues<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/community/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/cn/community/syncs">Community Syncs</a></li><li><a class="dropdown__link" href="/cn/community/office_hours">Office Hours</a></li><li><a class="dropdown__link" href="/cn/community/team">Team</a></li><li><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="dropdown__link">Join Our Slack Space<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><a class="navbar__item navbar__link" href="/cn/ecosystem">Ecosystem</a><a class="navbar__item navbar__link" href="/cn/blog">Blog</a><a class="navbar__item navbar__link" href="/cn/powered-by">Who&#x27;s Using</a><a class="navbar__item navbar__link" href="/cn/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/cn/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/cn/docs/1.0.0/flink-quick-start-guide">1.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/next/flink-quick-start-guide">Next</a></li><li><a class="dropdown__link" href="/cn/docs/flink-quick-start-guide">1.0.2</a></li><li><a class="dropdown__link" href="/cn/docs/1.0.1/flink-quick-start-guide">1.0.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cn/docs/1.0.0/flink-quick-start-guide">1.0.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.15.0/flink-quick-start-guide">0.15.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.14.1/flink-quick-start-guide">0.14.1</a></li><li><a class="dropdown__link" href="/cn/docs/0.14.0/flink-quick-start-guide">0.14.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.13.1/flink-quick-start-guide">0.13.1</a></li><li><a class="dropdown__link" href="/cn/docs/0.13.0/flink-quick-start-guide">0.13.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.12.3/flink-quick-start-guide">0.12.3</a></li><li><a class="dropdown__link" href="/cn/docs/0.12.2/flink-quick-start-guide">0.12.2</a></li><li><a class="dropdown__link" href="/cn/docs/0.12.1/flink-quick-start-guide">0.12.1</a></li><li><a class="dropdown__link" href="/cn/docs/0.12.0/flink-quick-start-guide">0.12.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.11.1/flink-quick-start-guide">0.11.1</a></li><li><a class="dropdown__link" href="/cn/docs/0.11.0/flink-quick-start-guide">0.11.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.10.1/flink-quick-start-guide">0.10.1</a></li><li><a class="dropdown__link" href="/cn/docs/0.10.0/flink-quick-start-guide">0.10.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.9.0/flink-quick-start-guide">0.9.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.8.0/flink-quick-start-guide">0.8.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.7.0/overview">0.7.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.6.0/quick-start-guide">0.6.0</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.3/quick-start-guide">0.5.3</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.2/quick-start-guide">0.5.2</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.1/quick-start-guide">0.5.1</a></li><li><a class="dropdown__link" href="/cn/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link locale-dropdown-wrapper"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Chinese<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 14 14" class="globeIcon_RxQM"><g clip-path="url(#a)"><path fill="#1C1E21" d="M14 6.457a6.84 6.84 0 0 0-7-6.02 6.843 6.843 0 0 0-7 6.02v1.085a6.843 6.843 0 0 0 7 6.02 6.843 6.843 0 0 0 7-6.02zm-1.094 0h-2.625a10 10 0 0 0-.376-2.222 6.7 6.7 0 0 0 1.531-.875 5.25 5.25 0 0 1 1.444 3.097zm-8.032 0a8.5 8.5 0 0 1 .324-1.872 7.4 7.4 0 0 0 3.63 0c.175.61.284 1.239.325 1.872zm4.305 1.085a8.4 8.4 0 0 1-.324 1.873 7.46 7.46 0 0 0-3.658 0 8.5 8.5 0 0 1-.323-1.873zm.35-4.375A10.3 10.3 0 0 0 8.75 1.75c.627.194 1.218.49 1.75.875a5.8 5.8 0 0 1-.998.577zM7.254 1.54A8.8 8.8 0 0 1 8.46 3.552c-.48.11-.97.165-1.461.167-.492-.001-.982-.057-1.461-.167.308-.722.715-1.4 1.207-2.012zM4.498 3.202a5.8 5.8 0 0 1-.998-.577 6 6 0 0 1 1.75-.875c-.294.46-.546.947-.753 1.452m-1.873.15c.47.358.984.652 1.531.874A9.6 9.6 0 0 0 3.78 6.45H1.155a5.25 5.25 0 0 1 1.47-3.098M1.12 7.541h2.625c.038.753.164 1.5.376 2.223a6.7 6.7 0 0 0-1.531.875 5.25 5.25 0 0 1-1.47-3.098m3.377 3.255q.311.76.753 1.453a6 6 0 0 1-1.75-.875q.47-.34.997-.578m2.25 1.663a8.6 8.6 0 0 1-1.208-2.013 6.5 6.5 0 0 1 2.922 0 8.5 8.5 0 0 1-1.207 2.013zm2.755-1.663q.552.235 1.042.578a6.3 6.3 0 0 1-1.75.875q.413-.697.708-1.453m1.873-.148a6.7 6.7 0 0 0-1.531-.875 9.5 9.5 0 0 0 .376-2.223h2.625a5.25 5.25 0 0 1-1.47 3.098"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h14v14H0z"></path></clipPath></defs></svg></a><ul class="dropdown__menu"><li><a href="/docs/1.0.0/flink-quick-start-guide" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/cn/docs/1.0.0/flink-quick-start-guide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="cn">Chinese</a></li></ul></div><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter-link" aria-label="Hudi Twitter Handle"></a><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Hudi Slack Channel"></a><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-youtube-link" aria-label="Hudi YouTube Channel"></a><a href="https://www.linkedin.com/company/apache-hudi/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-linkedin-link" aria-label="Hudi Linkedin Page"></a><div class="navbarSearchContainer_Bca1"><div><div role="button" class="searchButton_o6KI" aria-label="Search"><span class="searchText_sHOJ">Search</span><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 14 14"><circle cx="6.864" cy="6.864" r="5.243" stroke="#1C1E21" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></circle><path stroke="#1C1E21" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m10.51 10.783 2.056 2.05"></path></svg></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar navbarSideMenu_TODO"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/cn/"><div class="navbar__logo navbarLogo_aghy"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cn/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><button type="button" aria-label="Close navigation bar" class="clean-btn navbar-sidebar__close"><svg viewBox="0 0 15 15" width="21" height="21"><g stroke="var(--ifm-color-emphasis-600)" stroke-width="1.2"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><div class="navbar-sidebar__items"><div class="navbar-sidebar__item menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/cn/docs/overview">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Learn</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Contribute</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Community</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/cn/ecosystem">Ecosystem</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/cn/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/cn/powered-by">Who&#x27;s Using</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/cn/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/cn/releases/download">Download</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Versions</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret locale-dropdown-wrapper"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Languages<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 14 14" class="globeIcon_RxQM"><g clip-path="url(#a)"><path fill="#1C1E21" d="M14 6.457a6.84 6.84 0 0 0-7-6.02 6.843 6.843 0 0 0-7 6.02v1.085a6.843 6.843 0 0 0 7 6.02 6.843 6.843 0 0 0 7-6.02zm-1.094 0h-2.625a10 10 0 0 0-.376-2.222 6.7 6.7 0 0 0 1.531-.875 5.25 5.25 0 0 1 1.444 3.097zm-8.032 0a8.5 8.5 0 0 1 .324-1.872 7.4 7.4 0 0 0 3.63 0c.175.61.284 1.239.325 1.872zm4.305 1.085a8.4 8.4 0 0 1-.324 1.873 7.46 7.46 0 0 0-3.658 0 8.5 8.5 0 0 1-.323-1.873zm.35-4.375A10.3 10.3 0 0 0 8.75 1.75c.627.194 1.218.49 1.75.875a5.8 5.8 0 0 1-.998.577zM7.254 1.54A8.8 8.8 0 0 1 8.46 3.552c-.48.11-.97.165-1.461.167-.492-.001-.982-.057-1.461-.167.308-.722.715-1.4 1.207-2.012zM4.498 3.202a5.8 5.8 0 0 1-.998-.577 6 6 0 0 1 1.75-.875c-.294.46-.546.947-.753 1.452m-1.873.15c.47.358.984.652 1.531.874A9.6 9.6 0 0 0 3.78 6.45H1.155a5.25 5.25 0 0 1 1.47-3.098M1.12 7.541h2.625c.038.753.164 1.5.376 2.223a6.7 6.7 0 0 0-1.531.875 5.25 5.25 0 0 1-1.47-3.098m3.377 3.255q.311.76.753 1.453a6 6 0 0 1-1.75-.875q.47-.34.997-.578m2.25 1.663a8.6 8.6 0 0 1-1.208-2.013 6.5 6.5 0 0 1 2.922 0 8.5 8.5 0 0 1-1.207 2.013zm2.755-1.663q.552.235 1.042.578a6.3 6.3 0 0 1-1.75.875q.413-.697.708-1.453m1.873-.148a6.7 6.7 0 0 0-1.531-.875 9.5 9.5 0 0 0 .376-2.223h2.625a5.25 5.25 0 0 1-1.47 3.098"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h14v14H0z"></path></clipPath></defs></svg></a></li><li class="menu__list-item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li><li class="menu__list-item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="menu__link header-twitter-link" aria-label="Hudi Twitter Handle"></a></li><li class="menu__list-item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="menu__link header-slack-link" aria-label="Hudi Slack Channel"></a></li><li class="menu__list-item"><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="menu__link header-youtube-link" aria-label="Hudi YouTube Channel"></a></li><li class="menu__list-item"><a href="https://www.linkedin.com/company/apache-hudi/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="menu__link header-linkedin-link" aria-label="Hudi Linkedin Page"></a></li></ul></div><div class="navbar-sidebar__item menu"><button type="button" class="clean-btn navbar-sidebar__back">← Back to main menu</button></div></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_bSxm"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_cWv0"><aside class="theme-doc-sidebar-container docSidebarContainer_RSuS"><div class="sidebarViewport_pYEE"><div class="sidebar_njMd"><nav aria-label="Sidebar navigation" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/cn/docs/1.0.0/overview">Getting Started</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/1.0.0/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/1.0.0/quick-start-guide">Spark Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cn/docs/1.0.0/flink-quick-start-guide">Flink 指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/1.0.0/python-rust-quick-start-guide">Python/Rust Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/1.0.0/docker_demo">Docker Demo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cn/docs/1.0.0/use_cases">使用案例</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/hudi_stack">Design &amp; Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/hoodie_streaming_ingestion">Ingestion</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/sql_ddl">Writing Tables</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/sql_queries">Reading Tables</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/cleaning">Table Services</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/snapshot_exporter">Platform &amp; Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/performance">Operating Hudi</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/basic_configurations">Configurations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cn/docs/1.0.0/faq">Frequently Asked Questions(FAQs)</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cn/docs/1.0.0/privacy">隐私协议</a></li></ul></nav></div></div></aside><main class="docMainContainer_hjYf"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Apache Hudi<!-- --> <b>1.0.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For documentation on the latest release, see the <b><a href="/cn/docs/flink-quick-start-guide">latest version</a></b> (<!-- -->1.0.2<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Flink 指南</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.0.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Flink 指南</h1></header><p>本指南提供了使用 Flink SQL 操作 Hudi 的文档。阅读本指南，您可以学习如何快速开始使用 Flink 读写 Hudi，同时对配置和任务优化有更深入的了解：</p>
<ul>
<li><strong>快速开始</strong> ：通过阅读 <a href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">快速开始</a>，你可以快速开始使用 Flink sql client 去读写 Hudi</li>
<li><strong>配置</strong> ：对于 <a href="#flink-%E9%85%8D%E7%BD%AE">Flink 配置</a>，使用 <code>$FLINK_HOME/conf/flink-conf.yaml</code> 来配置。 对于任意一个作业的配置，通过<a href="#%E8%A1%A8%E5%8F%82%E6%95%B0">表参数</a>来设置</li>
<li><strong>写功能</strong> ：Flink 支持多种写功能用例，例如 <a href="#%E7%A6%BB%E7%BA%BF%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5">离线批量导入</a>，<a href="#%E5%85%A8%E9%87%8F%E6%8E%A5%E5%A2%9E%E9%87%8F">全量接增量</a>，<a href="#changelog-%E6%A8%A1%E5%BC%8F">Changelog 模式</a>，<a href="#insert-%E6%A8%A1%E5%BC%8F">Insert 模式</a> 和 <a href="#%E7%A6%BB%E7%BA%BF-compaction">离线 Compaction</a></li>
<li><strong>查询功能</strong> ：Flink 支持多种查询功能用例，例如 <a href="#hive-%E6%9F%A5%E8%AF%A2">Hive 查询</a>， <a href="#presto-%E6%9F%A5%E8%AF%A2">Presto 查询</a></li>
<li><strong>优化</strong> ：针对 Flink 读写 Hudi 的操作，本指南提供了一些优化建议，例如 <a href="#%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96">内存优化</a> 和 <a href="#%E5%86%99%E5%85%A5%E9%99%90%E6%B5%81">写入限流</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="快速开始">快速开始<a href="#快速开始" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a href="#安装" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>我们推荐使用 <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.13/docs/dev/table/sqlclient/" target="_blank" rel="noopener noreferrer">Flink Sql Client</a> 来读写 Hudi，因为 Flink
sql client 对于 SQL 用户来说更容易上手。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="步骤1-下载-flink-jar">步骤1 下载 Flink jar<a href="#步骤1-下载-flink-jar" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>我们推荐使用 Flink-1.12.x 来读写 Hudi。 你可以按照 <a href="https://flink.apache.org/downloads" target="_blank" rel="noopener noreferrer">Flink 安装文档</a> 的指导来安装 Flink。 <code>hudi-flink-bundle.jar</code>
使用的是 scala 2.11，所以我们推荐 Flink-1.12.x 配合 scala 2.11 来使用。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="步骤2-启动-flink-集群">步骤2 启动 Flink 集群<a href="#步骤2-启动-flink-集群" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>在 Hadoop 环境下启动 standalone 的 Flink 集群。
在你启动 Flink 集群前，我们推荐先配置如下参数：</p>
<ul>
<li>在 <code>$FLINK_HOME/conf/flink-conf.yaml</code> 中添加配置：<code>taskmanager.numberOfTaskSlots: 4</code></li>
<li>在 <code>$FLINK_HOME/conf/flink-conf.yaml</code> 中，根据数据量大小和集群大小来添加其他的 <a href="#flink-%E9%85%8D%E7%BD%AE">Flink 配置</a></li>
<li>在 <code>$FLINK_HOME/conf/workers</code> 中添加4核 <code>localhost</code> 来保证我们本地集群中有4个 workers</li>
</ul>
<p>启动集群：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># HADOOP_HOME 是 Hadoop 的根目录。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export HADOOP_CLASSPATH=`$HADOOP_HOME/bin/hadoop classpath`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 启动 Flink standalone 集群</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/start-cluster.sh</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="步骤3-启动-flink-sql-client">步骤3 启动 Flink SQL client<a href="#步骤3-启动-flink-sql-client" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h4>
<p>Hudi 将 Flink 板块单独打包为 <code>hudi-flink-bundle.jar</code>，该 Jar 包需要在启动的时候加载。
你可以在 <code>hudi-source-dir/packaging/hudi-flink-bundle</code> 下手动的打包这个 Jar 包，或者从 <a href="https://repo.maven.apache.org/maven2/org/apache/hudi/hudi-flink-bundle_2.11/" target="_blank" rel="noopener noreferrer">Apache Official Repository</a>
中下载。</p>
<p>启动 Flink SQL Client：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># HADOOP_HOME 是 Hadoop 的根目录。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export HADOOP_CLASSPATH=`$HADOOP_HOME/bin/hadoop classpath`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/sql-client.sh embedded -j .../hudi-flink-bundle_2.1?-*.*.*.jar shell</span><br></span></code></pre></div></div>
<div class="notice--info"><h4>小提示：</h4><ul><li>为了兼容大部分的对象存储，我们推荐使用 Hadoop 2.9 x+的 Hadoop 版本</li><li>flink-parquet 和 flink-avro 格式已经打包在 hudi-flink-bundle.jar 中了</li></ul></div>
<p>根据下面的不同功能来设置表名，存储路径和操作类型。
Flink SQL Client 是逐行执行 SQL 的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="插入数据">插入数据<a href="#插入数据" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>先创建一个 Flink Hudi 表，然后在通过下面的 <code>VALUES</code> 语句往该表中插入数据。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- 为了更直观的显示结果，推荐把 CLI 的输出结果模式设置为 tableau。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">set</span><span class="token plain"> execution</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">result</span><span class="token operator">-</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mode</span><span class="token operator">=</span><span class="token plain">tableau</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uuid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  age </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PARTITIONED </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hudi&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;path&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;schema://base-path&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;table.type&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MERGE_ON_READ&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- 创建一个 MERGE_ON_READ类型的表，默认是 COPY_ON_ERITE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- 使用 values 语句插入数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INTO</span><span class="token plain"> t1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Danny&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">23</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Stephen&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">33</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:02&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id3&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Julian&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">53</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:03&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id4&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Fabian&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">31</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:04&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par2&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id5&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Sophia&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">18</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:05&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par3&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id6&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Emma&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:06&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par3&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id7&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Bob&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">44</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:07&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par4&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id8&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Han&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">56</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:08&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par4&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询数据">查询数据<a href="#查询数据" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- 从 Hudi 表中查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>该查询语句提供的是 快照读（Snapshot Querying）。
如果想了解更多关于表类型和查询类型的介绍，可以参考文档 <a href="/cn/docs/concepts#table-types--queries">表类型和查询类型</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="更新数据">更新数据<a href="#更新数据" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>数据的更新和插入数据类似：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- 这条语句会更新 key 为 &#x27;id1&#x27; 的记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">into</span><span class="token plain"> t1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;id1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Danny&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">27</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;1970-01-01 00:00:01&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;par1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>需要注意的是：现在使用的存储类型为 <code>Append</code>。通常我们都是使用 apennd 模式，除非你是第一次创建这个表。 再次 <a href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE">查询数据</a> 就会显示更新后的结果。
每一次的插入操作都会在时间轴上生成一个带时间戳的新的 <a href="/cn/docs/concepts">commit</a>，在元数据字段 <code>_hoodie_commit_time</code> 和同一 <code>_hoodie_record_key</code> 的 <code>age</code>字段中查看更新。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="流式查询">流式查询<a href="#流式查询" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Hudi Flink 也有能力来查询从指定时间戳开始的流式记录集合。 该功能可以使用Hudi的流式查询，只需要提供一个查询开始的时间戳就可以完成查询。如果我们需要的
是指定时间戳后的所有数据，我们就不需要指定结束时间。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uuid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  age </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PARTITIONED </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hudi&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;path&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;oss://vvr-daily/hudi/t1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;table.type&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;MERGE_ON_READ&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;read.streaming.enabled&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;true&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">-- 该参数开启流式查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;read.streaming.start-commit&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;20210316134557&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- 指定开始的时间戳</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;read.streaming.check-interval&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;4&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- 指定检查新的commit的周期，默认是60秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- 开启流式的查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>上述的查询会查询出 <code>read.streaming.start-commit</code> 时间戳后的所有数据。该功能的特殊在于可以同时在流和批的 pipeline 上执行。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deletes">删除数据<a href="#deletes" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>在 <a href="#%E6%B5%81%E5%BC%8F%E6%9F%A5%E8%AF%A2">流式查询</a> 中使用数据时，Hudi Flink 源还可以接受来自底层数据源的更改日志，然后可以按行级别应用更新和删除。所以，你可以在 Hudi 上同步各种 RDBMS 的近实时快照。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="flink-配置">Flink 配置<a href="#flink-配置" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>在使用 Flink 前，你需要在 <code>$FLINK_HOME/conf/flink-conf.yaml</code> 中设置一些全局的 Flink 配置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="并行度">并行度<a href="#并行度" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>默认值</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><code>taskmanager.numberOfTaskSlots</code></td><td><code>1</code></td><td><code>Integer</code></td><td>单个 TaskManager 可以运行的并行 task 数。我们建议将该值设置为 &gt; 4，实际值需根据数据量进行设置</td></tr><tr><td><code>parallelism.default</code></td><td><code>1</code></td><td><code>Integer</code></td><td>当用户为指定算子并行度时，会使用这个并行度（默认值是1）。例如 <a href="#%E5%B9%B6%E8%A1%8C%E5%BA%A6-1"><code>write.bucket_assign.tasks</code></a> 没有设置，就会使用这个默认值</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="内存">内存<a href="#内存" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>默认值</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><code>jobmanager.memory.process.size</code></td><td><code>(none)</code></td><td><code>MemorySize</code></td><td>JobManager 的总进程内存大小。代表 JobManager JVM 进程消耗的所有内存，包括总的 Flink 内存、JVM 元空间和 JVM 开销</td></tr><tr><td><code>taskmanager.memory.task.heap.size</code></td><td><code>(none)</code></td><td><code>MemorySize</code></td><td>TaskExecutor 的堆内存大小。这是为写缓存保留的 JVM 堆内存大小</td></tr><tr><td><code>taskmanager.memory.managed.size</code></td><td><code>(none)</code></td><td><code>MemorySize</code></td><td>这是内存管理器管理的堆外内存的大小，用于排序和 RocksDB 状态后端。如果选择 RocksDB 作为状态后端，则需要设置此内存</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="checkpoint">Checkpoint<a href="#checkpoint" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>默认值</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><code>execution.checkpointing.interval</code></td><td><code>(none)</code></td><td><code>Duration</code></td><td>设置该值的方式为 <code>execution.checkpointing.interval = 150000ms</code>，其中150000ms = 2.5min。 设置这个参数等同于开启了 Checkpoint</td></tr><tr><td><code>state.backend</code></td><td><code>(none)</code></td><td><code>String</code></td><td>保存状态信息的状态后端。 我们推荐设置状态后端为 <code>rocksdb</code> ：<code>state.backend: rocksdb</code></td></tr><tr><td><code>state.backend.rocksdb.localdir</code></td><td><code>(none)</code></td><td><code>String</code></td><td>RocksDB 存储状态信息的路径</td></tr><tr><td><code>state.checkpoints.dir</code></td><td><code>(none)</code></td><td><code>String</code></td><td>Checkpoint 的默认路径，用于在支持 Flink 的文件系统中存储检查点的数据文件和元数据。存储路径必须可从所有参与进程/节点（即所有 TaskManager 和 JobManager）访问，如 HDFS 和 OSS 路径</td></tr><tr><td><code>state.backend.incremental</code></td><td><code>false</code></td><td><code>Boolean</code></td><td>选项状态后端是否创建增量检查点。对于增量检查点，只存储与前一个检查点的差异，而不是完整的检查点状态。如果存储状态设置为 <code>rocksdb</code>，建议打开这个选项</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="表参数">表参数<a href="#表参数" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>对于单个作业的配置，我们可以在 Flink SQL 语句的 <a href="#%E8%A1%A8%E5%8F%82%E6%95%B0"><code>WITH</code></a>中设置。
所以，作业级别的配置如下：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="内存-1">内存<a href="#内存-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>我们在内存调优的时候需要先关注 TaskManager 的数量和 <a href="#%E5%86%85%E5%AD%98">内存</a> 配置，以及 write task 的并发（<code>write.tasks: 4</code> 的值），确认每个 write task 能够分配到足够的内存，
再考虑以下相关的内存参数设置。</p></div></div>
<table><thead><tr><th>名称</th><th>说明</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>write.task.max.size</code></td><td>一个 write task 的最大可用内存。 默认为 <code>1024MB</code></td><td><code>1024D</code></td><td>当前预留给 write buffer 的内存为 <code>write.task.max.size</code> - <code>compaction.max_memory</code>。 当 write task 的内存 buffer 达到该阈值后会将内存里最大的 buffer flush</td></tr><tr><td><code>write.batch.size</code></td><td>Flink 的 write task 为了提高写数据效率，会按照写 bucket 提前缓存数据，每个 bucket 的数据在内存达到阈值之前会一直缓存在内存中，当阈值达到会把数据 buffer 传递给 Hudi 的 writer 执行写操作。默认为 <code>64MB</code></td><td><code>64D</code></td><td>推荐使用默认值</td></tr><tr><td><code>write.log_block.size</code></td><td>Hudi 的 log writer 在收到 write task 的数据后不会马上 flush 数据，writer 是以 LogBlock 为单位往磁盘刷数据的，在 LogBlock 攒够之前 records 会以序列化字  节的形式缓存在 writer 内部。默认为 <code>128MB</code></td><td><code>128</code></td><td>推荐使用默认值</td></tr><tr><td><code>write.merge.max_memory</code></td><td>当表的类型为 <code>COPY_ON_WRITE</code>，Hudi 会合并增量数据和 base file 中的数据。增量的数据会缓存在内存的 map 结构里，这个 map 是可溢写的，这个参数控制了 map 可以使用的堆内存大小。 默认为 <code>100MB</code></td><td><code>100</code></td><td>推荐使用默认值</td></tr><tr><td><code>compaction.max_memory</code></td><td>同 <code>write.merge.max_memory</code> 类似，只是发生在压缩时。默认为 <code>100MB</code></td><td><code>100</code></td><td>如果是在线 compaction，资源充足时可以开大些，比如 <code>1024MB</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="并行度-1">并行度<a href="#并行度-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>说明</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>write.tasks</code></td><td>writer 的并发，每个 writer 顺序写 <code>1</code>~<code>N</code> 个 buckets。默认为 <code>4</code></td><td><code>4</code></td><td>增加这个并发，对小文件个数没影响</td></tr><tr><td><code>write.bucket_assign.tasks</code></td><td>bucket assigner 的并发，默认使用 Flink 默认并发 <code>parallelism.default</code></td><td><a href="#%E5%B9%B6%E8%A1%8C%E5%BA%A6"><code>parallelism.default</code></a></td><td>增加并发同时增加了并发写的 bucekt 数，也就变相增加了小文件(小 bucket)数</td></tr><tr><td><code>write.index_boostrap.tasks</code></td><td>Index bootstrap 算子的并发，增加并发可以加快 bootstrap 阶段的效率，bootstrap 阶段会阻塞 Checkpoint，因此需要设置多一些的 Checkpoint 失败容忍次数。 默认使用 Flink 默认并发 <code>parallelism.default</code></td><td><a href="#%E5%B9%B6%E8%A1%8C%E5%BA%A6"><code>parallelism.default</code></a></td><td>只在 <code>index.bootsrap.enabled</code> 为 <code>true</code> 时生效</td></tr><tr><td><code>read.tasks</code></td><td>读算子的并发（batch 和 stream。默认为 <code>4</code></td><td><code>4</code></td><td></td></tr><tr><td><code>compaction.tasks</code></td><td>在线 compaction 的并发。默认为 <code>10</code></td><td><code>10</code></td><td>在线 compaction 比较耗费资源，建议使用 <a href="#%E7%A6%BB%E7%BA%BF-compaction"><code>离线 compaction</code></a></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="compaction">Compaction<a href="#compaction" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>这些参数都只服务于在线 compaction。</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>通过设置<code>compaction.async.enabled</code> = <code>false</code> 来关闭在线 compaction，但是 <code>compaction.schedule.enable</code> 仍然建议开启。之后通过<a href="#%E7%A6%BB%E7%BA%BF-compaction"><code>离线 compaction</code></a> 直接执行在线 compaction 产生的 compaction plan。</p></div></div>
<table><thead><tr><th>名称</th><th>说明</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>compaction.schedule.enabled</code></td><td>是否阶段性生成 compaction plan</td><td><code>true</code></td><td>建议开启，即使 <code>compaction.async.enabled</code> = <code>false</code></td></tr><tr><td><code>compaction.async.enabled</code></td><td>是否开启异步压缩，MOR 表时默认开启</td><td><code>true</code></td><td>通过关闭此参数来关闭 <code>在线 compaction</code></td></tr><tr><td><code>compaction.trigger.strategy</code></td><td>压缩策略</td><td><code>num_commits</code></td><td>可选择的策略有 <code>num_commits</code>：达到 <code>N</code> 个 delta commits 时触发 compaction; <code>time_elapsed</code>：距离上次 compaction 超过 <code>N</code> 秒触发 compaction ; <code>num_and_time</code>：<code>NUM_COMMITS</code> 和 <code>TIME_ELAPSED</code> 同时满足; <code>num_or_time</code>：<code>NUM_COMMITS</code> 或者 <code>TIME_ELAPSED</code> 中一个满足</td></tr><tr><td><code>compaction.delta_commits</code></td><td>默认策略，<code>5</code> 个 delta commits 触发一次压缩</td><td><code>5</code></td><td>--</td></tr><tr><td><code>compaction.delta_seconds</code></td><td>默认 <code>1</code> 小时触发一次压缩</td><td><code>3600</code></td><td>--</td></tr><tr><td><code>compaction.max_memory</code></td><td>compaction 的 hashMap 可用内存。 默认值为 <code>100MB</code></td><td><code>100</code></td><td>资源够用的话，建议调整到 <code>1024MB</code></td></tr><tr><td><code>compaction.target_io</code></td><td>每个 compaction plan 的 IO 内存上限 (读和写)。 默认值为 <code>5GB</code></td><td><code>5120</code></td><td>离线 compaction 的默认值是 <code>500GB</code></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="内存优化">内存优化<a href="#内存优化" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mor">MOR<a href="#mor" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<ol>
<li><a href="#checkpoint">把 Flink 的状态后端设置为 <code>rocksdb</code></a> (默认的 <code>in memory</code> 状态后端非常的消耗内存）</li>
<li>如果内存足够，<code>compaction.max_memory</code> 可以设置得更大些（默认为 <code>100MB</code>，可以调大到 <code>1024MB</code>）</li>
<li>关注 taskManager 分配给每个 write task 的内存，保证每个 write task 能够分配到 <code>write.task.max.size</code> 所配置的内存大小。 比如 taskManager 的内存是 <code>4GB</code>，
运行了 <code>2</code> 个 <code>StreamWriteFunction</code>，那每个 write function 能分到 <code>2GB</code>，尽量预留一些缓存。因为网络缓存，taskManager 上其他类型的 task (比如 <code>BucketAssignFunction</code>)也会消耗一些内存</li>
<li>需要关注 compaction 的内存变化。 <code>compaction.max_memory</code> 控制了每个 compaction task 读 log 时可以利用的内存大小。<code>compaction.tasks</code> 控制了 compaction task 的并发</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cow">COW<a href="#cow" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<ol>
<li><a href="#checkpoint">把 Flink 的状态后端设置为 <code>rocksdb</code></a> (默认的 <code>in memory</code> 状态后端非常的消耗内存）</li>
<li>同时调大 <code>write.task.max.size</code> 和 <code>write.merge.max_memory</code> （默认值分别是 <code>1024MB</code> 和 <code>100MB</code>，可以调整为 <code>2014MB</code> 和 <code>1024MB</code>）</li>
<li>关注 taskManager 分配给每个 write task 的内存，保证每个 write task 能够分配到 <code>write.task.max.size</code> 所配置的内存大小。 比如 taskManager 的内存是 <code>4GB</code>，
运行了 <code>2</code> 个 <code>StreamWriteFunction</code>，那每个 write function 能分到 <code>2GB</code>，尽量预留一些缓存。因为网络缓存，taskManager 上其他类型的 task （比如 <code>BucketAssignFunction</code>）也会消耗一些内存</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="离线批量导入">离线批量导入<a href="#离线批量导入" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>针对存量数据导入的需求，如果存量数据来源于其他数据源，可以使用离线批量导入功能（<code>bulk_insert</code>），快速将存量数据导入 Hudi。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>bulk_insert</code> 省去了 avro 的序列化以及数据的 merge 过程，后续也不会再有去重操作。所以，数据的唯一性需要自己来保证。</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>bulk_insert</code> 在 <code>batch execution mode</code> 模式下执行更加高效。 <code>batch execution mode</code> 模式默认会按照 partition path 排序输入消息再写入 Hudi，
避免 file handle 频繁切换导致性能下降。</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p><code>bulk_insert</code> 的 write tasks 的并发是通过参数 <code>write.tasks</code> 来指定，并发的数量会影响到小文件的数量，理论上，<code>bulk_insert</code> 的 write tasks 的并发数就是划分的 bucket 数，
当然每个 bucket 在写到文件大小上限（parquet 120 MB）的时候会回滚到新的文件句柄，所以最后：写文件数量 &gt;= <a href="#%E5%B9%B6%E8%A1%8C%E5%BA%A6"><code>write.bucket_assign.tasks</code></a>。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参数">参数<a href="#参数" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>Required</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>write.operation</code></td><td><code>true</code></td><td><code>upsert</code></td><td>开启 <code>bulk_insert</code> 功能</td></tr><tr><td><code>write.tasks</code></td><td><code>false</code></td><td><code>4</code></td><td><code>bulk_insert</code> write tasks 的并发，最后的文件数 &gt;= <a href="#%E5%B9%B6%E8%A1%8C%E5%BA%A6"><code>write.bucket_assign.tasks</code></a></td></tr><tr><td><code>write.bulk_insert.shuffle_by_partition</code></td><td><code>false</code></td><td><code>true</code></td><td>是否将数据按照 partition 字段 shuffle 后，再通过 write task 写入，开启该参数将减少小文件的数量，但是有数据倾斜的风险</td></tr><tr><td><code>write.bulk_insert.sort_by_partition</code></td><td><code>false</code></td><td><code>true</code></td><td>是否将数据线按照 partition 字段排序后，再通过 write task 写入，当一个 write task 写多个 partition时，开启可以减少小文件数量</td></tr><tr><td><code>write.sort.memory</code></td><td><code>false</code></td><td><code>128</code></td><td>sort 算子的可用 managed memory（单位 MB）。默认为 <code>128</code> MB</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="全量接增量">全量接增量<a href="#全量接增量" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>针对全量数据导入后，接增量的需求。如果已经有全量的离线 Hudi 表，需要接上实时写入，并且保证数据不重复，可以开启 全量接增量（<code>index bootstrap</code>）功能。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>如果觉得流程冗长，可以在写入全量数据的时候资源调大直接走流模式写，全量走完接新数据再将资源调小（或者开启 <a href="#%E5%86%99%E5%85%A5%E9%99%90%E6%B5%81">写入限流</a> ）。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参数-1">参数<a href="#参数-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>Required</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>index.bootstrap.enabled</code></td><td><code>true</code></td><td><code>false</code></td><td>开启 index bootstrap 索引加载后，会将已存在的 Hudi 表的数据一次性加载到 state 中</td></tr><tr><td><code>index.partition.regex</code></td><td><code>false</code></td><td><code>*</code></td><td>设置正则表达式进行分区筛选，默认为加载全部分区</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用流程">使用流程<a href="#使用流程" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<ol>
<li><code>CREATE TABLE</code> 创建和 Hudi 表对应的语句，注意 <code>table.type</code> 必须正确</li>
<li>设置 <code>index.bootstrap.enabled</code> = <code>true</code> 开启索引加载功能</li>
<li>在 <code>flink-conf.yaml</code> 中设置 Checkpoint 失败容忍 ：<code>execution.checkpointing.tolerable-failed-checkpoints = n</code>（取决于checkpoint 调度次数）</li>
<li>等待第一次 Checkpoint 完成，表示索引加载完成</li>
<li>索引加载完成后可以退出并保存 savepoint（也可以直接用 externalized checkpoint）</li>
<li>重启任务，将 <code>index.bootstrap.enable</code> 设置为 <code>false</code>，参数配置到合适的大小</li>
</ol>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ol>
<li>索引加载是阻塞式，所以在索引加载过程中 Checkpoint 无法完成</li>
<li>索引加载由数据流触发，需要确保每个 partition 都至少有1  条数据，即上游 source 有数据进来</li>
<li>索引加载为并发加载，根据数据量大小加载时间不同，可以在log中搜索 <code>finish loading the index under partition</code> 和 <code>Load record form file</code> 日志内容来观察索引加载的进度</li>
<li>第一次 Checkpoint 成功就表示索引已经加载完成，后续从 Checkpoint 恢复时无需再次加载索引</li>
</ol></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog-模式">Changelog 模式<a href="#changelog-模式" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>针对使用 Hudi 保留消息的所有变更（I / -U / U / D），之后接上 Flink 引擎的有状态计算实现全链路近实时数仓生产（增量计算）的需求，Hudi 的 MOR 表
通过行存原生支持保留消息的所有变更（format 层面的集成），通过流读 MOR 表可以消费到所有的变更记录。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参数-2">参数<a href="#参数-2" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>Required</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>changelog.enabled</code></td><td><code>false</code></td><td><code>false</code></td><td>默认是关闭状态，即 <code>UPSERT</code> 语义，所有的消息仅保证最后一条合并消息，中间的变更可能会被 merge 掉；改成 <code>true</code> 支持消费所有变更</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>批（快照）读仍然会合并所有的中间结果，不管 format 是否已存储中间状态。</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>设置 <code>changelog.enable</code> 为 <code>true</code> 后，中间的变更也只是 <code>best effort</code>：异步的压缩任务会将中间变更合并成 <code>1</code> 条，所以如果流读消费不够及时，被压缩后
只能读到最后一条记录。当然，通过调整压缩的缓存时间可以预留一定的时间缓冲给 reader，比如调整压缩的两个参数：<a href="#compaction"><code>compaction.delta_commits</code></a> and <a href="#compaction"><code>compaction.delta_seconds</code></a>。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="insert-模式">Insert 模式<a href="#insert-模式" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>当前 Hudi 对于 <code>Insert 模式</code> 默认会采用小文件策略：MOR 会追加写 avro log 文件，COW 会不断合并之前的 parquet 文件（并且增量的数据会去重），这样会导致性能下降。</p>
<p>如果想关闭文件合并，可以设置 <code>write.insert.deduplicate</code> 为 <code>false</code>。 关闭后，不会有任何的去重行为，每次 flush 都是直接写独立的 parquet（MOR 表也会直接写 parquet）。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参数-3">参数<a href="#参数-3" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>Required</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>write.insert.deduplicate</code></td><td><code>false</code></td><td><code>true</code></td><td>默认 <code>Insert 模式</code> 会去重，关闭后每次 flush 都会直接写独立的 parquet</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hive-查询">Hive 查询<a href="#hive-查询" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="打包">打包<a href="#打包" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>第一步是打包 <code>hudi-flink-bundle_2.11-0.9.0.jar</code>。 <code>hudi-flink-bundle</code> module pom.xml 默认将 Hive 相关的依赖 scope 设置为 provided，
如果想打入 Hive 的依赖，需要显示指定 Profile 为 <code>flink-bundle-shade-hive</code>。执行以下命令打入 Hive 依赖：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Maven 打包命令</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mvn install -DskipTests -Drat.skip=true -Pflink-bundle-shade-hive2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 如果是 hive3 需要使用 profile -Pflink-bundle-shade-hive3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 如果是 hive1 需要使用 profile -Pflink-bundle-shade-hive1 </span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Hive1.x 现在只能实现同步 metadata 到 Hive，而无法使用 Hive 查询，如需查询可使用 Spark 查询 Hive 外表的方法查询。</p></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>使用 -Pflink-bundle-shade-hive x，需要修改 Profile 中 Hive 的版本为集群对应版本（只需修改 Profile 里的 Hive 版本）。修改位置为 <code>packaging/hudi-flink-bundle/pom.xml</code>
最下面的对应 Profile 段，找到后修改 Profile 中的 Hive 版本为对应版本即可。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hive-环境准备">Hive 环境准备<a href="#hive-环境准备" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<ol>
<li>
<p>第一步是将 <code>hudi-hadoop-mr-bundle.jar</code> 放到 Hive中。 在 Hive 的根目录下创建 <code>auxlib/</code> 文件夹，把 <code>hudi-hadoop-mr-bundle-0.x.x-SNAPSHOT.jar</code> 移入到 <code>auxlib</code>。
<code>hudi-hadoop-mr-bundle-0.x.x-SNAPSHOT.jar</code> 可以在 <code>packaging/hudi-hadoop-mr-bundle/target</code> 目录下拷贝。</p>
</li>
<li>
<p>第二步是开启 Hive 相关的服务。Flink SQL Client 远程连接 Hive 的时候，要求 Hive 的 <code>hive metastore</code> and <code>hiveserver2</code> 两个服务都开启且需要记住端口号。
服务开启的方法如下：</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 启动 Hive metastore 和 hiveserver2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nohup ./bin/hive --service metastore &amp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nohup ./bin/hive --service hiveserver2 &amp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 每次更新了 /auxlib 下的 jar 包都需要重启上述两个服务</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hive-配置模版">Hive 配置模版<a href="#hive-配置模版" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>Flink hive sync 现在支持两种 hive sync mode，分别是 <code>hms</code> 和 <code>jdbc</code>。其中 <code>hms</code> 模式只需要配置 Metastore uris；而 <code>jdbc</code> 模式需要同时
配置 JDBC 属性 和 Metastore uris，具体配置模版如下：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- hms mode 配置模版</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uuid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  age </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PARTITIONED </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hudi&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;path&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;oss://vvr-daily/hudi/t1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;table.type&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;COPY_ON_WRITE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">--MERGE_ON_READ 方式在没生成 parquet 文件前，Hive 不会有输出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.enable&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;true&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">-- Required。开启 Hive 同步功能</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.mode&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hms&#x27;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(98, 114, 164)">-- Required。将 hive sync mode 设置为 hms, 默认 jdbc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.metastore.uris&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;thrift://ip:9083&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">-- Required。metastore 的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- jdbc mode 配置模版</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uuid </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  age </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ts </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PARTITIONED </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">partition</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;connector&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hudi&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;path&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;oss://vvr-daily/hudi/t1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;table.type&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;COPY_ON_WRITE&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">--MERGE_ON_READ 方式在没生成 parquet 文件前，Hive 不会有输出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.enable&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;true&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">-- Required。开启 Hive 同步功能</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.mode&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hms&#x27;</span><span class="token plain">         </span><span class="token comment" style="color:rgb(98, 114, 164)">-- Required。 将 hive sync mode 设置为 hms, 默认 jdbc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.metastore.uris&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;thrift://ip:9083&#x27;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">-- Required。metastore 的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.jdbc_url&#x27;</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;jdbc:hive2://ip:10000&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">-- required。hiveServer 的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.table&#x27;</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;t1&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                          </span><span class="token comment" style="color:rgb(98, 114, 164)">-- required。hive 新建的表名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.db&#x27;</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;testDB&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                         </span><span class="token comment" style="color:rgb(98, 114, 164)">-- required。hive 新建的数据库名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.username&#x27;</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;root&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">                     </span><span class="token comment" style="color:rgb(98, 114, 164)">-- required。HMS 用户名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;hive_sync.password&#x27;</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;your password&#x27;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(98, 114, 164)">-- required。HMS 密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hive-查询-1">Hive 查询<a href="#hive-查询-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>使用 beeline 查询时，需要手动设置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">set hive.input.format = org.apache.hudi.hadoop.hive.HoodieCombineHiveInputFormat;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="与其他包冲突">与其他包冲突<a href="#与其他包冲突" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>当 Flink lib/ 下有 <code>flink-sql-connector-hive-xxx.jar</code> 时，会出现hive包冲突，解决方法是在 Install 时，另外再指定一个 Profile：<code>-Pinclude-flink-sql-connector-hive</code>，
同时删除 Flink lib/ 下的 <code>flink-sql-connector-hive-xxx.jar</code>，新的 Install 的命令如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Maven 打包命令</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mvn install -DskipTests -Drat.skip=true -Pflink-bundle-shade-hive2 -Pinclude-flink-sql-connector-hive</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="presto-查询">Presto 查询<a href="#presto-查询" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hive-同步">Hive 同步<a href="#hive-同步" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>首先，参考 <a href="#hive-%E6%9F%A5%E8%AF%A2">Hive 查询</a> 过程，完成 Hive 元数据的同步。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="presto-环境配置">Presto 环境配置<a href="#presto-环境配置" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<ol>
<li>根据 <a href="https://prestodb.io/docs/current/installation/deployment.html" target="_blank" rel="noopener noreferrer">Presto 配置文档</a> 来配置 Presto。</li>
<li>根据下面的配置，在 <code> /presto-server-0.2xxx/etc/catalog/hive.properties</code> 中配置 Hive catalog：</li>
</ol>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">connector.name=hive-hadoop2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hive.metastore.uri=thrift://xxx.xxx.xxx.xxx:9083</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hive.config.resources=.../hadoop-2.x/etc/hadoop/core-site.xml,.../hadoop-2.x/etc/hadoop/hdfs-site.xml</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="presto-查询-1">Presto 查询<a href="#presto-查询-1" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<p>通过 presto-cli 连接 Hive metastore 开启查询。 presto-cli 的设置参考 presto-cli 配置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 连接 presto server 的命令</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./presto --server xxx.xxx.xxx.xxx:9999 --catalog hive --schema default</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ol>
<li><code>Presto-server-0.2445</code> 版本较低，在查 MOR 表的 <code>rt</code> 表时，会出现包冲突，正在解决中</li>
<li>当 <code>Presto-server-xxx</code> 的版本 &lt; 0.233 时，<code>hudi-presto-bundle.jar</code> 需要手动导入到 <code>{presto_install_dir}/plugin/hive-hadoop2/</code> 中。</li>
</ol></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="离线-compaction">离线 Compaction<a href="#离线-compaction" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>MERGE_ON_READ 表的 compaction 默认是打开的，策略是 <code>5</code> 个 delta commits 执行一次压缩。因为压缩操作比较耗费内存，和写流程放在同一个 pipeline，在数据量比较大
的时候（10w+/s），容易干扰写流程，此时采用离线定时任务的方式执行 compaction 任务更稳定。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>一个 compaction 任务的执行包括两部分：1. 生成 compaction plan； 2. 执行对应的 compaction plan。其中，第一步生成 compaction plan 的过程推荐由写任务定时触发，
写参数 <code>compaction.schedule.enable</code> 默认开启。</p></div></div>
<p>离线 compaction 需要手动执行 Flink 任务，程序入口为： <code>hudi-flink-bundle_2.11-0.9.0-SNAPSHOT.jar</code> ： <code>org.apache.hudi.sink.compact.HoodieFlinkCompactor</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 命令行执行方式</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/flink run -c org.apache.hudi.sink.compact.HoodieFlinkCompactor lib/hudi-flink-bundle_2.11-0.9.0.jar --path hdfs://xxx:9000/table</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参数-4">参数<a href="#参数-4" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>Required</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>--path</code></td><td><code>frue</code></td><td><code>--</code></td><td>目标 Hudi 表的路径</td></tr><tr><td><code>--compaction-max-memory</code></td><td><code>false</code></td><td><code>100</code></td><td>压缩时 log 数据的索引 HashMap 的内存大小，默认 <code>100MB</code>，内存足够时，可以调大</td></tr><tr><td><code>--schedule</code></td><td><code>false</code></td><td><code>false</code></td><td>是否要执行 schedule compaction 的操作，当写流程还在持续写入表数据的时候，开启这个参数有丢失查询数据的风险，所以开启该参数一定要保证当前没有任务往表里写数据，写任务的 compaction plan 默认是一直 schedule 的，除非手动关闭（默认 <code>5</code> 个 delta commits 一次 compaction）</td></tr><tr><td><code>--seq</code></td><td><code>false</code></td><td><code>LIFO</code></td><td>执行压缩任务的顺序，默认是从最新的 compaction plan 开始执行，可选值：<code>LIFO</code> ：从最新的 plan 开始执行； <code>FIFO</code>：从最老的 plan 开始执行</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="写入限流">写入限流<a href="#写入限流" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>针对将全量数据（百亿数量级）和增量先同步到 Kafka，再通过 Flink 流式消费的方式将库表数据直接导成 Hudi 表的需求，因为直接消费全量数据：量大
（吞吐高）、乱序严重（写入的 partition 随机），会导致写入性能退化，出现吞吐毛刺等情况，这时候可以开启限速参数，保证流量平稳写入。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="参数-5">参数<a href="#参数-5" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3>
<table><thead><tr><th>名称</th><th>Required</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td><code>write.rate.limit</code></td><td><code>false</code></td><td><code>0</code></td><td>默认关闭限速</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="从这开始下一步">从这开始下一步？<a href="#从这开始下一步" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2>
<p>您也可以通过<a href="https://github.com/apache/hudi#building-apache-hudi-from-source" target="_blank" rel="noopener noreferrer">自己构建hudi</a>来快速开始，
并在spark-shell命令中使用<code>--jars &lt;path to hudi_code&gt;/packaging/hudi-spark-bundle/target/hudi-spark-bundle_2.1?-*.*.*-SNAPSHOT.jar</code>，
而不是<code>--packages org.apache.hudi:hudi-spark3-bundle_2.12:0.8.0</code></p>
<p>这里我们使用Spark演示了Hudi的功能。但是，Hudi可以支持多种存储类型/视图，并且可以从Hive，Spark，Presto等查询引擎中查询Hudi数据集。
我们制作了一个基于Docker设置、所有依赖系统都在本地运行的<a href="https://www.youtube.com/watch?v=VhNgUsxdrD0" target="_blank" rel="noopener noreferrer">演示视频</a>，
我们建议您复制相同的设置然后按照<a href="/cn/docs/docker_demo">这里</a>的步骤自己运行这个演示。
另外，如果您正在寻找将现有数据迁移到Hudi的方法，请参考<a href="/cn/docs/migration_guide">迁移指南</a>。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/apache/hudi/tree/asf-site/website/versioned_docs/version-1.0.0/flink-quick-start-guide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/cn/docs/1.0.0/quick-start-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Spark Quick Start</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cn/docs/1.0.0/python-rust-quick-start-guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Python/Rust Quick Start</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#快速开始" class="table-of-contents__link toc-highlight">快速开始</a><ul><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a></li><li><a href="#插入数据" class="table-of-contents__link toc-highlight">插入数据</a></li><li><a href="#查询数据" class="table-of-contents__link toc-highlight">查询数据</a></li><li><a href="#更新数据" class="table-of-contents__link toc-highlight">更新数据</a></li><li><a href="#流式查询" class="table-of-contents__link toc-highlight">流式查询</a></li><li><a href="#deletes" class="table-of-contents__link toc-highlight">删除数据</a></li></ul></li><li><a href="#flink-配置" class="table-of-contents__link toc-highlight">Flink 配置</a><ul><li><a href="#并行度" class="table-of-contents__link toc-highlight">并行度</a></li><li><a href="#内存" class="table-of-contents__link toc-highlight">内存</a></li><li><a href="#checkpoint" class="table-of-contents__link toc-highlight">Checkpoint</a></li></ul></li><li><a href="#表参数" class="table-of-contents__link toc-highlight">表参数</a><ul><li><a href="#内存-1" class="table-of-contents__link toc-highlight">内存</a></li><li><a href="#并行度-1" class="table-of-contents__link toc-highlight">并行度</a></li><li><a href="#compaction" class="table-of-contents__link toc-highlight">Compaction</a></li></ul></li><li><a href="#内存优化" class="table-of-contents__link toc-highlight">内存优化</a><ul><li><a href="#mor" class="table-of-contents__link toc-highlight">MOR</a></li><li><a href="#cow" class="table-of-contents__link toc-highlight">COW</a></li></ul></li><li><a href="#离线批量导入" class="table-of-contents__link toc-highlight">离线批量导入</a><ul><li><a href="#参数" class="table-of-contents__link toc-highlight">参数</a></li></ul></li><li><a href="#全量接增量" class="table-of-contents__link toc-highlight">全量接增量</a><ul><li><a href="#参数-1" class="table-of-contents__link toc-highlight">参数</a></li><li><a href="#使用流程" class="table-of-contents__link toc-highlight">使用流程</a></li></ul></li><li><a href="#changelog-模式" class="table-of-contents__link toc-highlight">Changelog 模式</a><ul><li><a href="#参数-2" class="table-of-contents__link toc-highlight">参数</a></li></ul></li><li><a href="#insert-模式" class="table-of-contents__link toc-highlight">Insert 模式</a><ul><li><a href="#参数-3" class="table-of-contents__link toc-highlight">参数</a></li></ul></li><li><a href="#hive-查询" class="table-of-contents__link toc-highlight">Hive 查询</a><ul><li><a href="#打包" class="table-of-contents__link toc-highlight">打包</a></li><li><a href="#hive-环境准备" class="table-of-contents__link toc-highlight">Hive 环境准备</a></li><li><a href="#hive-配置模版" class="table-of-contents__link toc-highlight">Hive 配置模版</a></li><li><a href="#hive-查询-1" class="table-of-contents__link toc-highlight">Hive 查询</a></li><li><a href="#与其他包冲突" class="table-of-contents__link toc-highlight">与其他包冲突</a></li></ul></li><li><a href="#presto-查询" class="table-of-contents__link toc-highlight">Presto 查询</a><ul><li><a href="#hive-同步" class="table-of-contents__link toc-highlight">Hive 同步</a></li><li><a href="#presto-环境配置" class="table-of-contents__link toc-highlight">Presto 环境配置</a></li><li><a href="#presto-查询-1" class="table-of-contents__link toc-highlight">Presto 查询</a></li></ul></li><li><a href="#离线-compaction" class="table-of-contents__link toc-highlight">离线 Compaction</a><ul><li><a href="#参数-4" class="table-of-contents__link toc-highlight">参数</a></li></ul></li><li><a href="#写入限流" class="table-of-contents__link toc-highlight">写入限流</a><ul><li><a href="#参数-5" class="table-of-contents__link toc-highlight">参数</a></li></ul></li><li><a href="#从这开始下一步" class="table-of-contents__link toc-highlight">从这开始下一步？</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cn/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/community/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/releases/release-1.0.2">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/powered-by">Who&#x27;s Using</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cn/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/learn/tutorial-series">Tutorial Series</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/talks">Talks</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/videos">Video Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/faq">FAQ</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cn/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/docs/ibm_cos_hoodie">IBM Cloud</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cn/community/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/apache-hudi/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Apache</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a class="footer__link-item" href="/cn/asf/telemetry">Telemetry</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://hudi.apache.org/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/cn/assets/images/logo-big.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cn/assets/images/logo-big.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>.
      Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation. <a href="/docs/privacy">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>