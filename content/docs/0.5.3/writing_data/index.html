<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Hudi! Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Hudi! Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi!" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css"><title data-react-helmet="true">Writing Hudi Tables | Apache Hudi!</title><meta data-react-helmet="true" property="og:url" content="https://hudi.apache.org/docs/0.5.3/writing_data"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="0.5.3"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-0.5.3"><meta data-react-helmet="true" property="og:title" content="Writing Hudi Tables | Apache Hudi!"><meta data-react-helmet="true" name="description" content="In this section, we will cover ways to ingest new changes from external sources or even other Hudi tables using the DeltaStreamer tool, as well as"><meta data-react-helmet="true" property="og:description" content="In this section, we will cover ways to ingest new changes from external sources or even other Hudi tables using the DeltaStreamer tool, as well as"><meta data-react-helmet="true" name="keywords" content="hudi,incremental,batch,stream,processing,Hive,ETL,Spark SQL"><link data-react-helmet="true" rel="shortcut icon" href="/assets/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hudi.apache.org/docs/0.5.3/writing_data"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/docs/0.5.3/writing_data" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/cn/docs/0.5.3/writing_data" hreflang="cn"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/docs/0.5.3/writing_data" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.067d5900.css">
<link rel="preload" href="/assets/js/runtime~main.b62330e8.js" as="script">
<link rel="preload" href="/assets/js/main.1b4b15db.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">⭐️ If you like Apache Hudi, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi">GitHub</a>! ⭐</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">×</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/quick-start-guide">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog">Blog</a></li><li><a class="dropdown__link" href="/talks-articles">Talks &amp; Articles</a></li><li><a class="dropdown__link" href="/learn/faq">FAQ</a></li><li><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Technical Wiki<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/contribute/team">Team</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/contribute/report-security-issues">Report Security Issues</a></li><li><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Report Issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a class="navbar__item navbar__link" href="/powered-by">Who&#x27;s Using</a><a class="navbar__item navbar__link" href="/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/docs/0.5.3/quick-start-guide">0.5.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/writing_data">Current</a></li><li><a class="dropdown__link" href="/docs/writing_data">0.9.0</a></li><li><a class="dropdown__link" href="/docs/0.8.0/writing_data">0.8.0</a></li><li><a class="dropdown__link" href="/docs/0.7.0/writing_data">0.7.0</a></li><li><a class="dropdown__link" href="/docs/0.6.0/writing_data">0.6.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/0.5.3/writing_data">0.5.3</a></li><li><a class="dropdown__link" href="/docs/0.5.2/writing_data">0.5.2</a></li><li><a class="dropdown__link" href="/docs/0.5.1/writing_data">0.5.1</a></li><li><a class="dropdown__link" href="/docs/0.5.0/writing_data">0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/0.5.3/writing_data" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/0.5.3/writing_data" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Chinese</a></li></ul></div><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter-link" aria-label="Hudi Twitter Handle"></a><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Hudi Slack Channel"></a><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quick-start-guide">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Learn</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/talks-articles">Talks &amp; Articles</a></li><li class="menu__list-item"><a class="menu__link" href="/learn/faq">FAQ</a></li><li class="menu__list-item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/contribute/get-involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/team">Team</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/developer-setup">Developer Setup</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/rfc-process">RFC Process</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/report-security-issues">Report Security Issues</a></li><li class="menu__list-item"><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Report Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/powered-by">Who&#x27;s Using</a></li><li class="menu__list-item"><a class="menu__link" href="/releases/download">Download</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/writing_data">Current</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/writing_data">0.9.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.8.0/writing_data">0.8.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.7.0/writing_data">0.7.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.6.0/writing_data">0.6.0</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/0.5.3/writing_data">0.5.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.2/writing_data">0.5.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.1/writing_data">0.5.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.0/writing_data">0.5.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/0.5.3/writing_data" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/0.5.3/writing_data" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">Chinese</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li><li class="menu__list-item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="menu__link header-twitter-link" aria-label="Hudi Twitter Handle"></a></li><li class="menu__list-item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="menu__link header-slack-link" aria-label="Hudi Slack Channel"></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/quick-start-guide">Quick-Start Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/use_cases">Use Cases</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/0.5.3/writing_data">Writing Hudi Tables</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/querying_data">Querying Hudi Tables</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/configurations">Configurations</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/performance">Performance</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/deployment">Deployment Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Storage Configurations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.5.3/cloud">Cloud Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.5.3/s3_hoodie">S3 Filesystem</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.5.3/gcs_hoodie">GCS Filesystem</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.5.3/oss_hoodie">OSS Filesystem</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.5.3/azure_hoodie">Azure Filesystem</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.5.3/docker_demo">Docker Demo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.5.3/privacy">Privacy Policy</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache Hudi! <b>0.5.3</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/writing_data">latest version</a></b> (0.9.0).</div></div><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: 0.5.3</span><div class="markdown"><header><h1 class="h1Heading_27L5">Writing Hudi Tables</h1></header><p>In this section, we will cover ways to ingest new changes from external sources or even other Hudi tables using the <a href="#deltastreamer">DeltaStreamer</a> tool, as well as
speeding up large Spark jobs via upserts using the <a href="#datasource-writer">Hudi datasource</a>. Such tables can then be <a href="/docs/querying_data">queried</a> using various query engines.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="write-operations"></a>Write Operations<a class="hash-link" href="#write-operations" title="Direct link to heading">#</a></h2><p>Before that, it may be helpful to understand the 3 different write operations provided by Hudi datasource or the delta streamer tool and how best to leverage them. These operations
can be chosen/changed across each commit/deltacommit issued against the table.</p><ul><li><strong>UPSERT</strong> : This is the default operation where the input records are first tagged as inserts or updates by looking up the index and
the records are ultimately written after heuristics are run to determine how best to pack them on storage to optimize for things like file sizing.
This operation is recommended for use-cases like database change capture where the input almost certainly contains updates.</li><li><strong>INSERT</strong> : This operation is very similar to upsert in terms of heuristics/file sizing but completely skips the index lookup step. Thus, it can be a lot faster than upserts
for use-cases like log de-duplication (in conjunction with options to filter duplicates mentioned below). This is also suitable for use-cases where the table can tolerate duplicates, but just
need the transactional writes/incremental pull/storage management capabilities of Hudi.</li><li><strong>BULK_INSERT</strong> : Both upsert and insert operations keep input records in memory to speed up storage heuristics computations faster (among other things) and thus can be cumbersome for
initial loading/bootstrapping a Hudi table at first. Bulk insert provides the same semantics as insert, while implementing a sort-based data writing algorithm, which can scale very well for several hundred TBs
of initial load. However, this just does a best-effort job at sizing files vs guaranteeing file sizes like inserts/upserts do. </li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deltastreamer"></a>DeltaStreamer<a class="hash-link" href="#deltastreamer" title="Direct link to heading">#</a></h2><p>The <code>HoodieDeltaStreamer</code> utility (part of hudi-utilities-bundle) provides the way to ingest from different sources such as DFS or Kafka, with the following capabilities.</p><ul><li>Exactly once ingestion of new events from Kafka, <a href="https://sqoop.apache.org/docs/1.4.2/SqoopUserGuide#_incremental_imports" target="_blank" rel="noopener noreferrer">incremental imports</a> from Sqoop or output of <code>HiveIncrementalPuller</code> or files under a DFS folder</li><li>Support json, avro or a custom record types for the incoming data</li><li>Manage checkpoints, rollback &amp; recovery </li><li>Leverage Avro schemas from DFS or Confluent <a href="https://github.com/confluentinc/schema-registry" target="_blank" rel="noopener noreferrer">schema registry</a>.</li><li>Support for plugging in transformations</li></ul><p>Command line options describe capabilities in more detail</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[hoodie]$ spark-submit --class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer `ls packaging/hudi-utilities-bundle/target/hudi-utilities-bundle-*.jar` --help</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Usage: &lt;main class&gt; [options]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Options:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --checkpoint</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Resume Delta Streamer from this checkpoint.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --commit-on-errors</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Commit even when some records failed to be written</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --compact-scheduling-minshare</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Minshare for compaction as defined in</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      https://spark.apache.org/docs/latest/job-scheduling</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: 0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --compact-scheduling-weight</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Scheduling weight for compaction as defined in</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      https://spark.apache.org/docs/latest/job-scheduling</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: 1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --continuous</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Delta Streamer runs in continuous mode running source-fetch -&gt; Transform</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      -&gt; Hudi Write in loop</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --delta-sync-scheduling-minshare</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Minshare for delta sync as defined in</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      https://spark.apache.org/docs/latest/job-scheduling</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: 0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --delta-sync-scheduling-weight</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Scheduling weight for delta sync as defined in</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      https://spark.apache.org/docs/latest/job-scheduling</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: 1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --disable-compaction</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Compaction is enabled for MoR table by default. This flag disables it</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --enable-hive-sync</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Enable syncing to hive</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --filter-dupes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Should duplicate records from source be dropped/filtered out before</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      insert/bulk-insert</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --help, -h</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --hoodie-conf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Any configuration that can be set in the properties file (using the CLI</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      parameter &quot;--propsFilePath&quot;) can also be passed command line using this</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      parameter</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: []</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --max-pending-compactions</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Maximum number of outstanding inflight/requested compactions. Delta Sync</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      will not happen unlessoutstanding compactions is less than this number</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: 5</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --min-sync-interval-seconds</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      the min sync interval of each sync in continuous mode</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: 0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --op</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Takes one of these values : UPSERT (default), INSERT (use when input is</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      purely new data/inserts to gain speed)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: UPSERT</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Possible Values: [UPSERT, INSERT, BULK_INSERT]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --payload-class</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      subclass of HoodieRecordPayload, that works off a GenericRecord.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Implement your own, if you want to do something other than overwriting</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      existing value</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: org.apache.hudi.common.model.OverwriteWithLatestAvroPayload</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --props</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      path to properties file on localfs or dfs, with configurations for</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      hoodie client, schema provider, key generator and data source. For</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      hoodie client props, sane defaults are used, but recommend use to</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      provide basic things like metrics endpoints, hive configs etc. For</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      sources, referto individual classes, for supported properties.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: file:///Users/vinoth/bin/hoodie/src/test/resources/delta-streamer-config/dfs-source.properties</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --schemaprovider-class</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      subclass of org.apache.hudi.utilities.schema.SchemaProvider to attach</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      schemas to input &amp; target table data, built in options:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      org.apache.hudi.utilities.schema.FilebasedSchemaProvider.Source (See</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      org.apache.hudi.utilities.sources.Source) implementation can implement</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      their own SchemaProvider. For Sources that return Dataset&lt;Row&gt;, the</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      schema is obtained implicitly. However, this CLI option allows</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      overriding the schemaprovider returned by Source.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --source-class</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Subclass of org.apache.hudi.utilities.sources to read data. Built-in</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      options: org.apache.hudi.utilities.sources.{JsonDFSSource (default),</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      AvroDFSSource, JsonKafkaSource, AvroKafkaSource, HiveIncrPullSource}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: org.apache.hudi.utilities.sources.JsonDFSSource</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --source-limit</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Maximum amount of data to read from source. Default: No limit For e.g:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      DFS-Source =&gt; max bytes to read, Kafka-Source =&gt; max events to read</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: 9223372036854775807</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --source-ordering-field</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Field within source record to decide how to break ties between records</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      with same key in input data. Default: &#x27;ts&#x27; holding unix timestamp of</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      record</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: ts</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --spark-master</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      spark master to use.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: local[2]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * --table-type</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Type of table. COPY_ON_WRITE (or) MERGE_ON_READ</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * --target-base-path</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      base path for the target hoodie table. (Will be created if did not exist</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      first time around. If exists, expected to be a hoodie table)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * --target-table</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      name of the target table in Hive</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --transformer-class</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      subclass of org.apache.hudi.utilities.transform.Transformer. Allows</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      transforming raw source Dataset to a target Dataset (conforming to</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      target schema) before writing. Default : Not set. E:g -</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      org.apache.hudi.utilities.transform.SqlQueryBasedTransformer (which</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      allows a SQL query templated to be passed as a transformation function)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The tool takes a hierarchically composed property file and has pluggable interfaces for extracting data, key generation and providing schema. Sample configs for ingesting from kafka and dfs are
provided under <code>hudi-utilities/src/test/resources/delta-streamer-config</code>.</p><p>For e.g: once you have Confluent Kafka, Schema registry up &amp; running, produce some test data using (<a href="https://docs.confluent.io/current/ksql/docs/tutorials/generate-custom-test-data" target="_blank" rel="noopener noreferrer">impressions.avro</a> provided by schema-registry repo)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[confluent-5.0.0]$ bin/ksql-datagen schema=../impressions.avro format=avro topic=impressions key=impressionid</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and then ingest it as follows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[hoodie]$ spark-submit --class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer `ls packaging/hudi-utilities-bundle/target/hudi-utilities-bundle-*.jar` \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --props file://${PWD}/hudi-utilities/src/test/resources/delta-streamer-config/kafka-source.properties \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --schemaprovider-class org.apache.hudi.utilities.schema.SchemaRegistryProvider \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --source-class org.apache.hudi.utilities.sources.AvroKafkaSource \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --source-ordering-field impresssiontime \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --target-base-path file:\/\/\/tmp/hudi-deltastreamer-op \ </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --target-table uber.impressions \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --op BULK_INSERT</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In some cases, you may want to migrate your existing table into Hudi beforehand. Please refer to <a href="/docs/migration_guide">migration guide</a>. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="datasource-writer"></a>Datasource Writer<a class="hash-link" href="#datasource-writer" title="Direct link to heading">#</a></h2><p>The <code>hudi-spark</code> module offers the DataSource API to write (and also read) any data frame into a Hudi table.
Following is how we can upsert a dataframe, while specifying the field names that need to be used
for <code>recordKey =&gt; _row_key</code>, <code>partitionPath =&gt; partition</code> and <code>precombineKey =&gt; timestamp</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">inputDF.write()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .format(&quot;org.apache.hudi&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .options(clientOpts) // any of the Hudi client opts can be passed in as well</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .option(DataSourceWriteOptions.RECORDKEY_FIELD_OPT_KEY(), &quot;_row_key&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .option(DataSourceWriteOptions.PARTITIONPATH_FIELD_OPT_KEY(), &quot;partition&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .option(DataSourceWriteOptions.PRECOMBINE_FIELD_OPT_KEY(), &quot;timestamp&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .option(HoodieWriteConfig.TABLE_NAME, tableName)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .mode(SaveMode.Append)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       .save(basePath);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="syncing-to-hive"></a>Syncing to Hive<a class="hash-link" href="#syncing-to-hive" title="Direct link to heading">#</a></h2><p>Both tools above support syncing of the table&#x27;s latest schema to Hive metastore, such that queries can pick up new columns and partitions.
In case, its preferable to run this from commandline or in an independent jvm, Hudi provides a <code>HiveSyncTool</code>, which can be invoked as below,
once you have built the hudi-hive module. Following is how we sync the above Datasource Writer written table to Hive metastore.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd hudi-hive</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run_sync_tool.sh  --jdbc-url jdbc:hive2:\/\/hiveserver:10000 --user hive --pass hive --partitioned-by partition --base-path &lt;basePath&gt; --database default --table &lt;tableName&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Starting with Hudi 0.5.1 version read optimized version of merge-on-read tables are suffixed &#x27;_ro&#x27; by default. For backwards compatibility with older Hudi versions,
an optional HiveSyncConfig - <code>--skip-ro-suffix</code>, has been provided to turn off &#x27;_ro&#x27; suffixing if desired. Explore other hive sync options using the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd hudi-hive</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run_sync_tool.sh</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> [hudi-hive]$ ./run_sync_tool.sh --help</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deletes"></a>Deletes<a class="hash-link" href="#deletes" title="Direct link to heading">#</a></h2><p>Hudi supports implementing two types of deletes on data stored in Hudi tables, by enabling the user to specify a different record payload implementation.
For more info refer to <a href="https://cwiki.apache.org/confluence/x/6IqvC" target="_blank" rel="noopener noreferrer">Delete support in Hudi</a>.</p><ul><li><strong>Soft Deletes</strong> : With soft deletes, user wants to retain the key but just null out the values for all other fields.
This can be simply achieved by ensuring the appropriate fields are nullable in the table schema and simply upserting the table after setting these fields to null.</li><li><strong>Hard Deletes</strong> : A stronger form of delete is to physically remove any trace of the record from the table. This can be achieved by issuing an upsert with a custom payload implementation
via either DataSource or DeltaStreamer which always returns Optional.Empty as the combined value. Hudi ships with a built-in <code>org.apache.hudi.EmptyHoodieRecordPayload</code> class that does exactly this.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> deleteDF // dataframe containing just records to be deleted</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   .write().format(&quot;org.apache.hudi&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   .option(...) // Add HUDI options like record-key, partition-path and others as needed for your setup</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   // specify record_key, partition_key, precombine_fieldkey &amp; usual params</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   .option(DataSourceWriteOptions.PAYLOAD_CLASS_OPT_KEY, &quot;org.apache.hudi.EmptyHoodieRecordPayload&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="optimized-dfs-access"></a>Optimized DFS Access<a class="hash-link" href="#optimized-dfs-access" title="Direct link to heading">#</a></h2><p>Hudi also performs several key storage management functions on the data stored in a Hudi table. A key aspect of storing data on DFS is managing file sizes and counts
and reclaiming storage space. For e.g HDFS is infamous for its handling of small files, which exerts memory/RPC pressure on the Name Node and can potentially destabilize
the entire cluster. In general, query engines provide much better performance on adequately sized columnar files, since they can effectively amortize cost of obtaining
column statistics etc. Even on some cloud data stores, there is often cost to listing directories with large number of small files.</p><p>Here are some ways to efficiently manage the storage of your Hudi tables.</p><ul><li>The <a href="/docs/configurations#compactionSmallFileSize">small file handling feature</a> in Hudi, profiles incoming workload
and distributes inserts to existing file groups instead of creating new file groups, which can lead to small files. </li><li>Cleaner can be <a href="/docs/configurations#retainCommits">configured</a> to clean up older file slices, more or less aggressively depending on maximum time for queries to run &amp; lookback needed for incremental pull</li><li>User can also tune the size of the <a href="/docs/configurations#limitFileSize">base/parquet file</a>, <a href="/docs/configurations#logFileMaxSize">log files</a> &amp; expected <a href="/docs/configurations#parquetCompressionRatio">compression ratio</a>,
such that sufficient number of inserts are grouped into the same file group, resulting in well sized base files ultimately.</li><li>Intelligently tuning the <a href="/docs/configurations#withBulkInsertParallelism">bulk insert parallelism</a>, can again in nicely sized initial file groups. It is in fact critical to get this right, since the file groups
once created cannot be deleted, but simply expanded as explained before.</li><li>For workloads with heavy updates, the <a href="/docs/concepts#merge-on-read-table">merge-on-read table</a> provides a nice mechanism for ingesting quickly into smaller files and then later merging them into larger base files via compaction.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/apache/hudi/edit/asf-site/website/docs/versioned_docs/version-0.5.3/writing_data.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/0.5.3/use_cases"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Use Cases</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/0.5.3/querying_data"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Querying Hudi Tables »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#write-operations" class="table-of-contents__link">Write Operations</a></li><li><a href="#deltastreamer" class="table-of-contents__link">DeltaStreamer</a></li><li><a href="#datasource-writer" class="table-of-contents__link">Datasource Writer</a></li><li><a href="#syncing-to-hive" class="table-of-contents__link">Syncing to Hive</a></li><li><a href="#deletes" class="table-of-contents__link">Deletes</a></li><li><a href="#optimized-dfs-access" class="table-of-contents__link">Optimized DFS Access</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/contribute/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/release-0.9.0">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/powered-by">Who&#x27;s Using</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docker_demo">Docker Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/talks-articles">Talks &amp; Articles</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/faq">FAQ</a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ibm_cos_hoodie">IBM Cloud</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/contribute/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="col footer__col"><div class="footer__title">Apache</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://hudi.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>. <br>Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b62330e8.js"></script>
<script src="/assets/js/main.1b4b15db.js"></script>
</body>
</html>