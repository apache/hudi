<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Concepts | Apache Hudi</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hudi.apache.org/docs/next/concepts"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Concepts | Apache Hudi"><meta data-rh="true" name="description" content="Apache Hudi (pronounced “Hudi”) provides the following streaming primitives over hadoop compatible storages"><meta data-rh="true" property="og:description" content="Apache Hudi (pronounced “Hudi”) provides the following streaming primitives over hadoop compatible storages"><meta data-rh="true" name="keywords" content="hudi,design,table,queries,timeline"><link data-rh="true" rel="icon" href="/assets/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://hudi.apache.org/docs/next/concepts"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/docs/next/concepts" hreflang="en"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/docs/next/concepts" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Hudi: User-Facing Analytics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Hudi: User-Facing Analytics Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Hudi: User-Facing Analytics JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/videos/rss.xml" title="Apache Hudi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/videos/atom.xml" title="Apache Hudi Atom Feed">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Zalando+Sans:ital,wght@0,200..900;1,200..900&display=swap">
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="9e4444ba-93cc-45ea-b143-783ae0fbeb6f" data-project-name="Apache Hudi" data-project-color="#FFFFFF" data-project-logo="https://hudi.apache.org/assets/images/logo-big.png" data-modal-disclaimer="This AI assistant answers Apache Hudi questions using your [documentation](https://hudi.apache.org/docs/quick-start-guide/), [dev setup](https://hudi.apache.org/contribute/developer-setup/), the [tech specs](https://hudi.apache.org/tech-specs-1point0/) and open GitHub Issues from the last year." data-modal-title="Apache Hudi AI Assistant" data-modal-example-questions-title="Try asking me..." data-modal-example-questions="How can I convert an existing COW table to MOR?,How do I set up incremental queries with Hudi tables?" data-modal-image="https://hudi.apache.org/assets/images/logo-big-2.png" data-modal-image-ask-ai="https://hudi.apache.org/assets/images/logo-big-2.png" data-modal-header-min-height="64px" data-modal-image-height="40" data-modal-image-width="40" data-modal-header-bg-color="#f8f9fa" data-modal-title-color="#0db1f9" data-button-text-color="#29557a" data-button-text="Ask AI" data-consent-required="true" data-consent-screen-title="Help us improve our AI assistant" data-consent-screen-disclaimer="By clicking &amp;quot;Allow tracking&amp;quot;, you consent to the use of the AI assistant in accordance with kapa.ai&#39;s [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google&#39;s [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai&#39;s and Google&#39;s privacy policies." data-consent-screen-accept-button-text="Allow tracking" data-modal-disclaimer-font-size="0.80rem" data-query-input-placeholder-text-color="#29557a" data-submit-query-button-bg-color="#0db1f9" data-query-input-text-color="#29557a" data-user-analytics-cookie-enabled="false" data-query-input-border-color="#211b0e" data-question-text-color="#0db1f9" data-answer-text-color="#000" data-thread-clear-button-bg-color="#000000" data-thread-clear-button-text-color="#FFFFFF" data-answer-feedback-button-bg-color="#000000" data-answer-feedback-button-text-color="#FFFFFF" data-answer-feedback-button-active-bg-color="#000000" data-answer-feedback-button-active-text-color="#FFFFFF" data-answer-copy-button-bg-color="#000000" data-answer-copy-button-text-color="#FFFFFF" data-example-question-button-text-color="#29557a" data-modal-disclaimer-bg-color="#f8f9fa" data-modal-disclaimer-text-color="#0db1f9" data-deep-thinking-button-bg-color="#0db1f9" data-deep-thinking-button-text-color="#FFFFFF" data-deep-thinking-button-active-bg-color="#0db1f9" data-deep-thinking-button-hover-bg-color="#FFFFFF" data-deep-thinking-button-active-hover-bg-color="#29557a" data-deep-thinking-button-active-text-color="#FFFFFF" async></script><link rel="stylesheet" href="/assets/css/styles.7b17816c.css">
<script src="/assets/js/runtime~main.c7e82b6e.js" defer="defer"></script>
<script src="/assets/js/main.f98a2d26.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" role="banner"><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like <b>Apache Hudi</b>, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi"><b>GitHub!<svg xmlns="http://www.w3.org/2000/svg\" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 -2 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></b></a> ⭐</div></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarWrapper_j_uY"><div class="navbar__inner navbarInnerStyle_KoMw"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo navbarLogo_aghy"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/overview">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/learn/tutorial-series">Tutorial Series</a></li><li><a class="dropdown__link" href="/learn/blog">Blogs</a></li><li><a class="dropdown__link" href="/learn/talks">Talks</a></li><li><a class="dropdown__link" href="/learn/videos">Video Guides</a></li><li><a class="dropdown__link" href="/learn/faq">FAQ</a></li><li><a class="dropdown__link" href="/learn/tech-specs">Tech Specs</a></li><li><a class="dropdown__link" href="/learn/tech-specs-1point0">Tech Specs 1.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute/developer-sync-call">Developer Sync Call</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/contribute/report-security-issues">Report Issues</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/syncs">Community Syncs</a></li><li><a class="dropdown__link" href="/community/office_hours">Office Hours</a></li><li><a class="dropdown__link" href="/community/team">Team</a></li><li><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Github<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="dropdown__link">Slack<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.linkedin.com/company/apache-hudi/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="dropdown__link">Linkdin<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="dropdown__link">Youtube<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://x.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">X<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><a class="navbar__item navbar__link" href="/ecosystem">Ecosystem</a><a class="navbar__item navbar__link" href="/powered-by">Who&#x27;s Using</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div><div role="button" class="searchButton_o6KI" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 14 14"><circle cx="6.864" cy="6.864" r="5.243" stroke="#15467D" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></circle><path stroke="#15467D" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m10.51 10.783 2.056 2.05"></path></svg></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar navbarSideMenu_TODO"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><div class="navbar__logo navbarLogo_aghy"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><button type="button" aria-label="Close navigation bar" class="clean-btn navbar-sidebar__close"><svg viewBox="0 0 15 15" width="21" height="21"><g stroke="var(--ifm-color-emphasis-600)" stroke-width="1.2"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><div class="navbar-sidebar__items"><div class="navbar-sidebar__item menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/docs/overview">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Learn</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Contribute</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Community</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/ecosystem">Ecosystem</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/powered-by">Who&#x27;s Using</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/releases/download">Download</a></li></ul></div><div class="navbar-sidebar__item menu"><button type="button" class="clean-btn navbar-sidebar__back">← Back to main menu</button></div></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_bSxm"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_cWv0"><main class="docMainContainer_hjYf docMainContainerEnhanced_of6x"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Apache Hudi<!-- --> <b>Current</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/concepts">latest version</a></b> (<!-- -->1.0.2<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: Current</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Concepts</h1></header><p>Apache Hudi (pronounced “Hudi”) provides the following streaming primitives over hadoop compatible storages</p>
<ul>
<li class="">Update/Delete Records      (how do I change records in a table?)</li>
<li class="">Change Streams             (how do I fetch records that changed?)</li>
</ul>
<p>In this section, we will discuss key concepts &amp; terminologies that are important to understand, to be able to effectively use these primitives.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="timeline">Timeline<a href="#timeline" class="hash-link" aria-label="Direct link to Timeline" title="Direct link to Timeline" translate="no">​</a></h2>
<p>At its core, Hudi maintains a <code>timeline</code> of all actions performed on the table at different <code>instants</code> of time that helps provide instantaneous views of the table,
while also efficiently supporting retrieval of data in the order of arrival. A Hudi instant consists of the following components</p>
<ul>
<li class=""><code>Instant action</code> : Type of action performed on the table</li>
<li class=""><code>Instant time</code> : Instant time is typically a timestamp (e.g: 20190117010349), which monotonically increases in the order of action&#x27;s begin time.</li>
<li class=""><code>state</code> : current state of the instant</li>
</ul>
<p>Hudi guarantees that the actions performed on the timeline are atomic &amp; timeline consistent based on the instant time.</p>
<p>Key actions performed include</p>
<ul>
<li class=""><code>COMMITS</code> - A commit denotes an <strong>atomic write</strong> of a batch of records into a table.</li>
<li class=""><code>CLEANS</code> - Background activity that gets rid of older versions of files in the table, that are no longer needed.</li>
<li class=""><code>DELTA_COMMIT</code> - A delta commit refers to an <strong>atomic write</strong> of a batch of records into a  MergeOnRead type table, where some/all of the data could be just written to delta logs.</li>
<li class=""><code>COMPACTION</code> - Background activity to reconcile differential data structures within Hudi e.g: moving updates from row based log files to columnar formats. Internally, compaction manifests as a special commit on the timeline</li>
<li class=""><code>ROLLBACK</code> - Indicates that a commit/delta commit was unsuccessful &amp; rolled back, removing any partial files produced during such a write</li>
<li class=""><code>SAVEPOINT</code> - Marks certain file groups as &quot;saved&quot;, such that cleaner will not delete them. It helps restore the table to a point on the timeline, in case of disaster/data recovery scenarios.</li>
</ul>
<p>Any given instant can be
in one of the following states</p>
<ul>
<li class=""><code>REQUESTED</code> - Denotes an action has been scheduled, but has not initiated</li>
<li class=""><code>INFLIGHT</code> - Denotes that the action is currently being performed</li>
<li class=""><code>COMPLETED</code> - Denotes completion of an action on the timeline</li>
</ul>
<figure><img class="docimage" src="/assets/images/hudi_timeline.png" alt="hudi_timeline.png"></figure>
<p>Example above shows upserts happenings between 10:00 and 10:20 on a Hudi table, roughly every 5 mins, leaving commit metadata on the Hudi timeline, along
with other background cleaning/compactions. One key observation to make is that the commit time indicates the <code>arrival time</code> of the data (10:20AM), while the actual data
organization reflects the actual time or <code>event time</code>, the data was intended for (hourly buckets from 07:00). These are two key concepts when reasoning about tradeoffs between latency and completeness of data.</p>
<p>When there is late arriving data (data intended for 9:00 arriving &gt;1 hr late at 10:20), we can see the upsert producing new data into even older time buckets/folders.
With the help of the timeline, an incremental query attempting to get all new data that was committed successfully since 10:00 hours, is able to very efficiently consume
only the changed files without say scanning all the time buckets &gt; 07:00.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="file-management">File management<a href="#file-management" class="hash-link" aria-label="Direct link to File management" title="Direct link to File management" translate="no">​</a></h2>
<p>Hudi organizes a table into a directory structure under a <code>basepath</code> on DFS. Table is broken up into partitions, which are folders containing data files for that partition,
very similar to Hive tables. Each partition is uniquely identified by its <code>partitionpath</code>, which is relative to the basepath.</p>
<p>Within each partition, files are organized into <code>file groups</code>, uniquely identified by a <code>file id</code>. Each file group contains several
<code>file slices</code>, where each slice contains a base file (<code>*.parquet</code>) produced at a certain commit/compaction instant time,
along with set of log files (<code>*.log.*</code>) that contain inserts/updates to the base file since the base file was produced.
Hudi adopts a MVCC design, where compaction action merges logs and base files to produce new file slices and cleaning action gets rid of
unused/older file slices to reclaim space on DFS.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="index">Index<a href="#index" class="hash-link" aria-label="Direct link to Index" title="Direct link to Index" translate="no">​</a></h2>
<p>Hudi provides efficient upserts, by mapping a given hoodie key (record key + partition path) consistently to a file id, via an indexing mechanism.
This mapping between record key and file group/file id, never changes once the first version of a record has been written to a file. In short, the
mapped file group contains all versions of a group of records.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="table-types--queries">Table Types &amp; Queries<a href="#table-types--queries" class="hash-link" aria-label="Direct link to Table Types &amp; Queries" title="Direct link to Table Types &amp; Queries" translate="no">​</a></h2>
<p>Hudi table types define how data is indexed &amp; laid out on the DFS and how the above primitives and timeline activities are implemented on top of such organization (i.e how data is written).
In turn, <code>query types</code> define how the underlying data is exposed to the queries (i.e how data is read).</p>
<table><thead><tr><th>Table Type</th><th>Supported Query types</th></tr></thead><tbody><tr><td>Copy On Write</td><td>Snapshot Queries + Incremental Queries</td></tr><tr><td>Merge On Read</td><td>Snapshot Queries + Incremental Queries + Read Optimized Queries</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="table-types">Table Types<a href="#table-types" class="hash-link" aria-label="Direct link to Table Types" title="Direct link to Table Types" translate="no">​</a></h3>
<p>Hudi supports the following table types.</p>
<ul>
<li class=""><a href="#copy-on-write-table" class="">Copy On Write</a> : Stores data using exclusively columnar file formats (e.g parquet). Updates simply version &amp; rewrite the files by performing a synchronous merge during write.</li>
<li class=""><a href="#merge-on-read-table" class="">Merge On Read</a> : Stores data using a combination of columnar (e.g parquet) + row based (e.g avro) file formats. Updates are logged to delta files &amp; later compacted to produce new versions of columnar files synchronously or asynchronously.</li>
</ul>
<p>Following table summarizes the trade-offs between these two table types</p>
<table><thead><tr><th>Trade-off</th><th>CopyOnWrite</th><th>MergeOnRead</th></tr></thead><tbody><tr><td>Data Latency</td><td>Higher</td><td>Lower</td></tr><tr><td>Update cost (I/O)</td><td>Higher (rewrite entire parquet)</td><td>Lower (append to delta log)</td></tr><tr><td>Parquet File Size</td><td>Smaller (high update(I/0) cost)</td><td>Larger (low update cost)</td></tr><tr><td>Write Amplification</td><td>Higher</td><td>Lower (depending on compaction strategy)</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-types">Query types<a href="#query-types" class="hash-link" aria-label="Direct link to Query types" title="Direct link to Query types" translate="no">​</a></h3>
<p>Hudi supports the following query types</p>
<ul>
<li class=""><strong>Snapshot Queries</strong> : Queries see the latest snapshot of the table as of a given commit or compaction action. In case of merge on read table, it exposes near-real time data(few mins) by merging
the base and delta files of the latest file slice on-the-fly. For copy on write table,  it provides a drop-in replacement for existing parquet tables, while providing upsert/delete and other write side features.</li>
<li class=""><strong>Incremental Queries</strong> : Queries only see new data written to the table, since a given commit/compaction. This effectively provides change streams to enable incremental data pipelines.</li>
<li class=""><strong>Read Optimized Queries</strong> : Queries see the latest snapshot of table as of a given commit/compaction action. Exposes only the base/columnar files in latest file slices and guarantees the
same columnar query performance compared to a non-hudi columnar table.</li>
</ul>
<p>Following table summarizes the trade-offs between the different query types.</p>
<table><thead><tr><th>Trade-off</th><th>Snapshot</th><th>Read Optimized</th></tr></thead><tbody><tr><td>Data Latency</td><td>Lower</td><td>Higher</td></tr><tr><td>Query Latency</td><td>Higher (merge base / columnar file + row based delta / log files)</td><td>Lower (raw base / columnar file performance)</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="copy-on-write-table">Copy On Write Table<a href="#copy-on-write-table" class="hash-link" aria-label="Direct link to Copy On Write Table" title="Direct link to Copy On Write Table" translate="no">​</a></h2>
<p>File slices in Copy-On-Write table only contain the base/columnar file and each commit produces new versions of base files.
In other words, we implicitly compact on every commit, such that only columnar data exists. As a result, the write amplification
(number of bytes written for 1 byte of incoming data) is much higher, where read amplification is zero.
This is a much desired property for analytical workloads, which is predominantly read-heavy.</p>
<p>Following illustrates how this works conceptually, when data written into copy-on-write table  and two queries running on top of it.</p>
<figure><img class="docimage" src="/assets/images/hudi_cow.png" alt="hudi_cow.png"></figure>
<p>As data gets written, updates to existing file groups produce a new slice for that file group stamped with the commit instant time,
while inserts allocate a new file group and write its first slice for that file group. These file slices and their commit instant times are color coded above.
SQL queries running against such a table (eg: <code>select count(*)</code> counting the total records in that partition), first checks the timeline for the latest commit
and filters all but latest file slices of each file group. As you can see, an old query does not see the current inflight commit&#x27;s files color coded in pink,
but a new query starting after the commit picks up the new data. Thus queries are immune to any write failures/partial writes and only run on committed data.</p>
<p>The intention of copy on write table, is to fundamentally improve how tables are managed today through</p>
<ul>
<li class="">First class support for atomically updating data at file-level, instead of rewriting whole tables/partitions</li>
<li class="">Ability to incremental consume changes, as opposed to wasteful scans or fumbling with heuristics</li>
<li class="">Tight control of file sizes to keep query performance excellent (small files hurt query performance considerably).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="merge-on-read-table">Merge On Read Table<a href="#merge-on-read-table" class="hash-link" aria-label="Direct link to Merge On Read Table" title="Direct link to Merge On Read Table" translate="no">​</a></h2>
<p>Merge on read table is a superset of copy on write, in the sense it still supports read optimized queries of the table by exposing only the base/columnar files in latest file slices.
Additionally, it stores incoming upserts for each file group, onto a row based delta log, to support snapshot queries by applying the delta log,
onto the latest version of each file id on-the-fly during query time. Thus, this table type attempts to balance read and write amplification intelligently, to provide near real-time data.
The most significant change here, would be to the compactor, which now carefully chooses which delta log files need to be compacted onto
their columnar base file, to keep the query performance in check (larger delta log files would incur longer merge times with merge data on query side)</p>
<p>Following illustrates how the table works, and shows two types of queries - snapshot query and read optimized query.</p>
<figure><img class="docimage" src="/assets/images/hudi_mor.png" alt="hudi_mor.png"></figure>
<p>There are lot of interesting things happening in this example, which bring out the subtleties in the approach.</p>
<ul>
<li class="">We now have commits every 1 minute or so, something we could not do in the other table type.</li>
<li class="">Within each file id group, now there is an delta log file, which holds incoming updates to the records already present in the base columnar files. In the example, the delta log files hold
all the data from 10:05 to 10:10. The base columnar files are still versioned with the commit, as before.
Thus, if one were to simply look at base files alone, then the table layout looks exactly like a copy on write table.</li>
<li class="">A periodic compaction process reconciles these changes from the delta log and produces a new version of base file, just like what happened at 10:05 in the example.</li>
<li class="">There are two ways of querying the same underlying table: Read Optimized query and Snapshot query, depending on whether we chose query performance or freshness of data.</li>
<li class="">The semantics around when data from a commit is available to a query changes in a subtle way for a read optimized query. Note, that such a query
running at 10:10, wont see data after 10:05 above, while a snapshot query always sees the freshest data.</li>
<li class="">When we trigger compaction &amp; what it decides to compact hold all the key to solving these hard problems. By implementing a compacting
strategy, where we aggressively compact the latest partitions compared to older partitions, we could ensure the read optimized queries see data
published within X minutes in a consistent fashion.</li>
</ul>
<p>The intention of merge on read table is to enable near real-time processing directly on top of DFS, as opposed to copying
data out to specialized systems, which may not be able to handle the data volume. There are also a few secondary side benefits to
this table such as reduced write amplification by avoiding synchronous merge of data, i.e, the amount of data written per 1 bytes of data in a batch</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related-resources">Related Resources<a href="#related-resources" class="hash-link" aria-label="Direct link to Related Resources" title="Direct link to Related Resources" translate="no">​</a></h2>
<h3>Blogs</h3>
<ul>
<li class=""><a href="https://www.onehouse.ai/blog/comparing-apache-hudis-mor-and-cow-tables-use-cases-from-uber-and-shopee" target="_blank" rel="noopener noreferrer" class="">Comparing Apache Hudi&#x27;s MOR and COW Tables: Use Cases from Uber and Shopee</a></li>
<li class=""><a href="https://www.onehouse.ai/blog/hudi-metafields-demystified" target="_blank" rel="noopener noreferrer" class="">Hudi Metafields demystified</a></li>
<li class=""><a href="https://medium.com/@simpsons/file-naming-conventions-in-apache-hudi-cd1cdd95f5e7" target="_blank" rel="noopener noreferrer" class="">File Naming conventions in Apache Hudi</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/apache/hudi/tree/asf-site/website/docs/concepts.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#timeline" class="table-of-contents__link toc-highlight">Timeline</a></li><li><a href="#file-management" class="table-of-contents__link toc-highlight">File management</a></li><li><a href="#index" class="table-of-contents__link toc-highlight">Index</a></li><li><a href="#table-types--queries" class="table-of-contents__link toc-highlight">Table Types &amp; Queries</a><ul><li><a href="#table-types" class="table-of-contents__link toc-highlight">Table Types</a></li><li><a href="#query-types" class="table-of-contents__link toc-highlight">Query types</a></li></ul></li><li><a href="#copy-on-write-table" class="table-of-contents__link toc-highlight">Copy On Write Table</a></li><li><a href="#merge-on-read-table" class="table-of-contents__link toc-highlight">Merge On Read Table</a></li><li><a href="#related-resources" class="table-of-contents__link toc-highlight">Related Resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footerCustom_j_zv"><div class="container container-fluid container_y1z5"><div class="brand_kMBW"><a href="https://hudi.apache.org/" rel="noopener noreferrer" class="footerLogoLink_DDai"><img src="/assets/images/hudi.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="links_AXCu"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/community/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/release-1.0.2">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/powered-by">Who&#x27;s Using</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/tutorial-series">Tutorial Series</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/talks">Talks</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/videos">Video Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/faq">FAQ</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ibm_cos_hoodie">IBM Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oci_hoodie">Oracle Cloud</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/apache-hudi/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Apache</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a class="footer__link-item" href="/asf/privacy">Privacy</a></li><li class="footer__item"><a class="footer__link-item" href="/asf/telemetry">Telemetry</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div></div><div class="legal_MFbX"><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>. Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=8f594acf-9b77-44fb-9475-3e82ead1910c"><img referrerpolicy="no-referrer-when-downgrade" src="https://analytics.apache.org/matomo.php?idsite=47&amp;rec=1"></div></div></div></footer></div>
</body>
</html>