"use strict";(self.webpackChunkhudi=self.webpackChunkhudi||[]).push([[53619],{15680:(e,n,a)=>{a.d(n,{xA:()=>u,yg:()=>m});var t=a(96540);function i(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){i(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,i=function(e,n){if(null==e)return{};var a,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(i[a]=e[a]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=t.createContext({}),d=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},u=function(e){var n=d(e.components);return t.createElement(s.Provider,{value:n},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},g=t.forwardRef((function(e,n){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=d(a),g=i,m=p["".concat(s,".").concat(g)]||p[g]||c[g]||r;return a?t.createElement(m,l(l({ref:n},u),{},{components:a})):t.createElement(m,l({ref:n},u))}));function m(e,n){var a=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=g;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[p]="string"==typeof e?e:i,l[1]=o;for(var d=2;d<r;d++)l[d]=a[d];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}g.displayName="MDXCreateElement"},26982:(e,n,a)=>{a.d(n,{A:()=>i});var t=a(96540);const i=function(e){let{children:n,hidden:a,className:i}=e;return t.createElement("div",{role:"tabpanel",hidden:a,className:i},n)}},3593:(e,n,a)=>{a.d(n,{A:()=>c});var t=a(58168),i=a(96540),r=a(92303),l=a(48555);const o=function(){const e=(0,i.useContext)(l.A);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e};var s=a(91211),d=a(20053);const u={tabItem:"tabItem_vU9c"};function p(e){const{lazy:n,block:a,defaultValue:r,values:l,groupId:p,className:c}=e,g=i.Children.map(e.children,(e=>{if((0,i.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),m=l??g.map((e=>{let{props:{value:n,label:a,attributes:t}}=e;return{value:n,label:a,attributes:t}})),h=(0,s.XI)(m,((e,n)=>e.value===n.value));if(h.length>0)throw new Error(`Docusaurus error: Duplicate values "${h.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const y=null===r?r:r??g.find((e=>e.props.default))?.props.value??g[0]?.props.value;if(null!==y&&!m.some((e=>e.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${m.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:f,setTabGroupChoices:v}=o(),[k,b]=(0,i.useState)(y),N=[],{blockElementScrollPositionUntilNextRender:T}=(0,s.a_)();if(null!=p){const e=f[p];null!=e&&e!==k&&m.some((n=>n.value===e))&&b(e)}const w=e=>{const n=e.currentTarget,a=N.indexOf(n),t=m[a].value;t!==k&&(T(n),b(t),null!=p&&v(p,t))},E=e=>{let n=null;switch(e.key){case"ArrowRight":{const a=N.indexOf(e.currentTarget)+1;n=N[a]||N[0];break}case"ArrowLeft":{const a=N.indexOf(e.currentTarget)-1;n=N[a]||N[N.length-1];break}}n?.focus()};return i.createElement("div",{className:"tabs-container"},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,d.A)("tabs",{"tabs--block":a},c)},m.map((e=>{let{value:n,label:a,attributes:r}=e;return i.createElement("li",(0,t.A)({role:"tab",tabIndex:k===n?0:-1,"aria-selected":k===n,key:n,ref:e=>N.push(e),onKeyDown:E,onFocus:w,onClick:w},r,{className:(0,d.A)("tabs__item",u.tabItem,r?.className,{"tabs__item--active":k===n})}),a??n)}))),n?(0,i.cloneElement)(g.filter((e=>e.props.value===k))[0],{className:"margin-vert--md"}):i.createElement("div",{className:"margin-vert--md"},g.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==k})))))}function c(e){const n=(0,r.A)();return i.createElement(p,(0,t.A)({key:String(n)},e))}},85283:(e,n,a)=>{a.r(n),a.d(n,{contentTitle:()=>s,default:()=>g,frontMatter:()=>o,metadata:()=>d,toc:()=>u});var t=a(58168),i=(a(96540),a(15680)),r=a(3593),l=a(26982);const o={title:"Flink Guide",toc:!0,last_modified_at:new Date("2023-08-16T04:53:57.000Z")},s=void 0,d={unversionedId:"flink-quick-start-guide",id:"version-0.14.0/flink-quick-start-guide",title:"Flink Guide",description:"This page introduces Flink-Hudi integration. We can feel the unique charm of how Flink brings in the power of streaming into Hudi.",source:"@site/versioned_docs/version-0.14.0/flink-quick-start-guide.md",sourceDirName:".",slug:"/flink-quick-start-guide",permalink:"/docs/0.14.0/flink-quick-start-guide",editUrl:"https://github.com/apache/hudi/tree/asf-site/website/versioned_docs/version-0.14.0/flink-quick-start-guide.md",tags:[],version:"0.14.0",frontMatter:{title:"Flink Guide",toc:!0,last_modified_at:"2023-08-16T04:53:57.000Z"},sidebar:"docs",previous:{title:"Spark Guide",permalink:"/docs/0.14.0/quick-start-guide"},next:{title:"Docker Demo",permalink:"/docs/0.14.0/docker_demo"}},u=[{value:"Quick Start",id:"quick-start",children:[{value:"Setup",id:"setup",children:[{value:"Step.1 download Flink jar",id:"step1-download-flink-jar",children:[],level:4},{value:"Step.2 start Flink cluster",id:"step2-start-flink-cluster",children:[],level:4},{value:"Step.3 start Flink SQL client",id:"step3-start-flink-sql-client",children:[],level:4}],level:3},{value:"Insert Data",id:"insert-data",children:[],level:3},{value:"Query Data",id:"query-data",children:[],level:3},{value:"Update Data",id:"update-data",children:[],level:3},{value:"Streaming Query",id:"streaming-query",children:[],level:3},{value:"Delete Data",id:"deletes",children:[{value:"Row-level Delete",id:"row-level-delete",children:[],level:4},{value:"Batch Delete",id:"batch-delete",children:[],level:4}],level:3}],level:2},{value:"Where To Go From Here?",id:"where-to-go-from-here",children:[],level:2}],p={toc:u},c="wrapper";function g(e){let{components:n,...a}=e;return(0,i.yg)(c,(0,t.A)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("p",null,"This page introduces Flink-Hudi integration. We can feel the unique charm of how Flink brings in the power of streaming into Hudi.\nThis guide helps you quickly start using Flink on Hudi, and learn different modes for reading/writing Hudi by Flink:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Quick Start")," : Read ",(0,i.yg)("a",{parentName:"li",href:"#quick-start"},"Quick Start")," to get started quickly Flink sql client to write to(read from) Hudi."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Configuration")," : For ",(0,i.yg)("a",{parentName:"li",href:"/docs/flink_tuning#global-configurations"},"Global Configuration"),", sets up through ",(0,i.yg)("inlineCode",{parentName:"li"},"$FLINK_HOME/conf/flink-conf.yaml"),". For per job configuration, sets up through ",(0,i.yg)("a",{parentName:"li",href:"/docs/flink_tuning#table-options"},"Table Option"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Writing Data")," : Flink supports different modes for writing, such as ",(0,i.yg)("a",{parentName:"li",href:"/docs/hoodie_streaming_ingestion#cdc-ingestion"},"CDC Ingestion"),", ",(0,i.yg)("a",{parentName:"li",href:"/docs/hoodie_streaming_ingestion#bulk-insert"},"Bulk Insert"),", ",(0,i.yg)("a",{parentName:"li",href:"/docs/hoodie_streaming_ingestion#index-bootstrap"},"Index Bootstrap"),", ",(0,i.yg)("a",{parentName:"li",href:"/docs/hoodie_streaming_ingestion#changelog-mode"},"Changelog Mode")," and ",(0,i.yg)("a",{parentName:"li",href:"/docs/hoodie_streaming_ingestion#append-mode"},"Append Mode"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Querying Data")," : Flink supports different modes for reading, such as ",(0,i.yg)("a",{parentName:"li",href:"/docs/querying_data#streaming-query"},"Streaming Query")," and ",(0,i.yg)("a",{parentName:"li",href:"/docs/querying_data#incremental-query"},"Incremental Query"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Tuning")," : For write/read tasks, this guide gives some tuning suggestions, such as ",(0,i.yg)("a",{parentName:"li",href:"/docs/flink_tuning#memory-optimization"},"Memory Optimization")," and ",(0,i.yg)("a",{parentName:"li",href:"/docs/flink_tuning#write-rate-limit"},"Write Rate Limit"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Optimization"),": Offline compaction is supported ",(0,i.yg)("a",{parentName:"li",href:"/docs/compaction#flink-offline-compaction"},"Offline Compaction"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Query Engines"),": Besides Flink, many other engines are integrated: ",(0,i.yg)("a",{parentName:"li",href:"/docs/syncing_metastore#flink-setup"},"Hive Query"),", ",(0,i.yg)("a",{parentName:"li",href:"/docs/querying_data#prestodb"},"Presto Query"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Catalog"),": A Hudi specific catalog is supported: ",(0,i.yg)("a",{parentName:"li",href:"/docs/sql_ddl/#create-catalog"},"Hudi Catalog"),".")),(0,i.yg)("h2",{id:"quick-start"},"Quick Start"),(0,i.yg)("h3",{id:"setup"},"Setup"),(0,i.yg)(r.A,{defaultValue:"flinksql",values:[{label:"Flink SQL",value:"flinksql"},{label:"DataStream API",value:"dataStream"}],mdxType:"Tabs"},(0,i.yg)(l.A,{value:"flinksql",mdxType:"TabItem"},(0,i.yg)("p",null,"We use the ",(0,i.yg)("a",{parentName:"p",href:"https://ci.apache.org/projects/flink/flink-docs-release-1.13/docs/dev/table/sqlclient/"},"Flink Sql Client")," because it's a good\nquick start tool for SQL users."),(0,i.yg)("h4",{id:"step1-download-flink-jar"},"Step.1 download Flink jar"),(0,i.yg)("p",null,"Hudi works with both Flink 1.13, Flink 1.14, Flink 1.15, Flink 1.16 and Flink 1.17. You can follow the\ninstructions ",(0,i.yg)("a",{parentName:"p",href:"https://flink.apache.org/downloads"},"here")," for setting up Flink. Then choose the desired Hudi-Flink bundle\njar to work with different Flink and Scala versions:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"hudi-flink1.13-bundle")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"hudi-flink1.14-bundle")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"hudi-flink1.15-bundle")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"hudi-flink1.16-bundle")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"hudi-flink1.17-bundle"))),(0,i.yg)("h4",{id:"step2-start-flink-cluster"},"Step.2 start Flink cluster"),(0,i.yg)("p",null,"Start a standalone Flink cluster within hadoop environment.\nBefore you start up the cluster, we suggest to config the cluster as follows:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"in ",(0,i.yg)("inlineCode",{parentName:"li"},"$FLINK_HOME/conf/flink-conf.yaml"),", add config option ",(0,i.yg)("inlineCode",{parentName:"li"},"taskmanager.numberOfTaskSlots: 4")),(0,i.yg)("li",{parentName:"ul"},"in ",(0,i.yg)("inlineCode",{parentName:"li"},"$FLINK_HOME/conf/flink-conf.yaml"),", ",(0,i.yg)("a",{parentName:"li",href:"/docs/flink_tuning#global-configurations"},"add other global configurations according to the characteristics of your task")),(0,i.yg)("li",{parentName:"ul"},"in ",(0,i.yg)("inlineCode",{parentName:"li"},"$FLINK_HOME/conf/workers"),", add item ",(0,i.yg)("inlineCode",{parentName:"li"},"localhost")," as 4 lines so that there are 4 workers on the local cluster")),(0,i.yg)("p",null,"Now starts the cluster:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"# HADOOP_HOME is your hadoop root directory after unpack the binary package.\nexport HADOOP_CLASSPATH=`$HADOOP_HOME/bin/hadoop classpath`\n\n# Start the Flink standalone cluster\n./bin/start-cluster.sh\n")),(0,i.yg)("h4",{id:"step3-start-flink-sql-client"},"Step.3 start Flink SQL client"),(0,i.yg)("p",null,"Hudi supports packaged bundle jar for Flink, which should be loaded in the Flink SQL Client when it starts up.\nYou can build the jar manually under path ",(0,i.yg)("inlineCode",{parentName:"p"},"hudi-source-dir/packaging/hudi-flink-bundle"),"(see ",(0,i.yg)("a",{parentName:"p",href:"/docs/syncing_metastore#install"},"Build Flink Bundle Jar"),"), or download it from the\n",(0,i.yg)("a",{parentName:"p",href:"https://repo.maven.apache.org/maven2/org/apache/hudi/"},"Apache Official Repository"),"."),(0,i.yg)("p",null,"Now starts the SQL CLI:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"# HADOOP_HOME is your hadoop root directory after unpack the binary package.\nexport HADOOP_CLASSPATH=`$HADOOP_HOME/bin/hadoop classpath`\n\n./bin/sql-client.sh embedded -j .../hudi-flink1.1*-bundle-*.*.*.jar shell\n")),(0,i.yg)("div",{className:"notice--info"},(0,i.yg)("h4",null,"Please note the following: "),(0,i.yg)("ul",null,(0,i.yg)("li",null,"We suggest hadoop 2.9.x+ version because some of the object storage has filesystem implementation only after that"),(0,i.yg)("li",null,"The flink-parquet and flink-avro formats are already packaged into the hudi-flink-bundle jar"))),(0,i.yg)("p",null,"Setup table name, base path and operate using SQL for this guide.\nThe SQL CLI only executes the SQL line by line.")),(0,i.yg)(l.A,{value:"dataStream",mdxType:"TabItem"},(0,i.yg)("p",null,"Hudi works with Flink 1.13, Flink 1.14, Flink 1.15, Flink 1.16 and Flink 1.17. Please add the desired\ndependency to your project:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- Flink 1.13 --\x3e\n<dependency>\n    <groupId>org.apache.hudi</groupId>\n    <artifactId>hudi-flink1.13-bundle</artifactId>\n    <version>0.14.0</version>\n</dependency>\n")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- Flink 1.14 --\x3e\n<dependency>\n    <groupId>org.apache.hudi</groupId>\n    <artifactId>hudi-flink1.14-bundle</artifactId>\n    <version>0.14.0</version>\n</dependency>\n")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- Flink 1.15 --\x3e\n<dependency>\n    <groupId>org.apache.hudi</groupId>\n    <artifactId>hudi-flink1.15-bundle</artifactId>\n    <version>0.14.0</version>\n</dependency>\n")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- Flink 1.16 --\x3e\n<dependency>\n    <groupId>org.apache.hudi</groupId>\n    <artifactId>hudi-flink1.16-bundle</artifactId>\n    <version>0.14.0</version>\n</dependency>\n")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- Flink 1.17 --\x3e\n<dependency>\n    <groupId>org.apache.hudi</groupId>\n    <artifactId>hudi-flink1.17-bundle</artifactId>\n    <version>0.14.0</version>\n</dependency>\n")))),(0,i.yg)("h3",{id:"insert-data"},"Insert Data"),(0,i.yg)(r.A,{defaultValue:"flinksql",values:[{label:"Flink SQL",value:"flinksql"},{label:"DataStream API",value:"dataStream"}],mdxType:"Tabs"},(0,i.yg)(l.A,{value:"flinksql",mdxType:"TabItem"},(0,i.yg)("p",null,"Creates a Flink Hudi table first and insert data into the Hudi table using SQL ",(0,i.yg)("inlineCode",{parentName:"p"},"VALUES")," as below."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"-- sets up the result mode to tableau to show the results directly in the CLI\nset sql-client.execution.result-mode = tableau;\n\nCREATE TABLE t1(\n  uuid VARCHAR(20) PRIMARY KEY NOT ENFORCED,\n  name VARCHAR(10),\n  age INT,\n  ts TIMESTAMP(3),\n  `partition` VARCHAR(20)\n)\nPARTITIONED BY (`partition`)\nWITH (\n  'connector' = 'hudi',\n  'path' = '${path}',\n  'table.type' = 'MERGE_ON_READ' -- this creates a MERGE_ON_READ table, by default is COPY_ON_WRITE\n);\n\n-- insert data using values\nINSERT INTO t1 VALUES\n  ('id1','Danny',23,TIMESTAMP '1970-01-01 00:00:01','par1'),\n  ('id2','Stephen',33,TIMESTAMP '1970-01-01 00:00:02','par1'),\n  ('id3','Julian',53,TIMESTAMP '1970-01-01 00:00:03','par2'),\n  ('id4','Fabian',31,TIMESTAMP '1970-01-01 00:00:04','par2'),\n  ('id5','Sophia',18,TIMESTAMP '1970-01-01 00:00:05','par3'),\n  ('id6','Emma',20,TIMESTAMP '1970-01-01 00:00:06','par3'),\n  ('id7','Bob',44,TIMESTAMP '1970-01-01 00:00:07','par4'),\n  ('id8','Han',56,TIMESTAMP '1970-01-01 00:00:08','par4');\n"))),(0,i.yg)(l.A,{value:"dataStream",mdxType:"TabItem"},(0,i.yg)("p",null,"Creates a Flink Hudi table first and insert data into the Hudi table using DataStream API as below."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'import org.apache.flink.streaming.api.datastream.DataStream;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.table.data.RowData;\nimport org.apache.hudi.common.model.HoodieTableType;\nimport org.apache.hudi.configuration.FlinkOptions;\nimport org.apache.hudi.util.HoodiePipeline;\n\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nString targetTable = "t1";\nString basePath = "file:///tmp/t1";\n\nMap<String, String> options = new HashMap<>();\noptions.put(FlinkOptions.PATH.key(), basePath);\noptions.put(FlinkOptions.TABLE_TYPE.key(), HoodieTableType.MERGE_ON_READ.name());\noptions.put(FlinkOptions.PRECOMBINE_FIELD.key(), "ts");\n\nDataStream<RowData> dataStream = env.addSource(...);\nHoodiePipeline.Builder builder = HoodiePipeline.builder(targetTable)\n    .column("uuid VARCHAR(20)")\n    .column("name VARCHAR(10)")\n    .column("age INT")\n    .column("ts TIMESTAMP(3)")\n    .column("`partition` VARCHAR(20)")\n    .pk("uuid")\n    .partition("partition")\n    .options(options);\n\nbuilder.sink(dataStream, false); // The second parameter indicating whether the input data stream is bounded\nenv.execute("Api_Sink");\n')))),(0,i.yg)("h3",{id:"query-data"},"Query Data"),(0,i.yg)(r.A,{defaultValue:"flinksql",values:[{label:"Flink SQL",value:"flinksql"},{label:"DataStream API",value:"dataStream"}],mdxType:"Tabs"},(0,i.yg)(l.A,{value:"flinksql",mdxType:"TabItem"},(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"-- query from the Hudi table\nselect * from t1;\n"))),(0,i.yg)(l.A,{value:"dataStream",mdxType:"TabItem"},(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-java"},'import org.apache.flink.streaming.api.datastream.DataStream;\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\nimport org.apache.flink.table.data.RowData;\nimport org.apache.hudi.common.model.HoodieTableType;\nimport org.apache.hudi.configuration.FlinkOptions;\nimport org.apache.hudi.util.HoodiePipeline;\n\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\nString targetTable = "t1";\nString basePath = "file:///tmp/t1";\n\nMap<String, String> options = new HashMap<>();\noptions.put(FlinkOptions.PATH.key(), basePath);\noptions.put(FlinkOptions.TABLE_TYPE.key(), HoodieTableType.MERGE_ON_READ.name());\noptions.put(FlinkOptions.READ_AS_STREAMING.key(), "true"); // this option enable the streaming read\noptions.put(FlinkOptions.READ_START_COMMIT.key(), "\'20210316134557\'"); // specifies the start commit instant time\n    \nHoodiePipeline.Builder builder = HoodiePipeline.builder(targetTable)\n    .column("uuid VARCHAR(20)")\n    .column("name VARCHAR(10)")\n    .column("age INT")\n    .column("ts TIMESTAMP(3)")\n    .column("`partition` VARCHAR(20)")\n    .pk("uuid")\n    .partition("partition")\n    .options(options);\n\nDataStream<RowData> rowDataDataStream = builder.source(env);\nrowDataDataStream.print();\nenv.execute("Api_Source");\n')))),(0,i.yg)("p",null,"This statement queries snapshot view of the dataset.\nRefers to ",(0,i.yg)("a",{parentName:"p",href:"/docs/concepts#table-types--queries"},"Table types and queries")," for more info on all table types and query types supported."),(0,i.yg)("h3",{id:"update-data"},"Update Data"),(0,i.yg)("p",null,"This is similar to inserting new data."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"-- this would update the record with primary key 'id1'\n-- if the operation is defined as UPSERT\ninsert into t1 values\n  ('id1','Danny',27,TIMESTAMP '1970-01-01 00:00:01','par1');\n\n-- this would update the specific records with constant age 19,\n-- NOTE: only works for batch sql queries\nUPDATE t1 SET age=19 WHERE uuid in ('id1', 'id2');\n")),(0,i.yg)("p",null,"Notice that the save mode is now ",(0,i.yg)("inlineCode",{parentName:"p"},"Append"),". In general, always use append mode unless you are trying to create the table for the first time.\n",(0,i.yg)("a",{parentName:"p",href:"#query-data"},"Querying")," the data again will now show updated records. Each write operation generates a new ",(0,i.yg)("a",{parentName:"p",href:"/docs/concepts"},"commit"),"\ndenoted by the timestamp. Look for changes in ",(0,i.yg)("inlineCode",{parentName:"p"},"_hoodie_commit_time"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"age")," fields for the same ",(0,i.yg)("inlineCode",{parentName:"p"},"_hoodie_record_key"),"s in previous commit."),(0,i.yg)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.yg)("div",{parentName:"div",className:"admonition-heading"},(0,i.yg)("h5",{parentName:"div"},(0,i.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,i.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.yg)("div",{parentName:"div",className:"admonition-content"},(0,i.yg)("p",{parentName:"div"},"The ",(0,i.yg)("inlineCode",{parentName:"p"},"UPDATE")," statement is supported since Flink 1.17, so only Hudi Flink bundle compiled with Flink 1.17+ supplies this functionality.\nOnly ",(0,i.yg)("strong",{parentName:"p"},"batch")," queries on Hudi table with primary key work correctly. "))),(0,i.yg)("h3",{id:"streaming-query"},"Streaming Query"),(0,i.yg)("p",null,"Hudi Flink also provides capability to obtain a stream of records that changed since given commit timestamp.\nThis can be achieved using Hudi's streaming querying and providing a start time from which changes need to be streamed.\nWe do not need to specify endTime, if we want all changes after the given commit (as is the common case). "),(0,i.yg)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.yg)("div",{parentName:"div",className:"admonition-heading"},(0,i.yg)("h5",{parentName:"div"},(0,i.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,i.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.yg)("div",{parentName:"div",className:"admonition-content"},(0,i.yg)("p",{parentName:"div"},"The bundle jar with ",(0,i.yg)("strong",{parentName:"p"},"hive profile")," is needed for streaming query, by default the officially released flink bundle is built ",(0,i.yg)("strong",{parentName:"p"},"without"),"\n",(0,i.yg)("strong",{parentName:"p"},"hive profile"),", the jar needs to be built manually, see ",(0,i.yg)("a",{parentName:"p",href:"/docs/syncing_metastore#install"},"Build Flink Bundle Jar")," for more details."))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE t1(\n  uuid VARCHAR(20) PRIMARY KEY NOT ENFORCED,\n  name VARCHAR(10),\n  age INT,\n  ts TIMESTAMP(3),\n  `partition` VARCHAR(20)\n)\nPARTITIONED BY (`partition`)\nWITH (\n  'connector' = 'hudi',\n  'path' = '${path}',\n  'table.type' = 'MERGE_ON_READ',\n  'read.streaming.enabled' = 'true',  -- this option enable the streaming read\n  'read.start-commit' = '20210316134557', -- specifies the start commit instant time\n  'read.streaming.check-interval' = '4' -- specifies the check interval for finding new source commits, default 60s.\n);\n\n-- Then query the table in stream mode\nselect * from t1;\n")),(0,i.yg)("p",null,"This will give all changes that happened after the ",(0,i.yg)("inlineCode",{parentName:"p"},"read.start-commit")," commit. The unique thing about this\nfeature is that it now lets you author streaming pipelines on streaming or batch data source."),(0,i.yg)("h3",{id:"deletes"},"Delete Data"),(0,i.yg)("h4",{id:"row-level-delete"},"Row-level Delete"),(0,i.yg)("p",null,"When consuming data in streaming query, Hudi Flink source can also accept the change logs from the upstream data source if the ",(0,i.yg)("inlineCode",{parentName:"p"},"RowKind")," is set up per-row,\nit can then apply the UPDATE and DELETE in row level. You can then sync a NEAR-REAL-TIME snapshot on Hudi for all kinds\nof RDBMS."),(0,i.yg)("h4",{id:"batch-delete"},"Batch Delete"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-sql"},"-- delete all the records with age greater than 23\n-- NOTE: only works for batch sql queries\nDELETE FROM t1 WHERE age > 23;\n")),(0,i.yg)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.yg)("div",{parentName:"div",className:"admonition-heading"},(0,i.yg)("h5",{parentName:"div"},(0,i.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,i.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.yg)("div",{parentName:"div",className:"admonition-content"},(0,i.yg)("p",{parentName:"div"},"The ",(0,i.yg)("inlineCode",{parentName:"p"},"DELETE")," statement is supported since Flink 1.17, so only Hudi Flink bundle compiled with Flink 1.17+ supplies this functionality.\nOnly ",(0,i.yg)("strong",{parentName:"p"},"batch")," queries on Hudi table with primary key work correctly."))),(0,i.yg)("h2",{id:"where-to-go-from-here"},"Where To Go From Here?"),(0,i.yg)("p",null,"Check out the ",(0,i.yg)("a",{parentName:"p",href:"/docs/flink_tuning"},"Flink Setup")," how-to page for deeper dive into configuration settings. "),(0,i.yg)("p",null,"If you are relatively new to Apache Hudi, it is important to be familiar with a few core concepts:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"/docs/timeline"},"Hudi Timeline")," \u2013 How Hudi manages transactions and other table services"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"/docs/file_layouts"},"Hudi File Layout")," - How the files are laid out on storage"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"/docs/table_types"},"Hudi Table Types")," \u2013 ",(0,i.yg)("inlineCode",{parentName:"li"},"COPY_ON_WRITE")," and ",(0,i.yg)("inlineCode",{parentName:"li"},"MERGE_ON_READ")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("a",{parentName:"li",href:"/docs/table_types#query-types"},"Hudi Query Types")," \u2013 Snapshot Queries, Incremental Queries, Read-Optimized Queries")),(0,i.yg)("p",null,'See more in the "Concepts" section of the docs.'),(0,i.yg)("p",null,"Take a look at recent ",(0,i.yg)("a",{parentName:"p",href:"/blog"},"blog posts")," that go in depth on certain topics or use cases."),(0,i.yg)("p",null,"Hudi tables can be queried from query engines like Hive, Spark, Flink, Presto and much more. We have put together a\n",(0,i.yg)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=VhNgUsxdrD0"},"demo video")," that show cases all of this on a docker based setup with all\ndependent systems running locally. We recommend you replicate the same setup and run the demo yourself, by following\nsteps ",(0,i.yg)("a",{parentName:"p",href:"/docs/docker_demo"},"here")," to get a taste for it. Also, if you are looking for ways to migrate your existing data\nto Hudi, refer to ",(0,i.yg)("a",{parentName:"p",href:"/docs/migration_guide"},"migration guide"),"."))}g.isMDXComponent=!0}}]);