<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Change Data Capture with Debezium and Apache Hudi | Apache Hudi</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="apache hudi, data lake, lakehouse, big data, apache spark, apache flink, presto, trino, analytics, data engineering"><meta data-rh="true" property="og:title" content="Change Data Capture with Debezium and Apache Hudi | Apache Hudi"><meta data-rh="true" name="description" content="As of Hudi v0.10.0, we are excited to announce the availability of Debezium sources for Deltastreamer that provide the ingestion of change capture data (CDC) from Postgres and Mysql databases to your data lake. For more details, please refer to the original RFC."><meta data-rh="true" property="og:description" content="As of Hudi v0.10.0, we are excited to announce the availability of Debezium sources for Deltastreamer that provide the ingestion of change capture data (CDC) from Postgres and Mysql databases to your data lake. For more details, please refer to the original RFC."><meta data-rh="true" property="og:image" content="https://hudi.apache.org/assets/images/blog/debezium.png"><meta data-rh="true" name="twitter:image" content="https://hudi.apache.org/assets/images/blog/debezium.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-14T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="design,deltastreamer,cdc,change data capture,apache hudi"><link data-rh="true" rel="icon" href="/assets/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi" hreflang="en"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi","mainEntityOfPage":"https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi","url":"https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi","headline":"Change Data Capture with Debezium and Apache Hudi","name":"Change Data Capture with Debezium and Apache Hudi","description":"As of Hudi v0.10.0, we are excited to announce the availability of Debezium sources for Deltastreamer that provide the ingestion of change capture data (CDC) from Postgres and Mysql databases to your data lake. For more details, please refer to the original RFC.","datePublished":"2022-01-14T00:00:00.000Z","author":{"@type":"Person","name":"Rajesh Mahindra"},"image":{"@type":"ImageObject","@id":"https://hudi.apache.org/assets/images/blog/debezium.png","url":"https://hudi.apache.org/assets/images/blog/debezium.png","contentUrl":"https://hudi.apache.org/assets/images/blog/debezium.png","caption":"title image for the blog post: Change Data Capture with Debezium and Apache Hudi"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://hudi.apache.org/blog","name":"Blogs List Page"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Hudi: User-Facing Analytics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Hudi: User-Facing Analytics Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Hudi: User-Facing Analytics JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/videos/rss.xml" title="Apache Hudi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/videos/atom.xml" title="Apache Hudi Atom Feed">





<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="9e4444ba-93cc-45ea-b143-783ae0fbeb6f" data-project-name="Apache Hudi" data-project-color="#FFFFFF" data-project-logo="/assets/images/logo-big.png" data-modal-disclaimer="This AI assistant answers Apache Hudi questions using your [documentation](https://hudi.apache.org/docs/quick-start-guide/), [dev setup](https://hudi.apache.org/contribute/developer-setup/), the [tech specs](https://hudi.apache.org/tech-specs-1point0/) and [open GitHub Issues](https://github.com/apache/hudi/issues/) from the last year." data-modal-title="Apache Hudi AI Assistant" data-modal-example-questions-title="Try asking me..." data-modal-example-questions="How can I convert an existing COW table to MOR?,How do I set up incremental queries with Hudi tables?" data-modal-image="/assets/images/logo-small.png" data-modal-image-ask-ai="/assets/images/logo-small.png" data-modal-header-min-height="64px" data-modal-image-height="44" data-modal-image-width="64" data-modal-header-bg-color="#f8f9fa" data-modal-title-color="#15467D" data-button-text-color="#29557a" data-button-text="Ask AI" data-consent-required="true" data-consent-screen-title="Help us improve our AI assistant" data-consent-screen-disclaimer="By clicking &amp;quot;Allow tracking&amp;quot;, you consent to the use of the AI assistant in accordance with kapa.ai&#39;s [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google&#39;s [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai&#39;s and Google&#39;s privacy policies." data-consent-screen-accept-button-text="Allow tracking" data-modal-disclaimer-font-size="0.80rem" data-query-input-placeholder-text-color="#29557a" data-submit-query-button-bg-color="#228EDE" data-query-input-text-color="#29557a" data-user-analytics-cookie-enabled="false" data-query-input-border-color="#211b0e" data-question-text-color="#0db1f9" data-answer-text-color="#000" data-thread-clear-button-bg-color="#000000" data-thread-clear-button-text-color="#FFFFFF" data-answer-feedback-button-bg-color="#000000" data-answer-feedback-button-text-color="#FFFFFF" data-answer-feedback-button-active-bg-color="#000000" data-answer-feedback-button-active-text-color="#FFFFFF" data-answer-copy-button-bg-color="#000000" data-answer-copy-button-text-color="#FFFFFF" data-example-question-button-text-color="#29557a" data-modal-disclaimer-bg-color="#f8f9fa" data-modal-disclaimer-text-color="#15467D" data-deep-thinking-button-bg-color="#228EDE" data-deep-thinking-button-text-color="#FFFFFF" data-deep-thinking-button-active-bg-color="#205792" data-deep-thinking-button-hover-bg-color="#0478C0" data-deep-thinking-button-active-hover-bg-color="#205792" data-deep-thinking-button-active-text-color="#FFFFFF" async></script><link rel="stylesheet" href="/assets/css/styles.abb0228d.css">
<script src="/assets/js/runtime~main.c416d8f2.js" defer="defer"></script>
<script src="/assets/js/main.b9bb4d8f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" role="banner"><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like <b>Apache Hudi</b>, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi"><b>GitHub!<svg xmlns="http://www.w3.org/2000/svg\" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 -2 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></b></a> ⭐</div></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarWrapper_j_uY"><div class="navbar__inner navbarInnerStyle_KoMw"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo navbarLogo_aghy"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/overview">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/learn/tutorial-series">Tutorial Series</a></li><li><a class="dropdown__link" href="/learn/blog">Blogs</a></li><li><a class="dropdown__link" href="/learn/talks">Talks</a></li><li><a class="dropdown__link" href="/learn/videos">Video Guides</a></li><li><a class="dropdown__link" href="/learn/faq">FAQ</a></li><li><a class="dropdown__link" href="/learn/tech-specs">Tech Specs</a></li><li><a class="dropdown__link" href="/learn/tech-specs-1point0">Tech Specs 1.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute/developer-sync-call">Developer Sync Call</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/contribute/security">Security</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/syncs">Community Syncs</a></li><li><a class="dropdown__link" href="/community/office_hours">Office Hours</a></li><li><a class="dropdown__link" href="/community/team">Team</a></li><li><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Github<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="dropdown__link">Slack<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.linkedin.com/company/apache-hudi/" target="_blank" rel="noopener noreferrer" class="dropdown__link">LinkedIn<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.youtube.com/@apachehudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">YouTube<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://x.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">X<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Ecosystem</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/powered-by">Adopters</a></li><li><a class="dropdown__link" href="/roadmap">Roadmap</a></li><li><a class="dropdown__link" href="/ecosystem">Integrations</a></li></ul></div><a class="navbar__item navbar__link" href="/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div><div role="button" class="searchButton_o6KI" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 14 14"><circle cx="6.864" cy="6.864" r="5.243" stroke="#15467D" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></circle><path stroke="#15467D" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m10.51 10.783 2.056 2.05"></path></svg></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar navbarSideMenu_TODO"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><div class="navbar__logo navbarLogo_aghy"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><button type="button" aria-label="Close navigation bar" class="clean-btn navbar-sidebar__close"><svg viewBox="0 0 15 15" width="21" height="21"><g stroke="var(--ifm-color-emphasis-600)" stroke-width="1.2"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><div class="navbar-sidebar__items"><div class="navbar-sidebar__item menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/docs/overview">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Learn</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Contribute</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Community</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Ecosystem</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/releases/download">Download</a></li></ul></div><div class="navbar-sidebar__item menu"><button type="button" class="clean-btn navbar-sidebar__back">← Back to main menu</button></div></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-2" itemscope="" itemtype="http://schema.org/Blog"><article class=""><header><h1 class="title_xvU1">Change Data Capture with Debezium and Apache Hudi</h1><div class="container_iJTo margin-vert--sm"><time datetime="2022-01-14T00:00:00.000Z">January 14, 2022</time><div class="row"><div class="authorWrapper_ApDF col col--12 authorCol_q4o9">Rajesh Mahindra</div></div><span class="marker_H0Am">10 min read</span></div><div class="row tagsListInline margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/design">design</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/deltastreamer">deltastreamer</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/cdc">cdc</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/change-data-capture">change data capture</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/apache-hudi">apache hudi</a></li></ul></div></div></header><div id="__blog-post-container" class="markdown"><p>As of Hudi v0.10.0, we are excited to announce the availability of <a href="https://debezium.io/" target="_blank" rel="noopener noreferrer" class="">Debezium</a> sources for <a href="https://hudi.apache.org/docs/hoodie_streaming_ingestion" target="_blank" rel="noopener noreferrer" class="">Deltastreamer</a> that provide the ingestion of change capture data (CDC) from Postgres and Mysql databases to your data lake. For more details, please refer to the original <a href="https://github.com/apache/hudi/blob/master/rfc/rfc-39/rfc-39.md" target="_blank" rel="noopener noreferrer" class="">RFC</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background" translate="no">​</a></h2>
<img src="/assets/images/blog/data-network.png" alt="drawing" width="600">
<p>When you want to perform analytics on data from transactional databases like Postgres or Mysql you typically need to bring this data into an OLAP system such as a data warehouse or a data lake through a process called <a href="https://debezium.io/documentation/faq/#what_is_change_data_capture" target="_blank" rel="noopener noreferrer" class="">Change Data Capture</a> (CDC). Debezium is a popular tool that makes CDC easy. It provides a way to capture row-level changes in your databases by <a href="https://debezium.io/blog/2018/07/19/advantages-of-log-based-change-data-capture/" target="_blank" rel="noopener noreferrer" class="">reading changelogs</a>. By doing so, Debezium avoids increased CPU load on your database and ensures you capture all changes including deletes.</p>
<p>Now that <a href="https://hudi.apache.org/docs/overview/" target="_blank" rel="noopener noreferrer" class="">Apache Hudi</a> offers a Debezium source connector, CDC ingestion into a data lake is easier than ever with some <a href="https://hudi.apache.org/docs/use_cases" target="_blank" rel="noopener noreferrer" class="">unique differentiated capabilities</a>. Hudi enables efficient update, merge, and delete transactions on a data lake. Hudi uniquely provides <a href="https://hudi.apache.org/docs/table_types#merge-on-read-table" target="_blank" rel="noopener noreferrer" class="">Merge-On-Read</a> writers which unlock <a href="https://aws.amazon.com/blogs/big-data/how-amazon-transportation-service-enabled-near-real-time-event-analytics-at-petabyte-scale-using-aws-glue-with-apache-hudi/" target="_blank" rel="noopener noreferrer" class="">significantly lower latency</a> ingestion than typical data lake writers with Spark or Flink. Last but not least, Apache Hudi offers <a href="https://hudi.apache.org/docs/querying_data#spark-incr-query" target="_blank" rel="noopener noreferrer" class="">incremental queries</a> so after capturing changes from your database, you can incrementally process these changes downstream throughout all of your subsequent ETL pipelines.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="design-overview">Design Overview<a href="#design-overview" class="hash-link" aria-label="Direct link to Design Overview" title="Direct link to Design Overview" translate="no">​</a></h2>
<img src="/assets/images/blog/debezium.png" alt="drawing" width="600">
<p>The architecture for an end-to-end CDC ingestion flow with Apache Hudi is shown above. The first component is the Debezium deployment, which consists of a Kafka cluster, schema registry (Confluent or Apicurio), and the Debezium connector. The Debezium connector continuously polls the changelogs from the database and writes an AVRO message with the changes for each database row to a dedicated Kafka topic per table.</p>
<p>The second component is <a href="https://hudi.apache.org/docs/hoodie_streaming_ingestion" target="_blank" rel="noopener noreferrer" class="">Hudi Deltastreamer</a> that reads and processes the incoming Debezium records from Kafka for each table and writes (updates) the corresponding rows in a Hudi table on your cloud storage.</p>
<p>To ingest the data from the database table into a Hudi table in near real-time, we implement two classes that can be plugged into the Deltastreamer. Firstly, we implemented a <a href="https://github.com/apache/hudi/blob/83f8ed2ae3ba7fb20813cbb8768deae6244b020c/hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/debezium/DebeziumSource.java" target="_blank" rel="noopener noreferrer" class="">Debezium source</a>. With Deltastreamer running in continuous mode, the source continuously reads and processes the Debezium change records in Avro format from the Kafka topic for a given table, and writes the updated record to the destination Hudi table. In addition to the columns from the database table, we also ingest some meta fields that are added by Debezium in the target Hudi table. The meta fields help us correctly merge updates and delete records. The records are read using the latest schema from the <a href="https://hudi.apache.org/docs/hoodie_streaming_ingestion#schema-providers" target="_blank" rel="noopener noreferrer" class="">Schema Registry</a>.</p>
<p>Secondly, we implement a custom <a href="https://github.com/apache/hudi/blob/83f8ed2ae3ba7fb20813cbb8768deae6244b020c/hudi-common/src/main/java/org/apache/hudi/common/model/debezium/AbstractDebeziumAvroPayload.java" target="_blank" rel="noopener noreferrer" class="">Debezium Payload</a> that essentially governs how Hudi records are merged when the same row is updated or deleted. When a new Hudi record is received for an existing row, the payload picks the latest record using the higher value of the appropriate column (FILEID and POS fields in MySql and LSN fields in Postgres). In the case that the latter event is a delete record, the payload implementation ensures that the record is hard deleted from the storage. Delete records are identified using the op field, which has a value of <strong>d</strong> for deletes.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="apache-hudi-configurations">Apache Hudi Configurations<a href="#apache-hudi-configurations" class="hash-link" aria-label="Direct link to Apache Hudi Configurations" title="Direct link to Apache Hudi Configurations" translate="no">​</a></h2>
<p>It is important to consider the following configurations of your Hudi deployments when using the Debezium source connector for CDC ingestion.</p>
<ol>
<li class=""><strong>Record Keys -</strong> The Hudi <a href="https://hudi.apache.org/docs/next/indexing" target="_blank" rel="noopener noreferrer" class="">record key(s)</a> for a table should be set as the Primary keys of the table in the upstream database. This ensures that updates are applied correctly as record key(s) uniquely identify a row in the Hudi table.</li>
<li class=""><strong>Source Ordering Fields</strong> -  For de-duplication of changelog records the source ordering field should be set to the actual position of the change event as it happened on the database. For instance, we use the FILEID and POS fields in MySql and LSN fields in Postgres databases respectively to ensure records are processed in the correct order of occurrence in the original database.</li>
<li class=""><strong>Partition Fields</strong> - Don’t feel restricted to matching the partitioning of your Hudi tables with the same partition fields as the upstream database. You can set partition fields independently for the Hudi table as needed.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="bootstrapping-existing-tables">Bootstrapping Existing tables<a href="#bootstrapping-existing-tables" class="hash-link" aria-label="Direct link to Bootstrapping Existing tables" title="Direct link to Bootstrapping Existing tables" translate="no">​</a></h3>
<p>One important use case might be when CDC ingestion has to be done for existing database tables. There are two ways we can ingest existing database data prior to streaming the changes:</p>
<ol>
<li class="">By default on initialization, Debezium performs an initial consistent snapshot of the database (controlled by config snapshot.mode). After the initial snapshot, it continues streaming updates from the correct position to avoid loss of data.</li>
<li class="">While the first approach is simple, for large tables it may take a long time for Debezium to bootstrap the initial snapshot. Alternatively, we could run a Deltastreamer job to bootstrap the table directly from the database using the <a href="https://github.com/apache/hudi/blob/master/hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/JdbcSource.java" target="_blank" rel="noopener noreferrer" class="">JDBC source</a>. This provides more flexibility to the users in defining and executing more optimized SQL queries required to bootstrap the database table. Once the bootstrap job finishes successfully, another Deltastreamer job is executed that processes the database changelogs from Debezium. Users will have to use <a href="https://hudi.apache.org/docs/hoodie_streaming_ingestion/#checkpointing" target="_blank" rel="noopener noreferrer" class="">checkpointing</a> in Deltastreamer to ensure the second job starts processing the changelogs from the correct position to avoid data loss.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-implementation">Example Implementation<a href="#example-implementation" class="hash-link" aria-label="Direct link to Example Implementation" title="Direct link to Example Implementation" translate="no">​</a></h3>
<p>The following describes steps to implement an end-to-end CDC pipeline using an AWS RDS instance of Postgres, Kubernetes-based Debezium deployment, and Hudi Deltastreamer running on a spark cluster.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="database">Database<a href="#database" class="hash-link" aria-label="Direct link to Database" title="Direct link to Database" translate="no">​</a></h3>
<p>A few configuration changes are required for the RDS instance to enable logical replication.</p>
<div class="language-roomsql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-roomsql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SET rds.logical_replication to 1 (instead of 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">psql --host=&lt;aws_rds_instance&gt; --port=5432 --username=postgres --password -d &lt;database_name&gt;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE PUBLICATION &lt;publication_name&gt; FOR TABLE schema1.table1, schema1.table2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE schema1.table1 REPLICA IDENTITY FULL;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="debezium-connector">Debezium Connector<a href="#debezium-connector" class="hash-link" aria-label="Direct link to Debezium Connector" title="Direct link to Debezium Connector" translate="no">​</a></h3>
<p><a href="https://strimzi.io/blog/2020/01/27/deploying-debezium-with-kafkaconnector-resource/" target="_blank" rel="noopener noreferrer" class="">Strimzi</a> is the recommended option to deploy and manage Kafka connectors on Kubernetes clusters. Alternatively, you have the option to use the Confluent managed <a href="https://docs.confluent.io/debezium-connect-postgres-source/current/overview.html" target="_blank" rel="noopener noreferrer" class="">Debezium connector</a>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl create namespace kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl create -f https://strimzi.io/install/latest?namespace=kafka -n kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl -n kafka apply -f kafka-connector.yaml</span><br></span></code></pre></div></div>
<p>An example for kafka-connector.yaml is shown below:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kafka.strimzi.io/v1beta2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> KafkaConnect</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">strimzi.io/use-connector-resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">bootstrapServers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">config.storage.replication.factor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">offset.storage.replication.factor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">status.storage.replication.factor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><br></span></code></pre></div></div>
<p>The docker image debezium-kafka-connect can be built using the following Dockerfile that includes the Postgres Debezium Connector.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM confluentinc/cp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">6.2.0 as cp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN confluent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">hub install </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">no</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">prompt confluentinc/kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">avro</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">converter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">6.2.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM strimzi/kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">0.18.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">2.5.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">USER root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN yum </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">y update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN yum </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">y install git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN yum </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">y install wget</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN wget https</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//repo1.maven.org/maven2/io/debezium/debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres/1.6.1.Final/debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">1.6.1.Final</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">plugin.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN tar xzf debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">1.6.1.Final</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">plugin.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN mkdir </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">p /opt/kafka/plugins/debezium </span><span class="token important">&amp;&amp;</span><span class="token plain"> mkdir </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">p /opt/kafka/plugins/avro/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN mv debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres /opt/kafka/plugins/debezium/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">from=cp /usr/share/confluent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">hub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">components/confluentinc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">avro</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">converter/lib /opt/kafka/plugins/avro/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">USER 1001</span><br></span></code></pre></div></div>
<p>Once the Strimzi operator and the Kafka connect are deployed, we can start the Debezium connector.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -X POST -H &quot;Content-Type:application/json&quot; -d @connect-source.json http://localhost:8083/connectors/</span><br></span></code></pre></div></div>
<p>The following is an example of a configuration to setup Debezium connector for generating the changelogs for two tables, table1, and table2.</p>
<p>Contents of connect-source.json:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres-debezium-connector&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;config&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;connector.class&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;io.debezium.connector.postgresql.PostgresConnector&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.hostname&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.port&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;5432&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.user&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.password&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.dbname&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;database&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;plugin.name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pgoutput&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.server.name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;table.include.list&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;schema1.table1,schema1.table2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;publication.autocreate.mode&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;filtered&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;tombstones.on.delete&quot;</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;false&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;key.converter&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;io.confluent.connect.avro.AvroConverter&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;key.converter.schema.registry.url&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;schema_registry_host&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;value.converter&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;io.confluent.connect.avro.AvroConverter&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;value.converter.schema.registry.url&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;schema_registry_host&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;slot.name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pgslot&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="hudi-deltastreamer">Hudi Deltastreamer<a href="#hudi-deltastreamer" class="hash-link" aria-label="Direct link to Hudi Deltastreamer" title="Direct link to Hudi Deltastreamer" translate="no">​</a></h3>
<p>Next, we run the Hudi Deltastreamer using spark that will ingest the Debezium changelogs from kafka and write them as a Hudi table. One such instance of the command is shown below that works for Postgres database.  A few key configurations are as follows:</p>
<ol>
<li class="">Set the source class to PostgresDebeziumSource.</li>
<li class="">Set the payload class to PostgresDebeziumAvroPayload.</li>
<li class="">Configure the schema registry URLs for Debezium Source and Kafka Source.</li>
<li class="">Set the record key(s) as the primary key(s) of the database table.</li>
<li class="">Set the source ordering field (dedup) to _event_lsn</li>
</ol>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark-submit \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --jars &quot;/home/hadoop/hudi-utilities-bundle_2.12-0.10.0.jar,/usr/lib/spark/external/lib/spark-avro.jar&quot; \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --master yarn --deploy-mode client \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer /home/hadoop/hudi-packages/hudi-utilities-bundle_2.12-0.10.0-SNAPSHOT.jar \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --table-type COPY_ON_WRITE --op UPSERT \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --target-base-path s3://bucket_name/path/for/hudi_table1 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --target-table hudi_table1  --continuous \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --min-sync-interval-seconds 60 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --source-class org.apache.hudi.utilities.sources.debezium.PostgresDebeziumSource \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --source-ordering-field _event_lsn \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --payload-class org.apache.hudi.common.model.debezium.PostgresDebeziumAvroPayload \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf schema.registry.url=https://localhost:8081 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.deltastreamer.schemaprovider.registry.url=https://localhost:8081/subjects/postgres.schema1.table1-value/versions/latest \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.deltastreamer.source.kafka.value.deserializer.class=io.confluent.kafka.serializers.KafkaAvroDeserializer \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.deltastreamer.source.kafka.topic=postgres.schema1.table1 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf auto.offset.reset=earliest \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.write.recordkey.field=”database_primary_key” \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.write.partitionpath.field=partition_key \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --enable-hive-sync \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.partition_extractor_class=org.apache.hudi.hive.MultiPartKeysValueExtractor \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.write.hive_style_partitioning=true \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.database=default \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.table=hudi_table1 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.partition_fields=partition_key</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>This post introduced the Debezium Source for Hudi Deltastreamer to ingest Debezium changelogs into Hudi tables. Database data can now be ingested into data lakes to provide a cost-effective way to store and analyze database data.</p>
<p>Please follow this <a href="https://issues.apache.org/jira/browse/HUDI-1290" target="_blank" rel="noopener noreferrer" class="">JIRA</a> to learn more about active development on this new feature. I look forward to more contributions and feedback from the community. Come join our <a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" style="font-style:normal" target="_blank" rel="noopener noreferrer">Hudi Slack</a> channel or attend one of our <a href="https://hudi.apache.org/community/syncs" target="_blank" rel="noopener noreferrer" class="">community events</a> to learn more.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/apache/hudi/edit/asf-site/website/blog/blog/2022-01-14-change-data-capture-with-debezium-and-apache-hudi.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2022/01/18/Why-and-How-I-Integrated-Airbyte-and-Apache-Hudi"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Why and How I Integrated Airbyte and Apache Hudi</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2022/01/06/apache-hudi-2021-a-year-in-review"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Apache Hudi - 2021 a Year in Review</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#design-overview" class="table-of-contents__link toc-highlight">Design Overview</a></li><li><a href="#apache-hudi-configurations" class="table-of-contents__link toc-highlight">Apache Hudi Configurations</a><ul><li><a href="#bootstrapping-existing-tables" class="table-of-contents__link toc-highlight">Bootstrapping Existing tables</a></li><li><a href="#example-implementation" class="table-of-contents__link toc-highlight">Example Implementation</a></li><li><a href="#database" class="table-of-contents__link toc-highlight">Database</a></li><li><a href="#debezium-connector" class="table-of-contents__link toc-highlight">Debezium Connector</a></li><li><a href="#hudi-deltastreamer" class="table-of-contents__link toc-highlight">Hudi Deltastreamer</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footerCustom_j_zv"><div class="container container-fluid container_y1z5"><div class="brand_kMBW"><a href="https://hudi.apache.org/" rel="noopener noreferrer" class="footerLogoLink_DDai"><img src="/assets/images/hudi.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="links_AXCu"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/community/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/release-1.1.1">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/powered-by">Adopters</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/tutorial-series">Tutorial Series</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/talks">Talks</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/videos">Video Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/faq">FAQ</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ibm_cos_hoodie">IBM Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oci_hoodie">Oracle Cloud</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/apache-hudi/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Apache</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a class="footer__link-item" href="/asf/privacy">Privacy</a></li><li class="footer__item"><a class="footer__link-item" href="/asf/telemetry">Telemetry</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div></div><div class="legal_MFbX"><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>. Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=8f594acf-9b77-44fb-9475-3e82ead1910c"><img referrerpolicy="no-referrer-when-downgrade" src="https://analytics.apache.org/matomo.php?idsite=47&amp;rec=1"></div></div></div></footer></div>
</body>
</html>