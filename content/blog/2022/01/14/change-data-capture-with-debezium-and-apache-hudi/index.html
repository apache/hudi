<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Hudi: User-Facing Analytics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Hudi: User-Facing Analytics Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Hudi: User-Facing Analytics JSON Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css"><title data-react-helmet="true">Change Data Capture with Debezium and Apache Hudi | Apache Hudi</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="keywords" content="apache hudi, data lake, lakehouse, big data, apache spark, apache flink, presto, trino, analytics, data engineering"><meta data-react-helmet="true" property="og:title" content="Change Data Capture with Debezium and Apache Hudi | Apache Hudi"><meta data-react-helmet="true" name="description" content="As of Hudi v0.10.0, we are excited to announce the availability of Debezium sources for Deltastreamer that provide the ingestion of change capture data (CDC) from Postgres and Mysql databases to your data lake. For more details, please refer to the original RFC."><meta data-react-helmet="true" property="og:description" content="As of Hudi v0.10.0, we are excited to announce the availability of Debezium sources for Deltastreamer that provide the ingestion of change capture data (CDC) from Postgres and Mysql databases to your data lake. For more details, please refer to the original RFC."><meta data-react-helmet="true" property="og:image" content="https://hudi.apache.org/assets/images/blog/debezium.png"><meta data-react-helmet="true" name="twitter:image" content="https://hudi.apache.org/assets/images/blog/debezium.png"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-01-14T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="design,deltastreamer,cdc,change-data-capture,apache hudi"><link data-react-helmet="true" rel="icon" href="/assets/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/cn/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi" hreflang="cn"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.635c4f43.css">
<link rel="preload" href="/assets/js/runtime~main.f7a2b524.js" as="script">
<link rel="preload" href="/assets/js/main.21e8aaca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">⭐️ If you like Apache Hudi, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi">GitHub</a>! ⭐</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/docs/overview">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/talks">Talks</a></li><li><a class="dropdown__link" href="/docs/faq">FAQ</a></li><li><a class="dropdown__link" href="/tech-specs">Tech Specs</a></li><li><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Technical Wiki<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/contribute/report-security-issues">Report Security Issues</a></li><li><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Report Issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/syncs">Community Syncs</a></li><li><a class="dropdown__link" href="/community/office_hours">Office Hours</a></li><li><a class="dropdown__link" href="/community/team">Team</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/powered-by">Who&#x27;s Using</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs/overview">0.12.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/overview">Current</a></li><li><a class="dropdown__link" href="/docs/overview">0.12.1</a></li><li><a class="dropdown__link" href="/docs/0.12.0/overview">0.12.0</a></li><li><a class="dropdown__link" href="/docs/0.11.1/overview">0.11.1</a></li><li><a class="dropdown__link" href="/docs/0.11.0/overview">0.11.0</a></li><li><a class="dropdown__link" href="/docs/0.10.1/overview">0.10.1</a></li><li><a class="dropdown__link" href="/docs/0.10.0/overview">0.10.0</a></li><li><a class="dropdown__link" href="/docs/0.9.0/overview">0.9.0</a></li><li><a class="dropdown__link" href="/docs/0.8.0/overview">0.8.0</a></li><li><a class="dropdown__link" href="/docs/0.7.0/overview">0.7.0</a></li><li><a class="dropdown__link" href="/docs/0.6.0/quick-start-guide">0.6.0</a></li><li><a class="dropdown__link" href="/docs/0.5.3/quick-start-guide">0.5.3</a></li><li><a class="dropdown__link" href="/docs/0.5.2/quick-start-guide">0.5.2</a></li><li><a class="dropdown__link" href="/docs/0.5.1/quick-start-guide">0.5.1</a></li><li><a class="dropdown__link" href="/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/cn/blog/2022/01/14/change-data-capture-with-debezium-and-apache-hudi" target="_self" rel="noopener noreferrer" class="dropdown__link">Chinese</a></li></ul></div><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter-link" aria-label="Hudi Twitter Handle"></a><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-1e94d3xro-JvlNO1kSeIHJBTVfLPlI5w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Hudi Slack Channel"></a><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-youtube-link" aria-label="Hudi YouTube Channel"></a><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-2" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header class="postHeader_Ipb1"><div><h1 class="blogPostTitle_RC3s" itemprop="headline"><h1 class="blogPostPageTitle_bKZt" itemprop="headline">Change Data Capture with Debezium and Apache Hudi</h1></h1><div class="blogInfo_1FPd margin-top--sm margin-bottom--sm"><div class="blogPostText_jBA8 row"><time datetime="2022-01-14T00:00:00.000Z" itemprop="datePublished">January 14, 2022</time><div><div class="avatar"><div><a itemprop="url"><span class="blogPostAuthorsList_dlEG" itemprop="name">Rajesh Mahindra</span></a></div></div></div></div><div class="blogPostData_A2Le">8 min read</div></div></div><ul class="authorTimeTags_oN88 padding--none margin-left--sm tagsWrapperPostPage_VdId"><li class="tag_MgfY tagPostPage_gnvv"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/design">design</a></li><li class="tag_MgfY tagPostPage_gnvv"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/deltastreamer">deltastreamer</a></li><li class="tag_MgfY tagPostPage_gnvv"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/cdc">cdc</a></li><li class="tag_MgfY tagPostPage_gnvv"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/change-data-capture">change-data-capture</a></li><li class="tag_MgfY tagPostPage_gnvv"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/apache-hudi">apache hudi</a></li></ul></header><div class="markdown" itemprop="articleBody"><p>As of Hudi v0.10.0, we are excited to announce the availability of <a href="https://debezium.io/" target="_blank" rel="noopener noreferrer">Debezium</a> sources for <a href="https://hudi.apache.org/docs/hoodie_deltastreamer" target="_blank" rel="noopener noreferrer">Deltastreamer</a> that provide the ingestion of change capture data (CDC) from Postgres and Mysql databases to your data lake. For more details, please refer to the original <a href="https://github.com/apache/hudi/blob/master/rfc/rfc-39/rfc-39.md" target="_blank" rel="noopener noreferrer">RFC</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="background">Background<a class="hash-link" href="#background" title="Direct link to heading">​</a></h2><img src="/assets/images/blog/data-network.png" alt="drawing" width="600"><p>When you want to perform analytics on data from transactional databases like Postgres or Mysql you typically need to bring this data into an OLAP system such as a data warehouse or a data lake through a process called <a href="https://debezium.io/documentation/faq/#what_is_change_data_capture" target="_blank" rel="noopener noreferrer">Change Data Capture</a> (CDC). Debezium is a popular tool that makes CDC easy. It provides a way to capture row-level changes in your databases by <a href="https://debezium.io/blog/2018/07/19/advantages-of-log-based-change-data-capture/" target="_blank" rel="noopener noreferrer">reading changelogs</a>. By doing so, Debezium avoids increased CPU load on your database and ensures you capture all changes including deletes.</p><p>Now that <a href="https://hudi.apache.org/docs/overview/" target="_blank" rel="noopener noreferrer">Apache Hudi</a> offers a Debezium source connector, CDC ingestion into a data lake is easier than ever with some <a href="https://hudi.apache.org/docs/use_cases" target="_blank" rel="noopener noreferrer">unique differentiated capabilities</a>. Hudi enables efficient update, merge, and delete transactions on a data lake. Hudi uniquely provides <a href="https://hudi.apache.org/docs/table_types#merge-on-read-table" target="_blank" rel="noopener noreferrer">Merge-On-Read</a> writers which unlock <a href="https://aws.amazon.com/blogs/big-data/how-amazon-transportation-service-enabled-near-real-time-event-analytics-at-petabyte-scale-using-aws-glue-with-apache-hudi/" target="_blank" rel="noopener noreferrer">significantly lower latency</a> ingestion than typical data lake writers with Spark or Flink. Last but not least, Apache Hudi offers <a href="https://hudi.apache.org/docs/querying_data#spark-incr-query" target="_blank" rel="noopener noreferrer">incremental queries</a> so after capturing changes from your database, you can incrementally process these changes downstream throughout all of your subsequent ETL pipelines.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="design-overview">Design Overview<a class="hash-link" href="#design-overview" title="Direct link to heading">​</a></h2><img src="/assets/images/blog/debezium.png" alt="drawing" width="600"><p>The architecture for an end-to-end CDC ingestion flow with Apache Hudi is shown above. The first component is the Debezium deployment, which consists of a Kafka cluster, schema registry (Confluent or Apicurio), and the Debezium connector. The Debezium connector continuously polls the changelogs from the database and writes an AVRO message with the changes for each database row to a dedicated Kafka topic per table.</p><p>The second component is <a href="https://hudi.apache.org/docs/hoodie_deltastreamer" target="_blank" rel="noopener noreferrer">Hudi Deltastreamer</a> that reads and processes the incoming Debezium records from Kafka for each table and writes (updates) the corresponding rows in a Hudi table on your cloud storage.</p><p>To ingest the data from the database table into a Hudi table in near real-time, we implement two classes that can be plugged into the Deltastreamer. Firstly, we implemented a <a href="https://github.com/apache/hudi/blob/83f8ed2ae3ba7fb20813cbb8768deae6244b020c/hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/debezium/DebeziumSource.java" target="_blank" rel="noopener noreferrer">Debezium source</a>. With Deltastreamer running in continuous mode, the source continuously reads and processes the Debezium change records in Avro format from the Kafka topic for a given table, and writes the updated record to the destination Hudi table. In addition to the columns from the database table, we also ingest some meta fields that are added by Debezium in the target Hudi table. The meta fields help us correctly merge updates and delete records. The records are read using the latest schema from the <a href="https://hudi.apache.org/docs/hoodie_deltastreamer#schema-providers" target="_blank" rel="noopener noreferrer">Schema Registry</a>.</p><p>Secondly, we implement a custom <a href="https://github.com/apache/hudi/blob/83f8ed2ae3ba7fb20813cbb8768deae6244b020c/hudi-common/src/main/java/org/apache/hudi/common/model/debezium/AbstractDebeziumAvroPayload.java" target="_blank" rel="noopener noreferrer">Debezium Payload</a> that essentially governs how Hudi records are merged when the same row is updated or deleted. When a new Hudi record is received for an existing row, the payload picks the latest record using the higher value of the appropriate column (FILEID and POS fields in MySql and LSN fields in Postgres). In the case that the latter event is a delete record, the payload implementation ensures that the record is hard deleted from the storage. Delete records are identified using the op field, which has a value of <strong>d</strong> for deletes.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="apache-hudi-configurations">Apache Hudi Configurations<a class="hash-link" href="#apache-hudi-configurations" title="Direct link to heading">​</a></h2><p>It is important to consider the following configurations of your Hudi deployments when using the Debezium source connector for CDC ingestion.</p><ol><li><strong>Record Keys -</strong> The Hudi <a href="https://hudi.apache.org/docs/next/indexing" target="_blank" rel="noopener noreferrer">record key(s)</a> for a table should be set as the Primary keys of the table in the upstream database. This ensures that updates are applied correctly as record key(s) uniquely identify a row in the Hudi table.</li><li><strong>Source Ordering Fields</strong> -  For de-duplication of changelog records the source ordering field should be set to the actual position of the change event as it happened on the database. For instance, we use the FILEID and POS fields in MySql and LSN fields in Postgres databases respectively to ensure records are processed in the correct order of occurrence in the original database.</li><li><strong>Partition Fields</strong> - Don’t feel restricted to matching the partitioning of your Hudi tables with the same partition fields as the upstream database. You can set partition fields independently for the Hudi table as needed.</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="bootstrapping-existing-tables">Bootstrapping Existing tables<a class="hash-link" href="#bootstrapping-existing-tables" title="Direct link to heading">​</a></h3><p>One important use case might be when CDC ingestion has to be done for existing database tables. There are two ways we can ingest existing database data prior to streaming the changes:</p><ol><li>By default on initialization, Debezium performs an initial consistent snapshot of the database (controlled by config snapshot.mode). After the initial snapshot, it continues streaming updates from the correct position to avoid loss of data.</li><li>While the first approach is simple, for large tables it may take a long time for Debezium to bootstrap the initial snapshot. Alternatively, we could run a Deltastreamer job to bootstrap the table directly from the database using the <a href="https://github.com/apache/hudi/blob/master/hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/JdbcSource.java" target="_blank" rel="noopener noreferrer">JDBC source</a>. This provides more flexibility to the users in defining and executing more optimized SQL queries required to bootstrap the database table. Once the bootstrap job finishes successfully, another Deltastreamer job is executed that processes the database changelogs from Debezium. Users will have to use <a href="https://hudi.apache.org/docs/hoodie_deltastreamer/#checkpointing" target="_blank" rel="noopener noreferrer">checkpointing</a> in Deltastreamer to ensure the second job starts processing the changelogs from the correct position to avoid data loss.</li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="example-implementation">Example Implementation<a class="hash-link" href="#example-implementation" title="Direct link to heading">​</a></h3><p>The following describes steps to implement an end-to-end CDC pipeline using an AWS RDS instance of Postgres, Kubernetes-based Debezium deployment, and Hudi Deltastreamer running on a spark cluster.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="database">Database<a class="hash-link" href="#database" title="Direct link to heading">​</a></h3><p>A few configuration changes are required for the RDS instance to enable logical replication.</p><div class="codeBlockContainer_J+bg language-roomsql theme-code-block"><div class="codeBlockContent_csEI roomsql"><pre tabindex="0" class="prism-code language-roomsql codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SET rds.logical_replication to 1 (instead of 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">psql --host=&lt;aws_rds_instance&gt; --port=5432 --username=postgres --password -d &lt;database_name&gt;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE PUBLICATION &lt;publication_name&gt; FOR TABLE schema1.table1, schema1.table2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE schema1.table1 REPLICA IDENTITY FULL;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="debezium-connector">Debezium Connector<a class="hash-link" href="#debezium-connector" title="Direct link to heading">​</a></h3><p><a href="https://strimzi.io/blog/2020/01/27/deploying-debezium-with-kafkaconnector-resource/" target="_blank" rel="noopener noreferrer">Strimzi</a> is the recommended option to deploy and manage Kafka connectors on Kubernetes clusters. Alternatively, you have the option to use the Confluent managed <a href="https://docs.confluent.io/debezium-connect-postgres-source/current/overview.html" target="_blank" rel="noopener noreferrer">Debezium connector</a>.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl create namespace kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl create -f https://strimzi.io/install/latest?namespace=kafka -n kafka</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl -n kafka apply -f kafka-connector.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>An example for kafka-connector.yaml is shown below:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kafka.strimzi.io/v1beta2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> KafkaConnect</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">strimzi.io/use-connector-resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">bootstrapServers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">config.storage.replication.factor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">offset.storage.replication.factor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">status.storage.replication.factor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The docker image debezium-kafka-connect can be built using the following Dockerfile that includes the Postgres Debezium Connector.</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM confluentinc/cp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">6.2.0 as cp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN confluent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">hub install </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">no</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">prompt confluentinc/kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">avro</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">converter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">6.2.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FROM strimzi/kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">0.18.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">2.5.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">USER root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN yum </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">y update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN yum </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">y install git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN yum </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">y install wget</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN wget https</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">//repo1.maven.org/maven2/io/debezium/debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres/1.6.1.Final/debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">1.6.1.Final</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">plugin.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN tar xzf debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">1.6.1.Final</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">plugin.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN mkdir </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">p /opt/kafka/plugins/debezium </span><span class="token important">&amp;&amp;</span><span class="token plain"> mkdir </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">p /opt/kafka/plugins/avro/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUN mv debezium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">postgres /opt/kafka/plugins/debezium/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">from=cp /usr/share/confluent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">hub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">components/confluentinc</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">connect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">avro</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">converter/lib /opt/kafka/plugins/avro/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">USER 1001</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Once the Strimzi operator and the Kafka connect are deployed, we can start the Debezium connector.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -X POST -H &quot;Content-Type:application/json&quot; -d @connect-source.json http://localhost:8083/connectors/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The following is an example of a configuration to setup Debezium connector for generating the changelogs for two tables, table1, and table2.</p><p>Contents of connect-source.json:</p><div class="codeBlockContainer_J+bg language-json theme-code-block"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres-debezium-connector&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;config&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;connector.class&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;io.debezium.connector.postgresql.PostgresConnector&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.hostname&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.port&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;5432&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.user&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.password&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.dbname&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;database&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;plugin.name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pgoutput&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;database.server.name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;postgres&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;table.include.list&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;schema1.table1,schema1.table2&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;publication.autocreate.mode&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;filtered&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;tombstones.on.delete&quot;</span><span class="token operator">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;false&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;key.converter&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;io.confluent.connect.avro.AvroConverter&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;key.converter.schema.registry.url&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;schema_registry_host&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;value.converter&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;io.confluent.connect.avro.AvroConverter&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;value.converter.schema.registry.url&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;schema_registry_host&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;slot.name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pgslot&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="hudi-deltastreamer">Hudi Deltastreamer<a class="hash-link" href="#hudi-deltastreamer" title="Direct link to heading">​</a></h3><p>Next, we run the Hudi Deltastreamer using spark that will ingest the Debezium changelogs from kafka and write them as a Hudi table. One such instance of the command is shown below that works for Postgres database.  A few key configurations are as follows:</p><ol><li>Set the source class to PostgresDebeziumSource.</li><li>Set the payload class to PostgresDebeziumAvroPayload.</li><li>Configure the schema registry URLs for Debezium Source and Kafka Source.</li><li>Set the record key(s) as the primary key(s) of the database table.</li><li>Set the source ordering field (dedup) to _event_lsn</li></ol><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark-submit \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --jars &quot;/home/hadoop/hudi-utilities-bundle_2.12-0.10.0.jar,/usr/lib/spark/external/lib/spark-avro.jar&quot; \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --master yarn --deploy-mode client \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer /home/hadoop/hudi-packages/hudi-utilities-bundle_2.12-0.10.0-SNAPSHOT.jar \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --table-type COPY_ON_WRITE --op UPSERT \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --target-base-path s3://bucket_name/path/for/hudi_table1 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --target-table hudi_table1  --continuous \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --min-sync-interval-seconds 60 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --source-class org.apache.hudi.utilities.sources.debezium.PostgresDebeziumSource \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --source-ordering-field _event_lsn \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --payload-class org.apache.hudi.common.model.debezium.PostgresDebeziumAvroPayload \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf schema.registry.url=https://localhost:8081 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.deltastreamer.schemaprovider.registry.url=https://localhost:8081/subjects/postgres.schema1.table1-value/versions/latest \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.deltastreamer.source.kafka.value.deserializer.class=io.confluent.kafka.serializers.KafkaAvroDeserializer \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.deltastreamer.source.kafka.topic=postgres.schema1.table1 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf auto.offset.reset=earliest \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.write.recordkey.field=”database_primary_key” \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.write.partitionpath.field=partition_key \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --enable-hive-sync \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.partition_extractor_class=org.apache.hudi.hive.MultiPartKeysValueExtractor \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.write.hive_style_partitioning=true \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.database=default \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.table=hudi_table1 \\</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --hoodie-conf hoodie.datasource.hive_sync.partition_fields=partition_key</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>This post introduced the Debezium Source for Hudi Deltastreamer to ingest Debezium changelogs into Hudi tables. Database data can now be ingested into data lakes to provide a cost-effective way to store and analyze database data.</p><p>Please follow this <a href="https://issues.apache.org/jira/browse/HUDI-1290" target="_blank" rel="noopener noreferrer">JIRA</a> to learn more about active development on this new feature. I look forward to more contributions and feedback from the community. Come join our <a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-1e94d3xro-JvlNO1kSeIHJBTVfLPlI5w" target="_blank" rel="noopener noreferrer">Hudi Slack</a> channel or attend one of our <a href="https://hudi.apache.org/community/syncs" target="_blank" rel="noopener noreferrer">community events</a> to learn more.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_2lop"><div class="col margin-top--sm"><a href="https://github.com/apache/hudi/edit/asf-site/website/blog/blog/2022-01-14-change-data-capture-with-debezium-and-apache-hudi.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022/01/18/Why-and-How-I-Integrated-Airbyte-and-Apache-Hudi"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« <!-- -->Why and How I Integrated Airbyte and Apache Hudi</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2022/01/06/apache-hudi-2021-a-year-in-review"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Apache Hudi - 2021 a Year in Review<!-- --> »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#design-overview" class="table-of-contents__link toc-highlight">Design Overview</a></li><li><a href="#apache-hudi-configurations" class="table-of-contents__link toc-highlight">Apache Hudi Configurations</a><ul><li><a href="#bootstrapping-existing-tables" class="table-of-contents__link toc-highlight">Bootstrapping Existing tables</a></li><li><a href="#example-implementation" class="table-of-contents__link toc-highlight">Example Implementation</a></li><li><a href="#database" class="table-of-contents__link toc-highlight">Database</a></li><li><a href="#debezium-connector" class="table-of-contents__link toc-highlight">Debezium Connector</a></li><li><a href="#hudi-deltastreamer" class="table-of-contents__link toc-highlight">Hudi Deltastreamer</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/community/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/release-0.12.1">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/powered-by">Who&#x27;s Using</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docker_demo">Docker Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/talks">Talks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQ</a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ibm_cos_hoodie">IBM Cloud</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/contribute/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-1e94d3xro-JvlNO1kSeIHJBTVfLPlI5w" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="col footer__col"><div class="footer__title">Apache</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://hudi.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>. <br>Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f7a2b524.js"></script>
<script src="/assets/js/main.21e8aaca.js"></script>
</body>
</html>