<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Adding support for Virtual Keys in Hudi | Apache Hudi</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hudi.apache.org/blog/2021/08/18/virtual-keys"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="apache hudi, data lake, lakehouse, big data, apache spark, apache flink, presto, trino, analytics, data engineering"><meta data-rh="true" property="og:title" content="Adding support for Virtual Keys in Hudi | Apache Hudi"><meta data-rh="true" name="description" content="Apache Hudi helps you build and manage data lakes with different table types, config knobs to cater to everyone&#x27;s need."><meta data-rh="true" property="og:description" content="Apache Hudi helps you build and manage data lakes with different table types, config knobs to cater to everyone&#x27;s need."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-08-18T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="design,metadata,apache hudi"><link data-rh="true" rel="icon" href="/assets/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://hudi.apache.org/blog/2021/08/18/virtual-keys"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/blog/2021/08/18/virtual-keys" hreflang="en"><link data-rh="true" rel="alternate" href="https://hudi.apache.org/blog/2021/08/18/virtual-keys" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://hudi.apache.org/blog/2021/08/18/virtual-keys","mainEntityOfPage":"https://hudi.apache.org/blog/2021/08/18/virtual-keys","url":"https://hudi.apache.org/blog/2021/08/18/virtual-keys","headline":"Adding support for Virtual Keys in Hudi","name":"Adding support for Virtual Keys in Hudi","description":"Apache Hudi helps you build and manage data lakes with different table types, config knobs to cater to everyone's need.","datePublished":"2021-08-18T00:00:00.000Z","author":{"@type":"Person","name":"shivnarayan"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://hudi.apache.org/blog","name":"Blogs List Page"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Hudi: User-Facing Analytics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Hudi: User-Facing Analytics Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Apache Hudi: User-Facing Analytics JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/videos/rss.xml" title="Apache Hudi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/videos/atom.xml" title="Apache Hudi Atom Feed">





<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="9e4444ba-93cc-45ea-b143-783ae0fbeb6f" data-project-name="Apache Hudi" data-project-color="#FFFFFF" data-project-logo="/assets/images/logo-big.png" data-modal-disclaimer="This AI assistant answers Apache Hudi questions using your [documentation](https://hudi.apache.org/docs/quick-start-guide/), [dev setup](https://hudi.apache.org/contribute/developer-setup/), the [tech specs](https://hudi.apache.org/tech-specs-1point0/) and [open GitHub Issues](https://github.com/apache/hudi/issues/) from the last year." data-modal-title="Apache Hudi AI Assistant" data-modal-example-questions-title="Try asking me..." data-modal-example-questions="How can I convert an existing COW table to MOR?,How do I set up incremental queries with Hudi tables?" data-modal-image="/assets/images/logo-small.png" data-modal-image-ask-ai="/assets/images/logo-small.png" data-modal-header-min-height="64px" data-modal-image-height="44" data-modal-image-width="64" data-modal-header-bg-color="#f8f9fa" data-modal-title-color="#15467D" data-button-text-color="#29557a" data-button-text="Ask AI" data-consent-required="true" data-consent-screen-title="Help us improve our AI assistant" data-consent-screen-disclaimer="By clicking &amp;quot;Allow tracking&amp;quot;, you consent to the use of the AI assistant in accordance with kapa.ai&#39;s [Privacy Policy](https://www.kapa.ai/content/privacy-policy). This service uses reCAPTCHA, which requires your consent to Google&#39;s [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms). By proceeding, you explicitly agree to both kapa.ai&#39;s and Google&#39;s privacy policies." data-consent-screen-accept-button-text="Allow tracking" data-modal-disclaimer-font-size="0.80rem" data-query-input-placeholder-text-color="#29557a" data-submit-query-button-bg-color="#228EDE" data-query-input-text-color="#29557a" data-user-analytics-cookie-enabled="false" data-query-input-border-color="#211b0e" data-question-text-color="#0db1f9" data-answer-text-color="#000" data-thread-clear-button-bg-color="#000000" data-thread-clear-button-text-color="#FFFFFF" data-answer-feedback-button-bg-color="#000000" data-answer-feedback-button-text-color="#FFFFFF" data-answer-feedback-button-active-bg-color="#000000" data-answer-feedback-button-active-text-color="#FFFFFF" data-answer-copy-button-bg-color="#000000" data-answer-copy-button-text-color="#FFFFFF" data-example-question-button-text-color="#29557a" data-modal-disclaimer-bg-color="#f8f9fa" data-modal-disclaimer-text-color="#15467D" data-deep-thinking-button-bg-color="#228EDE" data-deep-thinking-button-text-color="#FFFFFF" data-deep-thinking-button-active-bg-color="#205792" data-deep-thinking-button-hover-bg-color="#0478C0" data-deep-thinking-button-active-hover-bg-color="#205792" data-deep-thinking-button-active-text-color="#FFFFFF" async></script><link rel="stylesheet" href="/assets/css/styles.abb0228d.css">
<script src="/assets/js/runtime~main.dccba78c.js" defer="defer"></script>
<script src="/assets/js/main.42f99d09.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" role="banner"><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like <b>Apache Hudi</b>, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi"><b>GitHub!<svg xmlns="http://www.w3.org/2000/svg\" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 -2 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></b></a> ⭐</div></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarWrapper_j_uY"><div class="navbar__inner navbarInnerStyle_KoMw"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo navbarLogo_aghy"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/overview">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/learn/tutorial-series">Tutorial Series</a></li><li><a class="dropdown__link" href="/learn/blog">Blogs</a></li><li><a class="dropdown__link" href="/learn/talks">Talks</a></li><li><a class="dropdown__link" href="/learn/videos">Video Guides</a></li><li><a class="dropdown__link" href="/learn/faq">FAQ</a></li><li><a class="dropdown__link" href="/learn/tech-specs">Tech Specs</a></li><li><a class="dropdown__link" href="/learn/tech-specs-1point0">Tech Specs 1.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute/developer-sync-call">Developer Sync Call</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/contribute/security">Security</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/syncs">Community Syncs</a></li><li><a class="dropdown__link" href="/community/office_hours">Office Hours</a></li><li><a class="dropdown__link" href="/community/team">Team</a></li><li><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Github<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="dropdown__link">Slack<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.linkedin.com/company/apache-hudi/" target="_blank" rel="noopener noreferrer" class="dropdown__link">LinkedIn<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.youtube.com/@apachehudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">YouTube<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://x.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="dropdown__link">X<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Ecosystem</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/powered-by">Adopters</a></li><li><a class="dropdown__link" href="/roadmap">Roadmap</a></li><li><a class="dropdown__link" href="/ecosystem">Integrations</a></li></ul></div><a class="navbar__item navbar__link" href="/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div><div role="button" class="searchButton_o6KI" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 14 14"><circle cx="6.864" cy="6.864" r="5.243" stroke="#15467D" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></circle><path stroke="#15467D" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m10.51 10.783 2.056 2.05"></path></svg></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar navbarSideMenu_TODO"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><div class="navbar__logo navbarLogo_aghy"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><button type="button" aria-label="Close navigation bar" class="clean-btn navbar-sidebar__close"><svg viewBox="0 0 15 15" width="21" height="21"><g stroke="var(--ifm-color-emphasis-600)" stroke-width="1.2"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><div class="navbar-sidebar__items"><div class="navbar-sidebar__item menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/docs/overview">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Learn</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Contribute</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Community</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="dropdownNavbarItemMobile_JUhd menu__link menu__link--sublist menu__link--sublist-caret navbarFontSize_pR5Q">Ecosystem</a></li><li class="menu__list-item"><a class="menu__link navbarFontSize_pR5Q" href="/releases/download">Download</a></li></ul></div><div class="navbar-sidebar__item menu"><button type="button" class="clean-btn navbar-sidebar__back">← Back to main menu</button></div></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-2" itemscope="" itemtype="http://schema.org/Blog"><article class=""><header><h1 class="title_xvU1">Adding support for Virtual Keys in Hudi</h1><div class="container_iJTo margin-vert--sm"><time datetime="2021-08-18T00:00:00.000Z">August 18, 2021</time><div class="row"><div class="authorWrapper_ApDF col col--12 authorCol_q4o9">shivnarayan</div></div><span class="marker_H0Am">6 min read</span></div><div class="row tagsListInline margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/design">design</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/metadata">metadata</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/apache-hudi">apache hudi</a></li></ul></div></div></header><div id="__blog-post-container" class="markdown"><p>Apache Hudi helps you build and manage data lakes with different table types, config knobs to cater to everyone&#x27;s need.
Hudi adds per record metadata fields like <code>_hoodie_record_key</code>, <code>_hoodie_partition path</code>, <code>_hoodie_commit_time</code> which serves multiple purposes.
They assist in avoiding re-computing the record key, partition path during merges, compaction and other table operations
and also assists in supporting <a class="" href="/blog/2021/07/21/streaming-data-lake-platform#readers">record-level</a> incremental queries (in comparison to other table formats, that merely track files).
In addition, it ensures data quality by ensuring unique key constraints are enforced even if the key field changes for a given table, during its lifetime.
But one of the repeated asks from the community is to leverage existing fields and not to add additional meta fields, for simple use-cases where such benefits are not desired or key changes are very rare.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="virtual-key-support">Virtual Key support<a href="#virtual-key-support" class="hash-link" aria-label="Direct link to Virtual Key support" title="Direct link to Virtual Key support" translate="no">​</a></h2>
<p>Hudi now supports virtual keys, where Hudi meta fields can be computed on demand from the data fields. Currently, the meta fields are
computed once and stored as per record metadata and re-used across various operations. If one does not need incremental query support,
they can start leveraging Hudi&#x27;s Virtual key support and still go about using Hudi to build and manage their data lake to reduce the storage
overhead due to per record metadata.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configurations">Configurations<a href="#configurations" class="hash-link" aria-label="Direct link to Configurations" title="Direct link to Configurations" translate="no">​</a></h3>
<p>Virtual keys can be enabled for a given table using the below config. When set to <code>hoodie.populate.meta.fields=false</code>,
Hudi will use virtual keys for the corresponding table. Default value for this config is <code>true</code>, which means, all  meta fields will be added by default.</p>
<p>Once virtual keys are enabled, it can&#x27;t be disabled for a given hudi table, because already stored records may not have
the meta fields populated. But if you have an existing table from an older version of hudi, virtual keys can be enabled.
Another constraint w.r.t virtual key support is that, Key generator properties for a given table cannot be changed through
the course of the lifecycle of a given hudi table. In this model, the user also shares responsibility of ensuring uniqueness
of key within a table. For instance, if you configure record key to point to <code>field_5</code> for few batches of write and later switch to <code>field_10</code>,
Hudi cannot guarantee uniqueness of key, since older writes could have had duplicates for <code>field_10</code>.</p>
<p>With virtual keys, keys will have to be re-computed everytime when in need (merges, compaction, MOR snapshot read). Hence we
support virtual keys for all built-in key generators on Copy-On-Write tables. Supporting all key generators on Merge-On-Read table
would entail reading all fields out of base and delta logs, sacrificing core columnar query performance, which will be prohibitively expensive
for users. Thus, we support only simple key generators (the default key generator, where both record key and partition path refer
to an existing field ) for now.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-key-generators-with-copyonwritecow-table">Supported Key Generators with CopyOnWrite(COW) table:<a href="#supported-key-generators-with-copyonwritecow-table" class="hash-link" aria-label="Direct link to Supported Key Generators with CopyOnWrite(COW) table:" title="Direct link to Supported Key Generators with CopyOnWrite(COW) table:" translate="no">​</a></h4>
<p>SimpleKeyGenerator, ComplexKeyGenerator, CustomKeyGenerator, TimestampBasedKeyGenerator and NonpartitionedKeyGenerator.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-key-generators-with-mergeonreadmor-table">Supported Key Generators with MergeOnRead(MOR) table:<a href="#supported-key-generators-with-mergeonreadmor-table" class="hash-link" aria-label="Direct link to Supported Key Generators with MergeOnRead(MOR) table:" title="Direct link to Supported Key Generators with MergeOnRead(MOR) table:" translate="no">​</a></h4>
<p>SimpleKeyGenerator</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-index-types">Supported Index types:<a href="#supported-index-types" class="hash-link" aria-label="Direct link to Supported Index types:" title="Direct link to Supported Index types:" translate="no">​</a></h4>
<p>Only &quot;SIMPLE&quot; and &quot;GLOBAL_SIMPLE&quot; index types are supported in the first cut. We plan to add support for other index
(BLOOM, etc) in future releases.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="supported-operations">Supported Operations<a href="#supported-operations" class="hash-link" aria-label="Direct link to Supported Operations" title="Direct link to Supported Operations" translate="no">​</a></h3>
<p>All existing features are supported for a hudi table with virtual keys, except the incremental
queries. Which means, cleaning, archiving, metadata table, clustering, etc can be enabled for a hudi table with
virtual keys enabled. So, you are able to merely use Hudi as a transactional table format with all the awesome
table service runtimes and platform services, if you wish to do so, without incurring any overheads associated with
support for incremental data processing.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sample-output">Sample Output<a href="#sample-output" class="hash-link" aria-label="Direct link to Sample Output" title="Direct link to Sample Output" translate="no">​</a></h3>
<p>As called out earlier, one has to set <code>hoodie.populate.meta.fields=false</code> to enable virtual keys. Let&#x27;s see the
difference between records of a hudi table with and without virtual keys.</p>
<p>Here are some sample records for a regular hudi table (virtual keys disabled)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+--------------------------------------+--------------------------------------+---------+---------+-------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_hoodie_commit_time |           _hoodie_record_key         |        _hoodie_partition_path        |  rider  | driver  |        fare       |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+--------------------------------------+--------------------------------------+---------+---------+-------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | eb7819f1-6f04-429d-8371-df77620b9527 | americas/united_states/san_francisco |rider-284|driver-284|98.3428192817987  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 37ea44f1-fda7-4ec4-84de-f43f5b5a4d84 | americas/united_states/san_francisco |rider-213|driver-213|19.179139106643607|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | aa601d6b-7cc5-4b82-9687-675d0081616e | americas/united_states/san_francisco |rider-213|driver-213|93.56018115236618 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 494bc080-881c-48be-8f8a-8f1739781816 | americas/united_states/san_francisco |rider-284|driver-284|90.9053809533154  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 09573277-e1c1-4cdd-9b45-57176f184d4d | americas/united_states/san_francisco |rider-284|driver-284|49.527694252432056|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | c9b055ed-cd28-4397-9704-93da8b2e601f | americas/brazil/sao_paulo            |rider-213|driver-213|43.4923811219014  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | e707355a-b8c0-432d-a80f-723b93dc13a8 | americas/brazil/sao_paulo            |rider-284|driver-284|63.72504913279929 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | d3c39c9e-d128-497a-bf3e-368882f45c28 | americas/brazil/sao_paulo            |rider-284|driver-284|91.99515909032544 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 159441b0-545b-460a-b671-7cc2d509f47b | asia/india/chennai                   |rider-284|driver-284|9.384124531808036 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   20210825154123   | 16031faf-ad8d-4968-90ff-16cead211d3c | asia/india/chennai                   |rider-284|driver-284|90.25710109008239 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+--------------------------------------+--------------------------------------+---------+----------+------------------+</span><br></span></code></pre></div></div>
<p>And here are some sample records for a hudi table with virtual keys enabled.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+------------------------+-------------------------+---------+---------+-------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_hoodie_commit_time |    _hoodie_record_key  |  _hoodie_partition_path |  rider  | driver  |        fare       |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+------------------------+-------------------------+---------+---------+-------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|98.3428192817987  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-213|driver-213|19.179139106643607|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-213|driver-213|93.56018115236618 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|90.9053809533154  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|49.527694252432056|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-213|driver-213|43.4923811219014  |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|63.72504913279929 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|91.99515909032544 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|9.384124531808036 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        null        |            null        |          null           |rider-284|driver-284|90.25710109008239 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+--------------------+------------------------+-------------------------+---------+----------+------------------+</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>As you could see, all meta fields are null in storage, but all users fields remain intact similar to a regular table.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="incremental-queries">Incremental Queries<a href="#incremental-queries" class="hash-link" aria-label="Direct link to Incremental Queries" title="Direct link to Incremental Queries" translate="no">​</a></h3>
<p>Since hudi does not maintain any metadata (like commit time at a record level) for a table with virtual keys enabled,<br>
<!-- -->incremental queries are not supported. An exception will be thrown as below when an incremental query is triggered for such
a table.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">scala&gt; val tripsIncrementalDF = spark.read.format(&quot;hudi&quot;).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     |   option(QUERY_TYPE_OPT_KEY, QUERY_TYPE_INCREMENTAL_OPT_VAL).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     |   option(BEGIN_INSTANTTIME_OPT_KEY, &quot;20210827180901&quot;).load(basePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">org.apache.hudi.exception.HoodieException: Incremental queries are not supported when meta fields are disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.hudi.IncrementalRelation.&lt;init&gt;(IncrementalRelation.scala:69)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.hudi.DefaultSource.createRelation(DefaultSource.scala:120)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.hudi.DefaultSource.createRelation(DefaultSource.scala:67)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:344)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.loadV1Source(DataFrameReader.scala:297)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.$anonfun$load$2(DataFrameReader.scala:286)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at scala.Option.getOrElse(Option.scala:189)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:286)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:232)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ... 61 elided</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h3>
<p>Hope this blog was useful for you to learn yet another feature in Apache Hudi. If you are interested in
Hudi and looking to contribute, do check out <a href="https://hudi.apache.org/contribute/get-involved" target="_blank" rel="noopener noreferrer" class="">here</a>.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/apache/hudi/edit/asf-site/website/blog/blog/2021-08-18-virtual-keys.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2021/08/18/improving-marker-mechanism"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Improving Marker Mechanism in Apache Hudi</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2021/08/16/kafka-custom-deserializer"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Schema evolution with DeltaStreamer using KafkaSource</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#virtual-key-support" class="table-of-contents__link toc-highlight">Virtual Key support</a><ul><li><a href="#configurations" class="table-of-contents__link toc-highlight">Configurations</a></li><li><a href="#supported-operations" class="table-of-contents__link toc-highlight">Supported Operations</a></li><li><a href="#sample-output" class="table-of-contents__link toc-highlight">Sample Output</a></li><li><a href="#incremental-queries" class="table-of-contents__link toc-highlight">Incremental Queries</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footerCustom_j_zv"><div class="container container-fluid container_y1z5"><div class="brand_kMBW"><a href="https://hudi.apache.org/" rel="noopener noreferrer" class="footerLogoLink_DDai"><img src="/assets/images/hudi.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/assets/images/hudi.png" alt="Apache Hudi™" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="links_AXCu"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/community/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/release-1.1">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/powered-by">Adopters</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/tutorial-series">Tutorial Series</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/talks">Talks</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/videos">Video Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/faq">FAQ</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ibm_cos_hoodie">IBM Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oci_hoodie">Oracle Cloud</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/zt-33fabmxb7-Q7QSUtNOHYCwUdYM8LbauA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCs7AhE0BWaEPZSChrBR-Muw" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/apache-hudi/?viewAsMember=true" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Apache</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a class="footer__link-item" href="/asf/privacy">Privacy</a></li><li class="footer__item"><a class="footer__link-item" href="/asf/telemetry">Telemetry</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div></div><div class="legal_MFbX"><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>. Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation.<img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=8f594acf-9b77-44fb-9475-3e82ead1910c"><img referrerpolicy="no-referrer-when-downgrade" src="https://analytics.apache.org/matomo.php?idsite=47&amp;rec=1"></div></div></div></footer></div>
</body>
</html>