<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Hudi! Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Hudi! Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi!" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css"><title data-react-helmet="true">Efficient Migration of Large Parquet Tables to Apache Hudi | Apache Hudi!</title><meta data-react-helmet="true" property="og:title" content="Efficient Migration of Large Parquet Tables to Apache Hudi | Apache Hudi!"><meta data-react-helmet="true" name="description" content="We will look at how to migrate a large parquet table to Hudi without having to rewrite the entire dataset."><meta data-react-helmet="true" property="og:description" content="We will look at how to migrate a large parquet table to Hudi without having to rewrite the entire dataset."><meta data-react-helmet="true" property="og:url" content="https://hudi.apache.org/blog/2020/08/20/efficient-migration-of-large-parquet-tables"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/assets/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hudi.apache.org/blog/2020/08/20/efficient-migration-of-large-parquet-tables"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2020/08/20/efficient-migration-of-large-parquet-tables" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/cn/blog/2020/08/20/efficient-migration-of-large-parquet-tables" hreflang="cn"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2020/08/20/efficient-migration-of-large-parquet-tables" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.067d5900.css">
<link rel="preload" href="/assets/js/runtime~main.b62330e8.js" as="script">
<link rel="preload" href="/assets/js/main.1b4b15db.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">⭐️ If you like Apache Hudi, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi">GitHub</a>! ⭐</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">×</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/quick-start-guide">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Learn</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/blog">Blog</a></li><li><a class="dropdown__link" href="/talks-articles">Talks &amp; Articles</a></li><li><a class="dropdown__link" href="/learn/faq">FAQ</a></li><li><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Technical Wiki<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/contribute/team">Team</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/contribute/rfc-process">RFC Process</a></li><li><a class="dropdown__link" href="/contribute/report-security-issues">Report Security Issues</a></li><li><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Report Issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a class="navbar__item navbar__link" href="/powered-by">Who&#x27;s Using</a><a class="navbar__item navbar__link" href="/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/docs/overview">0.9.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/overview">Current</a></li><li><a class="dropdown__link" href="/docs/overview">0.9.0</a></li><li><a class="dropdown__link" href="/docs/0.8.0/overview">0.8.0</a></li><li><a class="dropdown__link" href="/docs/0.7.0/overview">0.7.0</a></li><li><a class="dropdown__link" href="/docs/0.6.0/quick-start-guide">0.6.0</a></li><li><a class="dropdown__link" href="/docs/0.5.3/quick-start-guide">0.5.3</a></li><li><a class="dropdown__link" href="/docs/0.5.2/quick-start-guide">0.5.2</a></li><li><a class="dropdown__link" href="/docs/0.5.1/quick-start-guide">0.5.1</a></li><li><a class="dropdown__link" href="/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2020/08/20/efficient-migration-of-large-parquet-tables" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/cn/blog/2020/08/20/efficient-migration-of-large-parquet-tables" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Chinese</a></li></ul></div><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter-link" aria-label="Hudi Twitter Handle"></a><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Hudi Slack Channel"></a><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quick-start-guide">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Learn</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/talks-articles">Talks &amp; Articles</a></li><li class="menu__list-item"><a class="menu__link" href="/learn/faq">FAQ</a></li><li class="menu__list-item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/contribute/get-involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/team">Team</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/developer-setup">Developer Setup</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/rfc-process">RFC Process</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/report-security-issues">Report Security Issues</a></li><li class="menu__list-item"><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Report Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/powered-by">Who&#x27;s Using</a></li><li class="menu__list-item"><a class="menu__link" href="/releases/download">Download</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/overview">Current</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/overview">0.9.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.8.0/overview">0.8.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.7.0/overview">0.7.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.6.0/quick-start-guide">0.6.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/quick-start-guide">0.5.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.2/quick-start-guide">0.5.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.1/quick-start-guide">0.5.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/blog/2020/08/20/efficient-migration-of-large-parquet-tables" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/blog/2020/08/20/efficient-migration-of-large-parquet-tables" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">Chinese</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li><li class="menu__list-item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="menu__link header-twitter-link" aria-label="Hudi Twitter Handle"></a></li><li class="menu__list-item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="menu__link header-slack-link" aria-label="Hudi Slack Channel"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/01/building-eb-level-data-lake-using-hudi-at-bytedance">Building an ExaByte-level Data Lake Using Apache Hudi at ByteDance</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/async-clustering">Asynchronous Clustering using Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/s3-events-source">Reliable ingestion from AWS S3 using Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/18/improving-marker-mechanism">Improving Marker Mechanism in Apache Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/18/virtual-keys">Adding support for Virtual Keys in Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/16/kafka-custom-deserializer">Schema evolution with DeltaStreamer using KafkaSource</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/21/streaming-data-lake-platform">Apache Hudi - The Data Lake Platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/10/employing-right-configurations-for-hudi-cleaner">Employing correct configurations for Hudi&#x27;s cleaner table service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/03/01/hudi-file-sizing">Streaming Responsibly - How Apache Hudi maintains optimum sized files</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/13/hudi-key-generators">Apache Hudi Key Generators</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="blogPostTitle_GeHD">Efficient Migration of Large Parquet Tables to Apache Hudi</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2020-08-20T00:00:00.000Z">August 20, 2020</time> · 5 min read</div><div class="avatar margin-vert--md"><div class="avatar__intro"><div class="avatar__name"><a>vbalaji</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>We will look at how to migrate a large parquet table to Hudi without having to rewrite the entire dataset. </p><header><h1 class="h1Heading_27L5">Motivation:</h1></header><p>Apache Hudi maintains per record metadata to perform core operations such as upserts and incremental pull. To take advantage of Hudi’s upsert and incremental processing support, users would need to rewrite their whole dataset to make it an Apache Hudi table.  Hudi 0.6.0 comes with an <strong><em>experimental feature</em></strong> to support efficient migration of large Parquet tables to Hudi without the need to rewrite the entire dataset.</p><header><h1 class="h1Heading_27L5">High Level Idea:</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="per-record-metadata"></a>Per Record Metadata:<a class="hash-link" href="#per-record-metadata" title="Direct link to heading">#</a></h2><p>Apache Hudi maintains record level metadata for perform efficient upserts and incremental pull.</p><p><img alt="Per Record Metadata" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABCUAAAEsCAAAAADRVFYhAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAGJsAABibAUl1g5QAAAAHdElNRQfjDA0UGBIBExTtAAAVdUlEQVR42u3dzbW7KACHYcqgCquwCZqwB2uwBkqwAyvwnFmzHteeMwsXDqD5TrjBJIrJ+5yZe28S5U+I/gJ+ihEAQsTWFQCQOFICQBgpASCMlAAQRkoACCMlAISREgDCSAkAYaQEgDBSAkAYKQEgjJQAEEZKAAgjJQCEkRIAwkgJAGGkBIAwUgJAGCkBIIyUABBGSgAIIyUAhJESAMJICQBhpASAMFICQBgpASCMlAAQRkoACCMlAISREgDCSAkAYaQEgDBSAkAYKQEgjJQAEEZKAAgjJQCEkRKIIZK3dQt9IxoVMbbOAFJiCzQqYqS+FqZev32iUREj9bUw9frtE42KGKmvhanXb59oVMRIfS1MvX77RKMiRuprYer12ycaFTFSXwtTr98+0aiIkfpamHr99olGRYzU18LU67dPNCpiPLEWdpePVHP2qLl49Pfzn6gfotGoiPHHWjjoXAiRlcPxGSP02ev64tGd5407fFIWuruawPRvqR8WeU+jbn1ULsftriXckn1mV/HK/Wjjij1LiUzrQorrNHmQLpH1wzKkBGKEW7IQfuRgCpFNvYnh0AXoh8spzeF54184SwnlfrVSlPPr89P6/OHS+mGZd6XE1u9j3/Xbj2BLdkLMIwUpartm216F9ut3X4qsdX9p/79pM5HVdjL7WwjV3abE2ElhA6Z2rxe9fdkyx4dL64eFSAnECLZkLbL5r1IUdoWXWWFcNtj0KJssO6ZEljWVFMM4SNm0pes13KSELaEde/d6ISqXMqUZjg+X1g8LkRKIEWxJfVyDW7uyG+G6Ay4lGpcBgzylxDilQFe6DoXLi9uUqG1ZpnCvCzmnyOnhwvphIVICMYItWYp6/quzSWBEPk4pUdrRwjiqY0q4TQ5zLnTGZPbV25RobW/EPTZGilNfY364sH5YiJRAjD/6EsX8V+37Eq5n4VJCuU7FnBB6XuPdz6GYNi3fSwn3TK8Om57966eHC+uHhUgJxAi2ZHt81W09mPZLTCnhNmpWNylRuYAY7/clcjsiKYU0bkQyp8Tp4cL6YSFSAjGCLTlIMR0nMbjV/5QS2j+d36RELhrbQ7jbl6jcvlRfXHfsS5weLqwfFiIlECPcklr4AyZM7jY9nFKiFXk3aHGTEoWdrLejjvI6JdpSuERwxbhhRmlHMOX5w6X1wzKkBGL80ZLuwAZ/UMNwnhKDXemzorxJiUaIXMhaiPryCG0xH7xZu8Jy9/qQCdWdHi6uHxYhJRDjr5bsdKGU9uOO6Tyv6WdfulFF7c/qms7s8j/bUul+rLU5nu3VKavQ7XSoZlOouh+1NnZKO+Hp4eL6YQlSAjEWtWTfutgo5LBg3jXqhz+QEoixqCWHXNSmevaErfXrhz+QEoixrCUHfz75Cl0JPumPICUQY2FLDsaYlOuHIFICMVJvydTrt0+kBGKk3pKp12+fSAnESL0lU6/fPpESiJF6S6Zev30iJRAjviWHVjdXl5fSn9spyif9CaQEYsS2ZJdPB1xfXBOblNiZ7VKiN73/f4H5kqqfrR/uiWzJTgqpu7YS8vyDJiV25rMpoeej8xt9mwanE3+sXh/uwNDpv5cg7a999Ib6IVZkS8r5Ay6n69M0pV8g3Mdu/CLhftr/26pyJ4X7V91TbenPBBlqbSK/EPikP+GzKXG4pIi6s1pPi8r8vDmeD1xclVXcuenTVUoUf94XimXnXeJashNiXsn9ZWhsx0LI8vAFYcbpk9SidIOSxp1PmrunGndNKrvkGCkyGXnIJp/0J2ybEkfuhGG/NAxXVywb7nVOL1Ni+Lv/yrLzLnEt2RwWAMeIrHGXnuhuUkI27iTxou9z4a+qXw99Zv9yF9C1RZQx/yKf9CeslxJTv2H+WejBXPYl/HWL/AUTfVm9Vq7/aUrhzi0emlJV05DE2J6DX8IOz91O8nz9ECuuJcvzS0EU/kFjf16nROEL9rflcC8qP2czlnEBsaB+eM56KXF2UVTbo8yy6ny7hI2MzE+bZ9qVVYpMuds7Nbn9o7PzZ7nwlz/LhMwy3zU5PHc9SUz9ECuuJavzm2dMHcrOZsJ1ShwvoD+9UM9/9XYE8jD431I/POfDKZEbL79IiUbk/djIq5So3IWWO1G5lOhEPox9frh4oru7g11m/KC16N0ljszZc1eTxNQPsWJHHGcfiJrGlCK7SQm3EPgvlPMX3A04SinckvCx+uE5H06Jo/OUUP5iqeoqJTr3HVKJTovDhgd3s5fpsmi92x6eiW7+PnLxcXruapKY+iFW9NbLaefWYMeJlf/s3IUt9fGKueU8/rjoS7Tj2Q048ri9pnzSn/DhlMi0l12lRDde7Ql1a3qe2dXcfdG4GHAXNsv9TR38xRO1feiiJvPfR4VbkI7PXU0SUz/EimxJNd/W0+0Jbf3nVM8jjsYPRrLjQuALvrgs5tC4uDDHuwp+on54yhbbJaau501K1KLr/FeLK095800d7BBDaS1tIdPNGKrpyqrzc1eTxNQPseKPqhKqrTI/bhCi7Co5Lwq9yBqjZCAl7HdF3feRl7jik/6EtVOiPN4QrrhOiUGUbttEJc73nPoIUK4cf4+HqRuifNSo8/s+nB7G1A+xYluy90doy9IfQuWOiyjaeThR2acbHUqJXrp52S6xvfVSovX7tTLfaXDLQX6dEmMhZeGmnbLE9g/qfrqNnO8itO4WDX7QOrg7O5yeu5okpn6IFd+SvdHHjUX9dN7XdGD+UA/jcDxM31/L6nTU/vSza5rIQ/j5pD9hvZQYhNRNJo83qhc3KTGt5C4lejtFq9w5Qr2Qpi+FbEt364bOCFHZcYXvkByeu5okpn6IlXpLpl6/fVrx2Mtaiqz1cWCUcDdruU6JUcpxSomxc/vAMnf0g+2Yat9trfyt7V26SDdWPXvuapKI+iFW6i2Zev326bMpYQ6ncE3n7Jipi+me6M46m+M4P911ftqzZ+zvaXpzXuY89eG5m0merh9ipd6Sqddvn7i+BGKk3pKp12+fSAnESL0lU6/fPpESiJF6S6Zev30iJRAj9ZZMvX77REogRuotmXr99omUQIzUWzL1+u0TKYEYqbdk6vXbJ1ICMVJvydTrt0+kBGKk3pKp12+fSAnESL0lU6/fPpESiJF6S6Zev30iJRBDJG/rFvpGpARibJ0BpMQWSAlsxt2rqdi6EvgbKYHN1DYloq59i22QEthMIeThUvxIGSmBzQjRPLwdGxJCSmArxnYk1IJ7gWJtpAS2ov3NANkwkT5SAlvJbD+ie3QLFSSElMBGpoDIGHKkj5TARio/2ND+NsJIGimBjUh/P+GevRzpe1dKpG7rdsa1Zj5UIj/c2gnJIiWwjWxOh4btl8lj9cEmTuGQ0ZlIHSmBTZyygc5E8kgJbOE8GuhMpI6UwAYGeZYMLbs5EkdKYAPVxbmgSshh6xohgJTA+owQ+uxhL/yhE0gVKYHVDZnILjoPWoh260rhMVICqyuu92oMuZBcjSZdpATWVl+ON5xOinzrauEhUgIr68SdPZ+N4NzQdJESWJftNtzbo1HedjCQClICq+ptSHT3Xsg5aiJZpATWNOSPjsceiIlkkRJYUReIAmIiWaQE1tPJUBC4CGHbRIpICazGyHBvwfUm2NORIFICa9HiwYbLIxcTOYdXJSfRlDBbVwDvNighsu6vqUqbJBysnZo0U6JjK9a3aexoo3jizE83XcUZomlJMyUMG7G+S2c7EqJ+blI76pB8SyQlzZRoSIlvMmibEerP0cbF1GbrSuMkzZTQXOLse/RaRvYOfM+DnEgHKYGP6kp3o4PYLQ1N5nKCzZiJSDMlFDei/gp97dZ2qRfs3PQ5Ictnhyn4pERTIs1qIYapcteNyPTCPRbNNHvZcADF1tJcHbM0q4XndEaXyt9STZavjBp6nflSskK3Zus39cvSXB3TvI+LXfh1oRAkT3ddzKr25QMfOq3O7uOYb/3uUqd184k1h5R4ytCW+da3Ot2TXOn3DRSMzeat39CeyKJ+8+acJFPCpHUKcV8dEiJXpUZQY4z5xCbH3pbbbv3mUlepQ5xmLw31rqWaEskcVjXUU0Tk+iMLP/BevakLP+zLqrctsEmmRCVSuXNk7/f2yzcMsIH1dNp/t73ryLQkU8Jt2U5htZwy4q19N2AdXSXflhMppkTj1s3tbwk3VK4bsXRvP7C16QjWN4w7EkyJXgpVbb+Xw53CTEZg1/yRaa+fiJ9gSigh+5s7Sa6tdxuLyQjsnfuyy14dM6eXErW/EIHZdszRyvd01YCN+YHzi+tScimh5/0b1ZaXLLL/uHzumilA6rqXryaaWEr4CxX5N+QulJqZTSrhr9FKRwLfYij/vC5xWFIp4a9SdLg44tRT2qA74a/3zhYJfJFGvnTR4UUpMZgPaHUhLi+gbPyOHH/M79s97oB1Mq3jw4HXvbZUR6dEV2UfPFHl8irLvjvxKQ+OdCck8I1eWq4jU6L/4Ml5qrg9jXBoPnk64J2ND91rXTMgUa/chjUuJWq387UyZut3/DpjfJ/o+qQy15Rst8Q3eny79z/FpITrSHzTnRLcQRGX3Qlue43v1culezoiUmJwRxp91TUIB7e99LzdSkIC38sOp5cd0RyREsWzd2faEdudyE+PmhROMgM+xQhRLJnv+ZRoE7o0zPucv6vuIjKAr6OXfdM/nRLDl65CxWnMkc+HfQLfSi3aOv90ShRfuvH/lH42Z9kHiu9mF/cFl4F7NiX6rxxvOO0cDr0U5dZ1AT6sXTLmeDYlmjSuMfcJ2ZQOSshvfYfA0ZLl/NmUKJZtHN2DSri7kpov3IMD3LCjgug+87Mpob51wOHzwb/Br9w4C1zRQsRupH82Jb54y55xrZbYjYKATxniN8A93ZfY6Iowa5Cqs12JbOtqAKvQ0dsYk7oKzXboSuBn2M5E5OYDUsIr6UrgZ5RCxs1ASjg2XdnBgV/RxW5lJCWcJn6zL7BbeeT2S1LCKVK5ezGwgjpy+yUpYQ1su8Qv6SMXeFJi9Me2c3A2foiKG3KQEqM7RpvjLvFLdNw+PVJidBtzuEQVfomJ21xPSvjNEl97+DlwT9yGCVLCByubJfBT4s7eJCXcfqHIQ9GAnaui9v2TEm5TDkdL4LfEbb4kJVzvi42X+C3TRVWeRUq4S9p97RV2gLv6qItdkxJue6/ZugrAuqIWelKClMAPIiUikRL4OaREJFICP0fGHFZFSoyjUl951zLgsUqREgDehpQAEEZKAAgjJQCEkRIAwkgJAGGkBIAwUgJAGCkBIIyUABBGSgAIezYlBIAvQ0oACHt/Sryp8/KG8lKqyx7Lwz5tt1yREr9XHvaJlFhrXsrDXpESa81LedgrUmKteSkPe0VKrDUv5WGvSIm15qU87BUpsda8lIe9IiXWmpfysFekxFrzUh72ipRYa17Kw16REmvNS3nYK1JirXkpD3tFSqw1L+Vhr0iJtealPOwVKbHWvJSHvSIl1pqX8rBXpMRa81Ie9oqUWGteysNekRJrzUt52CtSYq15KQ97RUqsNS/lYa9IibXmpTzs1fekhGkuHjbmA+/47rxd869+/M+98t6GU6G9nn93by5veKE8/IjwcnC2WI26Pz5hlpZ3MeVbanjSVGN1WIWaZqyaF8t7et5cGTUq/bbyDgYlhCjnB2aashbqneX1mcjM0vLwM0LLgV+s1OHLRpjRLVxubRDLyruaMr6G0xefqe0vMzSD/Ra33+SD6cbBPtV3nainyvZ52Xd93w3N3Kfo6uFeeW9pLSPq/4xPibbxMer+xaHV3VndxuF+XyPY+jZ9hlJUrtxhXqtNXixOiXvllbIrxbCsPPyO0HKQ5+1QucXKr5dTSkjRb5YSjchVM2YyF80oMikrKYpR5VKUUspRq0aUvZ/QZPbrXWs7Sa6knVjZqZvb8t7TWlrof4RNicF+L2fGCPsv1mMhMvfvqrluxv7II1vLCNczsimTZUqaaa0eBr04Je6VZ7XZwvLwOwLLQSfa0X9/z+ulsY+MUmqzlMjrsdGd/e6rilHkgxSmtKun7HNRN6Kz64+vomO/2W1KCN2KrM/K3q4fSt2W96bWEu6LWekm64dMG1uxXI3aDJma61aLriwGc6zck62l59W3lfY7vzys1ctT4n55vawWloffEVgOmvmlw3ppRpcSvf1W3iglfA107hd0m2CqmlZP/5QwNynR2NXCTqZV7W5fKuNr+OS7m1OidP+KMraxbE1aaf8ebc9nqlvmXtNPljdr56GAywWdv54S98tT+bCwPPyOYF9i6r8f1kszupQYtRw2SomsGXvjvgptjYTfFDCnhLqbEsY/bV/tLoben0qJ2g8p3NqnbZTaQYdNCTPXragiyjtwg6S+qF25ung9Je6WV5fs48CfQstBVtuRcKlP66VPiTEvN0qJKm9kM9hxRK4fpISacm0sMnOWEqMs2qy6Le9Kp9x/o+rcfxHvbk6JXmhbvSklhrzUmWhUPdetlo2W3ZPlHd+uKLUdVfly63mfhClz0y9s/TvldbI1i8vbQK+1dhuYGvvbVtvYX8Y+tL9cR21+eGei5q+J+ocT6YcT/ZDgSFYUtRRuvWym9XJKCSM2Somhzm0dujJvBrciV41bq+3PpnLrtv1ZH1Zvo5qq6fzT7lU7i/m7hktTQs3VMKWdz5Vg/8VB1YOqjnUbG3X3SzvcWrbapa23LbcZOt+HaJTVPJ4jtjz9UnnrM25QZ3+7nW/GLaDTOM6N58bjwzsTqb8mMg8nEg8n+iHB99tXedmerZf2T/eVHOr1cuwl5X0OKbGN7zn2cp5YzB/lR95x6mth6uW9ipTYxpelxIfLS6kueyzvVZ0dILnebGV/d9MAzI2XlN8/f3h4Z6Lqr4m6hxOphxP9EFJirXkpD3tFSqw1L+Vhr0iJtealPOwVKbHWvJSHvSIl1pqX8rBXpMRa81Ie9oqUWGteysNekRJrzUt52CtSYq15KQ97RUqsNS/lYa9IibXmpTzsFSmx1ryUh70iJdaal/KwV6TEWvNSHvaKlFhrXsrDXpESa81LedgrUmKteSkPe0VKrDUv5WGvSIm15qU87BUpsda8lIe9IiXWmpfysFekxFrzUh72ipRYa17Kw17tISUAfBdSAkDYu1MCwK8iJQCEkRIAwkgJAGGkBIAwUgJAGCkBIIyUABBGSgAIIyUAhJESAMJICQBhpASAMFICQBgpASCMlAAQRkoACCMlAISREgDCSAkAYaQEgDBSAkAYKQEgjJQAEEZKAAgjJQCEkRIAwkgJAGGkBIAwUgJAGCkBIIyUABBGSgAIIyUAhJESAMJICQBhpASAMFICQBgpASDsf9sljhd5AS0JAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTEzVDIwOjI0OjE4KzAwOjAwJAPM5gAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0xM1QyMDoyNDoxOCswMDowMFVedFoAAAAASUVORK5CYII="></p><p>Apache HUDI physical file contains 3 parts</p><ol><li>For each record, 5 HUDI metadata fields with column indices 0 to 4</li><li>For each record, the original data columns that comprises the record (Original Data)</li><li>Additional Hudi Metadata at file footer for index lookup</li></ol><p>The parts (1) and (3) constitute what we term as  “Hudi skeleton”. Hudi skeleton contains additional metadata that it maintains in each physical parquet file for supporting Hudi primitives. The conceptual idea is to decouple Hudi skeleton data from original data (2). Hudi skeleton can be stored in a Hudi file while the original data is stored in an external non-Hudi file. A migration of large parquet would result in creating only Hudi skeleton files without having to rewrite original data.</p><p><img alt="skeleton" src="/assets/images/2020-08-20-skeleton-1d3c6260bfd7380097259276874b1322.png"></p><header><h1 class="h1Heading_27L5">Design Deep Dive:</h1></header><p> For a deep dive on the internals, please take a look at the <a href="https://cwiki.apache.org/confluence/display/HUDI/RFC+-+12+%3A+Efficient+Migration+of+Large+Parquet+Tables+to+Apache+Hudi" target="_blank" rel="noopener noreferrer">RFC document</a> </p><header><h1 class="h1Heading_27L5">Migration:</h1></header><p>Hudi supports 2 modes when migrating parquet tables.  We will use the term bootstrap and migration interchangeably in this document.  </p><ul><li>METADATA_ONLY : In this mode, record level metadata alone is generated for each source record and stored in new bootstrap location.</li><li>FULL_RECORD : In this mode, record level metadata is generated for each source record and both original record and metadata for each record copied</li></ul><p>You can pick and choose these modes at partition level. One of the common strategy would be to use FULL_RECORD mode for a small set of &quot;hot&quot; partitions which are accessed more frequently and METADATA_ONLY for a larger set of &quot;warm&quot; partitions. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="query-engine-support"></a>Query Engine Support:<a class="hash-link" href="#query-engine-support" title="Direct link to heading">#</a></h2><p>For a METADATA_ONLY bootstrapped table, Spark - data source, Spark-Hive and native Hive query engines are supported. Presto support is in the works.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ways-to-migrate-"></a>Ways To Migrate :<a class="hash-link" href="#ways-to-migrate-" title="Direct link to heading">#</a></h2><p>There are 2 ways to migrate a large parquet table to Hudi. </p><ul><li>Spark Datasource Write</li><li>Hudi DeltaStreamer</li></ul><p>We will look at how to migrate using both these approaches.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configurations"></a>Configurations:<a class="hash-link" href="#configurations" title="Direct link to heading">#</a></h2><p>These are bootstrap specific configurations that needs to be set in addition to regular hudi write configurations.</p><table><thead><tr><th>Configuration Name</th><th>Default</th><th>Mandatory ?</th><th>Description</th></tr></thead><tbody><tr><td>hoodie.bootstrap.base.path</td><td></td><td>Yes</td><td>Base Path of  source parquet table.</td></tr><tr><td>hoodie.bootstrap.parallelism</td><td>1500</td><td>Yes</td><td>Spark Parallelism used when running bootstrap</td></tr><tr><td>hoodie.bootstrap.keygen.class</td><td></td><td>Yes</td><td>Bootstrap Index internally used by Hudi to map Hudi skeleton and source parquet files.</td></tr><tr><td>hoodie.bootstrap.mode.selector</td><td>org.apache.hudi.client.bootstrap.selector.MetadataOnlyBootstrapModeSelector</td><td>Yes</td><td>Bootstap Mode Selector class. By default, Hudi employs METADATA_ONLY boostrap for all partitions.</td></tr><tr><td>hoodie.bootstrap.partitionpath.translator.class</td><td>org.apache.hudi.client.bootstrap.translator. IdentityBootstrapPartitionPathTranslator</td><td>No</td><td>For METADATA_ONLY bootstrap, this class allows customization of partition paths used in Hudi target dataset. By default, no customization is done and the partition paths reflects what is available in source parquet table.</td></tr><tr><td>hoodie.bootstrap.full.input.provider</td><td>org.apache.hudi.bootstrap.SparkParquetBootstrapDataProvider</td><td>No</td><td>For FULL_RECORD bootstrap, this class provides the input RDD of Hudi records to write.</td></tr><tr><td>hoodie.bootstrap.mode.selector.regex.mode</td><td>METADATA_ONLY</td><td>No</td><td>Bootstrap Mode used when the partition matches the regex pattern in hoodie.bootstrap.mode.selector.regex . Used only when hoodie.bootstrap.mode.selector set to BootstrapRegexModeSelector.</td></tr><tr><td>hoodie.bootstrap.mode.selector.regex</td><td>.*</td><td>No</td><td>Partition Regex used when  hoodie.bootstrap.mode.selector set to BootstrapRegexModeSelector.</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spark-data-source"></a>Spark Data Source:<a class="hash-link" href="#spark-data-source" title="Direct link to heading">#</a></h2><p>Here, we use a Spark Datasource Write to perform bootstrap.
Here is an example code snippet to perform METADATA_ONLY bootstrap.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly properties"><pre tabindex="0" class="prism-code language-properties codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.{DataSourceWriteOptions, HoodieDataSourceHelpers}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.config.{HoodieBootstrapConfig, HoodieWriteConfig}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.keygen.SimpleKeyGenerator</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.spark.sql.SaveMode</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">val bootstrapDF = spark.emptyDataFrame</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bootstrapDF.write</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .format(&quot;hudi&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieWriteConfig.TABLE_NAME, &quot;hoodie_test&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(DataSourceWriteOptions.OPERATION_OPT_KEY, DataSourceWriteOptions.BOOTSTRAP_OPERATION_OPT_VAL)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(DataSourceWriteOptions.RECORDKEY_FIELD_OPT_KEY, &quot;_row_key&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(DataSourceWriteOptions.PARTITIONPATH_FIELD_OPT_KEY, &quot;datestr&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.BOOTSTRAP_BASE_PATH_PROP, srcPath)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.BOOTSTRAP_KEYGEN_CLASS, classOf[SimpleKeyGenerator].getName)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .mode(SaveMode.Overwrite)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .save(basePath)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here is an example code snippet to perform METADATA_ONLY bootstrap for August 20 2020 - August 29 2020 partitions and FULL_RECORD bootstrap for other partitions.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly properties"><pre tabindex="0" class="prism-code language-properties codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.bootstrap.SparkParquetBootstrapDataProvider</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.client.bootstrap.selector.BootstrapRegexModeSelector</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.{DataSourceWriteOptions, HoodieDataSourceHelpers}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.config.{HoodieBootstrapConfig, HoodieWriteConfig}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.hudi.keygen.SimpleKeyGenerator</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.spark.sql.SaveMode</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">val bootstrapDF = spark.emptyDataFrame</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bootstrapDF.write</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .format(&quot;hudi&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieWriteConfig.TABLE_NAME, &quot;hoodie_test&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(DataSourceWriteOptions.OPERATION_OPT_KEY, DataSourceWriteOptions.BOOTSTRAP_OPERATION_OPT_VAL)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(DataSourceWriteOptions.RECORDKEY_FIELD_OPT_KEY, &quot;_row_key&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(DataSourceWriteOptions.PARTITIONPATH_FIELD_OPT_KEY, &quot;datestr&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(DataSourceWriteOptions.PRECOMBINE_FIELD_OPT_KEY, &quot;timestamp&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.BOOTSTRAP_BASE_PATH_PROP, srcPath)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.BOOTSTRAP_KEYGEN_CLASS, classOf[SimpleKeyGenerator].getName)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.BOOTSTRAP_MODE_SELECTOR, classOf[BootstrapRegexModeSelector].getName)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.BOOTSTRAP_MODE_SELECTOR_REGEX, &quot;2020/08/2[0-9]&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.BOOTSTRAP_MODE_SELECTOR_REGEX_MODE, &quot;METADATA_ONLY&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .option(HoodieBootstrapConfig.FULL_BOOTSTRAP_INPUT_PROVIDER, classOf[SparkParquetBootstrapDataProvider].getName)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .mode(SaveMode.Overwrite)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .save(basePath)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hoodie-deltastreamer"></a>Hoodie DeltaStreamer:<a class="hash-link" href="#hoodie-deltastreamer" title="Direct link to heading">#</a></h2><p>Hoodie Deltastreamer allows bootstrap to be performed using --run-bootstrap command line option.</p><p>If you are planning to use delta-streamer after the initial boostrap to incrementally ingest data to the new hudi dataset, you need to pass either --checkpoint or --initial-checkpoint-provider to set the initial checkpoint for the deltastreamer.</p><p>Here is an example for running METADATA_ONLY bootstrap using Delta Streamer.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly properties"><pre tabindex="0" class="prism-code language-properties codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark-submit --package org.apache.hudi:hudi-spark-bundle_2.11:0.6.0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--conf &#x27;spark.serializer=org.apache.spark.serializer.KryoSerializer&#x27; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer  \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--run-bootstrap \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--target-base-path &lt;Hudi_Base_Path&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--target-table &lt;Hudi_Table_Name&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--props &lt;props_file&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--checkpoint &lt;initial_checkpoint_if_you_are_going_to_use_deltastreamer_to_incrementally_ingest&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.base.path=&lt;Parquet_Source_base_Path&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.datasource.write.recordkey.field=_row_key \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.datasource.write.partitionpath.field=datestr \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.keygen.class=org.apache.hudi.keygen.SimpleKeyGenerator</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly properties"><pre tabindex="0" class="prism-code language-properties codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark-submit --package org.apache.hudi:hudi-spark-bundle_2.11:0.6.0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--conf &#x27;spark.serializer=org.apache.spark.serializer.KryoSerializer&#x27; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--class org.apache.hudi.utilities.deltastreamer.HoodieDeltaStreamer  \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--run-bootstrap \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--target-base-path &lt;Hudi_Base_Path&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--target-table &lt;Hudi_Table_Name&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--props &lt;props_file&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--checkpoint &lt;initial_checkpoint_if_you_are_going_to_use_deltastreamer_to_incrementally_ingest&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.base.path=&lt;Parquet_Source_base_Path&gt; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.datasource.write.recordkey.field=_row_key \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.datasource.write.partitionpath.field=datestr \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.keygen.class=org.apache.hudi.keygen.SimpleKeyGenerator \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.full.input.provider=org.apache.hudi.bootstrap.SparkParquetBootstrapDataProvider \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.mode.selector=org.apache.hudi.client.bootstrap.selector.BootstrapRegexModeSelector \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.mode.selector.regex=&quot;2020/08/2[0-9]&quot; \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hoodie-conf hoodie.bootstrap.mode.selector.regex.mode=METADATA_ONLY</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="known-caveats"></a>Known Caveats<a class="hash-link" href="#known-caveats" title="Direct link to heading">#</a></h2><ol><li>Need proper defaults for the bootstrap config : hoodie.bootstrap.full.input.provider. Here is the <a href="https://issues.apache.org/jira/browse/HUDI-1213" target="_blank" rel="noopener noreferrer">ticket</a></li><li>DeltaStreamer manages checkpoints inside hoodie commit files and expects checkpoints in previously committed metadata. Users are expected to pass checkpoint or initial checkpoint provider when performing bootstrap through deltastreamer. Such support is not present when doing bootstrap using Spark Datasource. Here is the <a href="https://issues.apache.org/jira/browse/HUDI-1214" target="_blank" rel="noopener noreferrer">ticket</a>.</li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/08/21/async-compaction-deployment-model"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Async Compaction Deployment Models</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/08/18/hudi-incremental-processing-on-data-lakes"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Incremental Processing on the Data Lake »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#per-record-metadata" class="table-of-contents__link">Per Record Metadata:</a></li><li><a href="#query-engine-support" class="table-of-contents__link">Query Engine Support:</a></li><li><a href="#ways-to-migrate-" class="table-of-contents__link">Ways To Migrate :</a></li><li><a href="#configurations" class="table-of-contents__link">Configurations:</a></li><li><a href="#spark-data-source" class="table-of-contents__link">Spark Data Source:</a></li><li><a href="#hoodie-deltastreamer" class="table-of-contents__link">Hoodie DeltaStreamer:</a></li><li><a href="#known-caveats" class="table-of-contents__link">Known Caveats</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/contribute/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/release-0.9.0">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/powered-by">Who&#x27;s Using</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docker_demo">Docker Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/talks-articles">Talks &amp; Articles</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/faq">FAQ</a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ibm_cos_hoodie">IBM Cloud</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/contribute/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="col footer__col"><div class="footer__title">Apache</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://hudi.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>. <br>Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b62330e8.js"></script>
<script src="/assets/js/main.1b4b15db.js"></script>
</body>
</html>