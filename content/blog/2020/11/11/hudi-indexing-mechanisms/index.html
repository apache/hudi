<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Hudi! Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Hudi! Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache Hudi!" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comfortaa|Ubuntu|Roboto|Source+Code+Pro">
<link rel="stylesheet" href="https://at-ui.github.io/feather-font/css/iconfont.css"><title data-react-helmet="true">Employing the right indexes for fast updates, deletes in Apache Hudi | Apache Hudi!</title><meta data-react-helmet="true" property="og:title" content="Employing the right indexes for fast updates, deletes in Apache Hudi | Apache Hudi!"><meta data-react-helmet="true" name="description" content="Apache Hudi employs an index to locate the file group, that an update/delete belongs to. For Copy-On-Write tables, this enables"><meta data-react-helmet="true" property="og:description" content="Apache Hudi employs an index to locate the file group, that an update/delete belongs to. For Copy-On-Write tables, this enables"><meta data-react-helmet="true" property="og:url" content="https://hudi.apache.org/blog/2020/11/11/hudi-indexing-mechanisms"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/assets/images/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hudi.apache.org/blog/2020/11/11/hudi-indexing-mechanisms"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2020/11/11/hudi-indexing-mechanisms" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/cn/blog/2020/11/11/hudi-indexing-mechanisms" hreflang="cn"><link data-react-helmet="true" rel="alternate" href="https://hudi.apache.org/blog/2020/11/11/hudi-indexing-mechanisms" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a6d90b24.css">
<link rel="preload" href="/assets/js/runtime~main.0f515725.js" as="script">
<link rel="preload" href="/assets/js/main.94ce3b69.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">⭐️ If you like Apache Hudi, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/hudi">GitHub</a>! ⭐</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">×</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/quick-start-guide">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Learn</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/blog">Blog</a></li><li><a class="dropdown__link" href="/talks-articles">Talks &amp; Articles</a></li><li><a href="https://cwiki.apache.org/confluence/display/HUDI/FAQ" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>FAQ<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Technical Wiki<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Contribute</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/contribute/get-involved">Get Involved</a></li><li><a class="dropdown__link" href="/contribute/team">Team</a></li><li><a class="dropdown__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/contribute/developer-setup">Developer Setup</a></li><li><a class="dropdown__link" href="/contribute/report-security-issues">Report Security Issues</a></li><li><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Report Issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a class="navbar__item navbar__link" href="/powered-by">Who&#x27;s Using</a><a class="navbar__item navbar__link" href="/releases/download">Download</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/docs/overview">0.8.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/overview">Current</a></li><li><a class="dropdown__link" href="/docs/overview">0.8.0</a></li><li><a class="dropdown__link" href="/docs/0.7.0/overview">0.7.0</a></li><li><a class="dropdown__link" href="/docs/0.6.0/quick-start-guide">0.6.0</a></li><li><a class="dropdown__link" href="/docs/0.5.3/quick-start-guide">0.5.3</a></li><li><a class="dropdown__link" href="/docs/0.5.2/quick-start-guide">0.5.2</a></li><li><a class="dropdown__link" href="/docs/0.5.1/quick-start-guide">0.5.1</a></li><li><a class="dropdown__link" href="/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2020/11/11/hudi-indexing-mechanisms" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/cn/blog/2020/11/11/hudi-indexing-mechanisms" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Chinese</a></li></ul></div><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter-link" aria-label="Hudi Twitter Handle"></a><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Hudi Slack Channel"></a><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/assets/images/hudi.png" alt="Apache Hudi" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quick-start-guide">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Learn</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/talks-articles">Talks &amp; Articles</a></li><li class="menu__list-item"><a href="https://cwiki.apache.org/confluence/display/HUDI/FAQ" target="_blank" rel="noopener noreferrer" class="menu__link"><span>FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/contribute/get-involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/team">Team</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/how-to-contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/developer-setup">Developer Setup</a></li><li class="menu__list-item"><a class="menu__link" href="/contribute/report-security-issues">Report Security Issues</a></li><li class="menu__list-item"><a href="https://issues.apache.org/jira/projects/HUDI/summary" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Report Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/powered-by">Who&#x27;s Using</a></li><li class="menu__list-item"><a class="menu__link" href="/releases/download">Download</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/overview">Current</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/overview">0.8.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.7.0/overview">0.7.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.6.0/quick-start-guide">0.6.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.3/quick-start-guide">0.5.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.2/quick-start-guide">0.5.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.1/quick-start-guide">0.5.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.5.0/quick-start-guide">0.5.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/blog/2020/11/11/hudi-indexing-mechanisms" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/blog/2020/11/11/hudi-indexing-mechanisms" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">Chinese</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li><li class="menu__list-item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="menu__link header-twitter-link" aria-label="Hudi Twitter Handle"></a></li><li class="menu__list-item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="menu__link header-slack-link" aria-label="Hudi Slack Channel"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/21/streaming-data-lake-platform">Apache Hudi - The Data Lake Platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/10/employing-right-configurations-for-hudi-cleaner">Employing correct configurations for Hudi&#x27;s cleaner table service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/03/01/hudi-file-sizing">Streaming Responsibly - How Apache Hudi maintains optimum sized files</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/13/hudi-key-generators">Apache Hudi Key Generators</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/27/hudi-clustering-intro">Optimize Data lake layout using Clustering in Apache Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/01/high-perf-data-lake-with-hudi-and-alluxio-t3go">Building High-Performance Data Lake Using Apache Hudi and Alluxio at T3Go</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2020/11/11/hudi-indexing-mechanisms">Employing the right indexes for fast updates, deletes in Apache Hudi</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/10/19/hudi-meets-aws-emr-and-aws-dms">Apply record level changes from relational databases to Amazon S3 data lake using Apache Hudi on Amazon EMR and AWS Database Migration Service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/10/15/apache-hudi-meets-apache-flink">Apache Hudi meets Apache Flink</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/10/06/cdc-solution-using-hudi-by-nclouds">How nClouds Helps Accelerate Data Delivery with Apache Hudi on Amazon EMR</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="blogPostTitle_GeHD">Employing the right indexes for fast updates, deletes in Apache Hudi</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2020-11-11T00:00:00.000Z">November 11, 2020</time> · 8 min read</div><div class="avatar margin-vert--md"><div class="avatar__intro"><div class="avatar__name"><a>vinoth</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>Apache Hudi employs an index to locate the file group, that an update/delete belongs to. For Copy-On-Write tables, this enables
fast upsert/delete operations, by avoiding the need to join against the entire dataset to determine which files to rewrite.
For Merge-On-Read tables, this design allows Hudi to bound the amount of records any given base file needs to be merged against.
Specifically, a given base file needs to merged only against updates for records that are part of that base file. In contrast,
designs without an indexing component (e.g: <a href="https://cwiki.apache.org/confluence/display/Hive/Hive+Transactions" target="_blank" rel="noopener noreferrer">Apache Hive ACID</a>),
could end up having to merge all the base files against all incoming updates/delete records.</p><p>At a high level, an index maps a record key + an optional partition path to a file group ID on storage (explained
more in detail <a href="/docs/concepts">here</a>) and during write operations, we lookup this mapping to route an incoming update/delete
to a log file attached to the base file (MOR) or to the latest base file that now needs to be merged against (COW). The index also enables
Hudi to enforce unique constraints based on the record keys.</p><p><img alt="Fact table" src="/assets/images/with-and-without-index-0ff8ca7135db449da92408fc0d0f6bda.png">
<em>Figure: Comparison of merge cost for updates (yellow blocks) against base files (white blocks)</em></p><p>Given that Hudi already supports few different indexing techniques and is also continuously improving/adding more to its toolkit, the rest of the blog
attempts to explain different categories of workloads, from our experience and suggests what index types to use for each. We will also interlace
commentary on existing limitations, upcoming work and optimizations/tradeoffs along the way. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="index-types-in-hudi"></a>Index Types in Hudi<a class="hash-link" href="#index-types-in-hudi" title="Direct link to heading">#</a></h2><p>Currently, Hudi supports the following indexing options. </p><ul><li><strong>Bloom Index (default):</strong> Employs bloom filters built out of the record keys, optionally also pruning candidate files using record key ranges.</li><li><strong>Simple Index:</strong> Performs a lean join of the incoming update/delete records against keys extracted from the table on storage.</li><li><strong>HBase Index:</strong> Manages the index mapping in an external Apache HBase table.</li></ul><p>Writers can pick one of these options using <code>hoodie.index.type</code> config option. Additionally, a custom index implementation can also be employed
using <code>hoodie.index.class</code> and supplying a subclass of <code>SparkHoodieIndex</code> (for Apache Spark writers) </p><p>Another key aspect worth understanding is the difference between global and non-global indexes. Both bloom and simple index have
global options - <code>hoodie.index.type=GLOBAL_BLOOM</code> and <code>hoodie.index.type=GLOBAL_SIMPLE</code> - respectively. HBase index is by nature a global index.</p><ul><li><p><strong>Global index:</strong>  Global indexes enforce uniqueness of keys across all partitions of a table i.e guarantees that exactly
one record exists in the table for a given record key. Global indexes offer stronger guarantees, but the update/delete cost grows
with size of the table <code>O(size of table)</code>, which might still be acceptable for smaller tables.</p></li><li><p><strong>Non Global index:</strong> On the other hand, the default index implementations enforce this constraint only within a specific partition.
As one might imagine, non global indexes depends on the writer to provide the same consistent partition path for a given record key during update/delete,
but can deliver much better performance since the index lookup operation becomes <code>O(number of records updated/deleted)</code> and
scales well with write volume.</p></li></ul><p>Since data comes in at different volumes, velocity and has different access patterns, different indices could be used for different workloads.
Next, let’s walk through some typical workloads and see how to leverage the right Hudi index for such use-cases.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="workload-late-arriving-updates-to-fact-tables"></a>Workload: Late arriving updates to fact tables<a class="hash-link" href="#workload-late-arriving-updates-to-fact-tables" title="Direct link to heading">#</a></h2><p>Many companies store large volumes of transactional data in NoSQL data stores. For eg, trip tables in case of ride-sharing, buying and selling of shares,
orders in an e-commerce site. These tables are usually ever growing with random updates on most recent data with long tail updates going to older data, either
due to transactions settling at a later date/data corrections. In other words, most updates go into the latest partitions with few updates going to older ones.</p><p><img alt="Fact table" src="/assets/images/Fact20tables-0255e82a96683124f7116060e9f76cbe.gif">
<em>Figure: Typical update pattern for Fact tables</em></p><p>For such workloads, the <code>BLOOM</code> index performs well, since index look-up will prune a lot of data files based on a well-sized bloom filter.
Additionally, if the keys can be constructed such that they have a certain ordering, the number of files to be compared is further reduced by range pruning.
Hudi constructs an interval tree with all the file key ranges and efficiently filters out the files that don&#x27;t match any key ranges in the updates/deleted records.</p><p>In order to efficiently compare incoming record keys against bloom filters i.e with minimal number of bloom filter reads and uniform distribution of work across
the executors, Hudi leverages caching of input records and employs a custom partitioner that can iron out data skews using statistics. At times, if the bloom filter
false positive ratio is high, it could increase the amount of data shuffled to perform the lookup. Hudi supports dynamic bloom filters
(enabled using <code>hoodie.bloom.index.filter.type=DYNAMIC_V0</code>), which adjusts its size based on the number of records stored in a given file to deliver the
configured false positive ratio. </p><p>In the near future, we plan to introduce a much speedier version of the BLOOM index that tracks bloom filters/ranges in an internal Hudi metadata table, indexed for fast
point lookups. This would avoid any current limitations around reading bloom filters/ranges from the base files themselves, to perform the lookup. (see
<a href="https://cwiki.apache.org/confluence/display/HUDI/RFC+-+15%3A+HUDI+File+Listing+and+Query+Planning+Improvements?src=contextnavpagetreemode" target="_blank" rel="noopener noreferrer">RFC-15</a> for the general design)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="workload-de-duplication-in-event-tables"></a>Workload: De-Duplication in event tables<a class="hash-link" href="#workload-de-duplication-in-event-tables" title="Direct link to heading">#</a></h2><p>Event Streaming is everywhere. Events coming from Apache Kafka or similar message bus are typically 10-100x the size of fact tables and often treat &quot;time&quot; (event&#x27;s arrival time/processing
time) as a first class citizen. For eg, IoT event stream, click stream data, ad impressions etc. Inserts and updates only span the last few partitions as these are mostly append only data.
Given duplicate events can be introduced anywhere in the end-end pipeline, de-duplication before storing on the data lake is a common requirement. </p><p><img alt="Event table" src="/assets/images/Event20tables-8998b57588a66cb2f5d3e9233dfb6d0f.gif">
<em>Figure showing the spread of updates for Event table.</em></p><p>In general, this is a very challenging problem to solve at lower cost. Although, we could even employ a key value store to perform this de-duplication ala HBASE index, the index storage
costs would grow linear with number of events and thus can be prohibitively expensive. In fact, <code>BLOOM</code> index with range pruning is the optimal solution here. One can leverage the fact
that time is often a first class citizen and construct a key such as <code>event_ts + event_id</code> such that the inserted records have monotonically increasing keys. This yields great returns
by pruning large amounts of files even within the latest table partitions. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="workload-random-updatesdeletes-to-a-dimension-table"></a>Workload: Random updates/deletes to a dimension table<a class="hash-link" href="#workload-random-updatesdeletes-to-a-dimension-table" title="Direct link to heading">#</a></h2><p>These types of tables usually contain high dimensional data and hold reference data e.g user profile, merchant information. These are high fidelity tables where the updates are often small but also spread
across a lot of partitions and data files ranging across the dataset from old to new. Often times, these tables are also un-partitioned, since there is also not a good way to partition these tables.</p><p><img alt="Dimensions table" src="/assets/images/Dimension20tables-6bbe96fbe9102541487b1819532f6bd4.gif">
<em>Figure showing the spread of updates for Dimensions table.</em></p><p>As discussed before, the <code>BLOOM</code> index may not yield benefits if a good number of files cannot be pruned out by comparing ranges/filters. In such a random write workload, updates end up touching
most files within in the table and thus bloom filters will typically indicate a true positive for all files based on some incoming update. Consequently, we would end up comparing ranges/filter, only
to finally check the incoming updates against all files. The <code>SIMPLE</code> Index will be a better fit as it does not do any upfront pruning based, but directly joins with interested fields from every data file.
<code>HBASE</code> index can be employed, if the operational overhead is acceptable and would provide much better lookup times for these tables. </p><p>When using a global index, users should also consider setting <code>hoodie.bloom.index.update.partition.path=true</code> or <code>hoodie.simple.index.update.partition.path=true</code> to deal with cases where the
partition path value could change due to an update e.g users table partitioned by home city; user relocates to a different city. These tables are also excellent candidates for the Merge-On-Read table type.</p><p>Going forward, we plan to build <a href="https://cwiki.apache.org/confluence/display/HUDI/RFC+-+08+%3A+Record+level+indexing+mechanisms+for+Hudi+datasets?src=contextnavpagetreemode" target="_blank" rel="noopener noreferrer">record level indexing</a>
right within Hudi, which will improve the index look-up time and will also avoid additional overhead of maintaining an external system like hbase. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>Without the indexing capabilities in Hudi, it would not been possible to make upserts/deletes happen at <a href="https://eng.uber.com/apache-hudi-graduation/" target="_blank" rel="noopener noreferrer">very large scales</a>.
Hopefully this post gave you good enough context on the indexing mechanisms today and how different tradeoffs play out. </p><p>Some interesting work underway in this area:</p><ul><li>Apache Flink based writing with a RocksDB state store backed indexing mechanism, unlocking true streaming upserts on data lakes. </li><li>A brand new MetadataIndex, which reimagines the bloom index today on top of the metadata table in Hudi.</li><li>Record level index implementation, as a secondary index using another Hudi table.</li></ul><p>Going forward, this will remain an area of active investment for the project. we are always looking for contributors who can drive these roadmap items forward.
Please <a href="/contribute/get-involved">engage</a> with our community if you want to get involved.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/12/01/high-perf-data-lake-with-hudi-and-alluxio-t3go"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Building High-Performance Data Lake Using Apache Hudi and Alluxio at T3Go</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/10/19/hudi-meets-aws-emr-and-aws-dms"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Apply record level changes from relational databases to Amazon S3 data lake using Apache Hudi on Amazon EMR and AWS Database Migration Service »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#index-types-in-hudi" class="table-of-contents__link">Index Types in Hudi</a></li><li><a href="#workload-late-arriving-updates-to-fact-tables" class="table-of-contents__link">Workload: Late arriving updates to fact tables</a></li><li><a href="#workload-de-duplication-in-event-tables" class="table-of-contents__link">Workload: De-Duplication in event tables</a></li><li><a href="#workload-random-updatesdeletes-to-a-dimension-table" class="table-of-contents__link">Workload: Random updates/deletes to a dimension table</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/streaming-data-lake-platform">Our Vision</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/concepts">Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/contribute/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/release-0.8.0">Releases</a></li><li class="footer__item"><a class="footer__link-item" href="/releases/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/powered-by">Who&#x27;s Using</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start-guide">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docker_demo">Docker Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/talks-articles">Talks &amp; Articles</a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/HUDI/FAQ" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://cwiki.apache.org/confluence/display/HUDI" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Technical Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Hudi On Cloud</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/s3_hoodie">AWS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/gcs_hoodie">Google Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/oss_hoodie">Alibaba Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/azure_hoodie">Microsoft Azure</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cos_hoodie">Tencent Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/ibm_cos_hoodie">IBM Cloud</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/contribute/get-involved">Get Involved</a></li><li class="footer__item"><a href="https://join.slack.com/t/apache-hudi/shared_invite/enQtODYyNDAxNzc5MTg2LTE5OTBlYmVhYjM0N2ZhOTJjOWM4YzBmMWU2MjZjMGE4NDc5ZDFiOGQ2N2VkYTVkNzU3ZDQ4OTI1NmFmYWQ0NzE" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/hudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/ApacheHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="mailto:dev-subscribe@hudi.apache.org?Subject=SubscribeToHudi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li></ul></div><div class="col footer__col"><div class="footer__title">Apache</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li><li class="footer__item"><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://hudi.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/assets/images/logo-big.png" alt="Apache Hudi™" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0"> Apache License, Version 2.0</a>. <br>Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0f515725.js"></script>
<script src="/assets/js/main.94ce3b69.js"></script>
</body>
</html>