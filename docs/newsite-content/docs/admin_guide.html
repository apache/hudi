<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Administering Hudi Pipelines - Apache Hudi</title>
<meta name="description" content="Admins/ops can gain visibility into Hudi datasets/pipelines in the following ways">

<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="">
<meta property="og:title" content="Administering Hudi Pipelines">
<meta property="og:url" content="https://hudi.apache.org/docs/admin_guide.html">


  <meta property="og:description" content="Admins/ops can gain visibility into Hudi datasets/pipelines in the following ways">





  <meta property="article:modified_time" content="2019-12-30T14:59:57-05:00">







<!-- end _includes/seo.html -->


<!--<link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">-->

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



<link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">
<link rel="stylesheet" href="/assets/css/font-awesome.min.css">

  </head>

  <body class="layout--single">
    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap" id="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/">
              <div style="width: 150px; height: 40px">

              </div>
<!--            <img src="/assets/images/hudi.png" alt="">-->
<!--            -->
<!--            <span class="site-subtitle" style="font-size: 0.8em !important;">-->
<!--              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Incubating-->
<!--            </span>-->
<!--            -->
          </a>
        
        <a class="site-title" href="/">
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/newsite-content/docs/quick-start-guide.html" target="_self" >Documentation</a>
            </li><li class="masthead__menu-item">
              <a href="/newsite-content/community.html" target="_self" >Community</a>
            </li><li class="masthead__menu-item">
              <a href="/newsite-content/activity.html" target="_self" >Activities</a>
            </li><li class="masthead__menu-item">
              <a href="https://cwiki.apache.org/confluence/display/HUDI/FAQ" target="_blank" >FAQ</a>
            </li><li class="masthead__menu-item">
              <a href="/newsite-content/releases.html" target="_self" >Releases</a>
            </li></ul>
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
<p class="notice--warning" style="margin: 0 !important; text-align: center !important;"><strong>Note:</strong> This site is work in progress, if you notice any issues, please <a target="_blank" href="https://issues.apache.org/jira/projects/HUDI/summary">file a jira</a>.
  Click <a href="/"> here</a> back to old site.</p>

    <div class="initial-content">
      <div id="main" role="main">
  
  <div class="sidebar sticky">

  

  
    
      
      
      
      
    


    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Getting Started</span>
        

        
        <ul>
          
            
            

            
            

            
              <li><a href="/newsite-content/docs/quick-start-guide.html" class="">Quick Start</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/use_cases.html" class="">Use Cases</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/powered_by.html" class="">Talks & Powered By</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/comparison.html" class="">Comparison</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/docker_demo.html" class="">Docker Demo</a></li>
            

          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Documentation</span>
        

        
        <ul>
          
            
            

            
            

            
              <li><a href="/newsite-content/docs/concepts.html" class="">Concepts</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/writing_data.html" class="">Writing Data</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/querying_data.html" class="">Querying Data</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/configurations.html" class="">Configuration</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/performance.html" class="">Performance</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/admin_guide.html" class="">Administering</a></li>
            

          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">INFO</span>
        

        
        <ul>
          
            
            

            
            

            
              <li><a href="/newsite-content/docs/docs-versions.html" class="">Docs Versions</a></li>
            

          
            
            

            
            

            
              <li><a href="/newsite-content/docs/privacy.html" class="">Privacy Policy</a></li>
            

          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Administering Hudi Pipelines
</h1>
        </header>
      

      <section class="page__content" itemprop="text">
        
        <aside class="sidebar__right sticky">
          <nav class="toc">
            <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> In this page</h4></header>
            <ul class="toc__menu">
  <li><a href="#admin-cli">Admin CLI</a>
    <ul>
      <li><a href="#inspecting-commits">Inspecting Commits</a></li>
      <li><a href="#drilling-down-to-a-specific-commit">Drilling Down to a specific Commit</a></li>
      <li><a href="#filesystem-view">FileSystem View</a></li>
      <li><a href="#statistics">Statistics</a></li>
      <li><a href="#archived-commits">Archived Commits</a></li>
      <li><a href="#compactions">Compactions</a></li>
      <li><a href="#validate-compaction">Validate Compaction</a></li>
      <li><a href="#unscheduling-compaction">UnScheduling Compaction</a></li>
      <li><a href="#repair-compaction">Repair Compaction</a></li>
    </ul>
  </li>
  <li><a href="#metrics">Metrics</a></li>
  <li><a href="#troubleshooting">Troubleshooting Failures</a>
    <ul>
      <li><a href="#missing-records">Missing records</a></li>
      <li><a href="#duplicates">Duplicates</a></li>
      <li><a href="#spark-ui">Spark failures</a></li>
    </ul>
  </li>
</ul>
          </nav>
        </aside>
        
        <p>Admins/ops can gain visibility into Hudi datasets/pipelines in the following ways</p>

<ul>
  <li><a href="#admin-cli">Administering via the Admin CLI</a></li>
  <li><a href="#metrics">Graphite metrics</a></li>
  <li><a href="#spark-ui">Spark UI of the Hudi Application</a></li>
</ul>

<p>This section provides a glimpse into each of these, with some general guidance on <a href="#troubleshooting">troubleshooting</a></p>

<h2 id="admin-cli">Admin CLI</h2>

<p>Once hudi has been built, the shell can be fired by via  <code class="highlighter-rouge">cd hudi-cli &amp;&amp; ./hudi-cli.sh</code>.
A hudi dataset resides on DFS, in a location referred to as the <strong>basePath</strong> and we would need this location in order to connect to a Hudi dataset.
Hudi library effectively manages this dataset internally, using .hoodie subfolder to track all metadata</p>

<p>To initialize a hudi table, use the following command.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">18</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mo">06</span> <span class="mi">15</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="n">annotation</span><span class="o">.</span><span class="na">AutowiredAnnotationBeanPostProcessor</span><span class="o">:</span> <span class="no">JSR</span><span class="o">-</span><span class="mi">330</span> <span class="err">'</span><span class="n">javax</span><span class="o">.</span><span class="na">inject</span><span class="o">.</span><span class="na">Inject</span><span class="err">'</span> <span class="n">annotation</span> <span class="n">found</span> <span class="n">and</span> <span class="n">supported</span> <span class="k">for</span> <span class="n">autowiring</span>
<span class="o">============================================</span>
<span class="o">*</span>                                          <span class="o">*</span>
<span class="o">*</span>     <span class="n">_</span>    <span class="n">_</span>           <span class="n">_</span>   <span class="n">_</span>               <span class="o">*</span>
<span class="o">*</span>    <span class="o">|</span> <span class="o">|</span>  <span class="o">|</span> <span class="o">|</span>         <span class="o">|</span> <span class="o">|</span> <span class="o">(</span><span class="n">_</span><span class="o">)</span>              <span class="o">*</span>
<span class="o">*</span>    <span class="o">|</span> <span class="o">|</span><span class="n">__</span><span class="o">|</span> <span class="o">|</span>       <span class="n">__</span><span class="o">|</span> <span class="o">|</span>  <span class="o">-</span>               <span class="o">*</span>
<span class="o">*</span>    <span class="o">|</span>  <span class="n">__</span>  <span class="o">||</span>   <span class="o">|</span> <span class="o">/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span> <span class="o">||</span>               <span class="o">*</span>
<span class="o">*</span>    <span class="o">|</span> <span class="o">|</span>  <span class="o">|</span> <span class="o">||</span>   <span class="o">||</span> <span class="o">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">||</span>               <span class="o">*</span>
<span class="o">*</span>    <span class="o">|</span><span class="n">_</span><span class="o">|</span>  <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="err">\</span><span class="n">___</span><span class="o">/</span> <span class="err">\</span><span class="n">____</span><span class="o">/</span> <span class="o">||</span>               <span class="o">*</span>
<span class="o">*</span>                                          <span class="o">*</span>
<span class="o">============================================</span>

<span class="nc">Welcome</span> <span class="n">to</span> <span class="nc">Hoodie</span> <span class="no">CLI</span><span class="o">.</span> <span class="nc">Please</span> <span class="n">type</span> <span class="n">help</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">looking</span> <span class="k">for</span> <span class="n">help</span><span class="o">.</span>
<span class="n">hudi</span><span class="o">-&gt;</span><span class="n">create</span> <span class="o">--</span><span class="n">path</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">hive</span><span class="o">/</span><span class="n">warehouse</span><span class="o">/</span><span class="n">table1</span> <span class="o">--</span><span class="n">tableName</span> <span class="n">hoodie_table_1</span> <span class="o">--</span><span class="n">tableType</span> <span class="no">COPY_ON_WRITE</span>
<span class="o">.....</span>
<span class="mi">18</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mo">06</span> <span class="mi">15</span><span class="o">:</span><span class="mi">57</span><span class="o">:</span><span class="mi">15</span> <span class="no">INFO</span> <span class="n">table</span><span class="o">.</span><span class="na">HoodieTableMetaClient</span><span class="o">:</span> <span class="nc">Finished</span> <span class="nc">Loading</span> <span class="nc">Table</span> <span class="n">of</span> <span class="n">type</span> <span class="no">COPY_ON_WRITE</span> <span class="n">from</span> <span class="o">...</span>
</code></pre></div></div>

<p>To see the description of hudi table, use the command:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">hoodie_table_1</span><span class="o">-&gt;</span><span class="n">desc</span>
<span class="mi">18</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mo">06</span> <span class="mi">15</span><span class="o">:</span><span class="mi">57</span><span class="o">:</span><span class="mi">19</span> <span class="no">INFO</span> <span class="n">timeline</span><span class="o">.</span><span class="na">HoodieActiveTimeline</span><span class="o">:</span> <span class="nc">Loaded</span> <span class="n">instants</span> <span class="o">[]</span>
    <span class="n">_________________________________________________________</span>
    <span class="o">|</span> <span class="nc">Property</span>                <span class="o">|</span> <span class="nc">Value</span>                        <span class="o">|</span>
    <span class="o">|========================================================|</span>
    <span class="o">|</span> <span class="n">basePath</span>                <span class="o">|</span> <span class="o">...</span>                          <span class="o">|</span>
    <span class="o">|</span> <span class="n">metaPath</span>                <span class="o">|</span> <span class="o">...</span>                          <span class="o">|</span>
    <span class="o">|</span> <span class="n">fileSystem</span>              <span class="o">|</span> <span class="n">hdfs</span>                         <span class="o">|</span>
    <span class="o">|</span> <span class="n">hoodie</span><span class="o">.</span><span class="na">table</span><span class="o">.</span><span class="na">name</span>       <span class="o">|</span> <span class="n">hoodie_table_1</span>               <span class="o">|</span>
    <span class="o">|</span> <span class="n">hoodie</span><span class="o">.</span><span class="na">table</span><span class="o">.</span><span class="na">type</span>       <span class="o">|</span> <span class="no">COPY_ON_WRITE</span>                <span class="o">|</span>
    <span class="o">|</span> <span class="n">hoodie</span><span class="o">.</span><span class="na">archivelog</span><span class="o">.</span><span class="na">folder</span><span class="o">|</span>                              <span class="o">|</span>
</code></pre></div></div>

<p>Following is a sample command to connect to a Hudi dataset contains uber trips.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">connect</span> <span class="o">--</span><span class="n">path</span> <span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">uber</span><span class="o">/</span><span class="n">trips</span>

<span class="mi">16</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mo">05</span> <span class="mi">23</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">37</span> <span class="no">INFO</span> <span class="n">model</span><span class="o">.</span><span class="na">HoodieTableMetadata</span><span class="o">:</span> <span class="nc">Attempting</span> <span class="n">to</span> <span class="n">load</span> <span class="n">the</span> <span class="n">commits</span> <span class="n">under</span> <span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">uber</span><span class="o">/</span><span class="n">trips</span><span class="o">/.</span><span class="na">hoodie</span> <span class="n">with</span> <span class="n">suffix</span> <span class="o">.</span><span class="na">commit</span>
<span class="mi">16</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mo">05</span> <span class="mi">23</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">37</span> <span class="no">INFO</span> <span class="n">model</span><span class="o">.</span><span class="na">HoodieTableMetadata</span><span class="o">:</span> <span class="nc">Attempting</span> <span class="n">to</span> <span class="n">load</span> <span class="n">the</span> <span class="n">commits</span> <span class="n">under</span> <span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">uber</span><span class="o">/</span><span class="n">trips</span><span class="o">/.</span><span class="na">hoodie</span> <span class="n">with</span> <span class="n">suffix</span> <span class="o">.</span><span class="na">inflight</span>
<span class="mi">16</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mo">05</span> <span class="mi">23</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">37</span> <span class="no">INFO</span> <span class="n">model</span><span class="o">.</span><span class="na">HoodieTableMetadata</span><span class="o">:</span> <span class="nc">All</span> <span class="n">commits</span> <span class="o">:</span><span class="nc">HoodieCommits</span><span class="o">{</span><span class="n">commitList</span><span class="o">=[</span><span class="mi">20161002045850</span><span class="o">,</span> <span class="mi">20161002052915</span><span class="o">,</span> <span class="mi">20161002055918</span><span class="o">,</span> <span class="mi">20161002065317</span><span class="o">,</span> <span class="mi">20161002075932</span><span class="o">,</span> <span class="mi">20161002082904</span><span class="o">,</span> <span class="mi">20161002085949</span><span class="o">,</span> <span class="mi">20161002092936</span><span class="o">,</span> <span class="mi">20161002105903</span><span class="o">,</span> <span class="mi">20161002112938</span><span class="o">,</span> <span class="mi">20161002123005</span><span class="o">,</span> <span class="mi">20161002133002</span><span class="o">,</span> <span class="mi">20161002155940</span><span class="o">,</span> <span class="mi">20161002165924</span><span class="o">,</span> <span class="mi">20161002172907</span><span class="o">,</span> <span class="mi">20161002175905</span><span class="o">,</span> <span class="mi">20161002190016</span><span class="o">,</span> <span class="mi">20161002192954</span><span class="o">,</span> <span class="mi">20161002195925</span><span class="o">,</span> <span class="mi">20161002205935</span><span class="o">,</span> <span class="mi">20161002215928</span><span class="o">,</span> <span class="mi">20161002222938</span><span class="o">,</span> <span class="mi">20161002225915</span><span class="o">,</span> <span class="mi">20161002232906</span><span class="o">,</span> <span class="mi">20161003003028</span><span class="o">,</span> <span class="mi">20161003005958</span><span class="o">,</span> <span class="mi">20161003012936</span><span class="o">,</span> <span class="mi">20161003022924</span><span class="o">,</span> <span class="mi">20161003025859</span><span class="o">,</span> <span class="mi">20161003032854</span><span class="o">,</span> <span class="mi">20161003042930</span><span class="o">,</span> <span class="mi">20161003052911</span><span class="o">,</span> <span class="mi">20161003055907</span><span class="o">,</span> <span class="mi">20161003062946</span><span class="o">,</span> <span class="mi">20161003065927</span><span class="o">,</span> <span class="mi">20161003075924</span><span class="o">,</span> <span class="mi">20161003082926</span><span class="o">,</span> <span class="mi">20161003085925</span><span class="o">,</span> <span class="mi">20161003092909</span><span class="o">,</span> <span class="mi">20161003100010</span><span class="o">,</span> <span class="mi">20161003102913</span><span class="o">,</span> <span class="mi">20161003105850</span><span class="o">,</span> <span class="mi">20161003112910</span><span class="o">,</span> <span class="mi">20161003115851</span><span class="o">,</span> <span class="mi">20161003122929</span><span class="o">,</span> <span class="mi">20161003132931</span><span class="o">,</span> <span class="mi">20161003142952</span><span class="o">,</span> <span class="mi">20161003145856</span><span class="o">,</span> <span class="mi">20161003152953</span><span class="o">,</span> <span class="mi">20161003155912</span><span class="o">,</span> <span class="mi">20161003162922</span><span class="o">,</span> <span class="mi">20161003165852</span><span class="o">,</span> <span class="mi">20161003172923</span><span class="o">,</span> <span class="mi">20161003175923</span><span class="o">,</span> <span class="mi">20161003195931</span><span class="o">,</span> <span class="mi">20161003210118</span><span class="o">,</span> <span class="mi">20161003212919</span><span class="o">,</span> <span class="mi">20161003215928</span><span class="o">,</span> <span class="mi">20161003223000</span><span class="o">,</span> <span class="mi">20161003225858</span><span class="o">,</span> <span class="mi">20161004003042</span><span class="o">,</span> <span class="mi">20161004011345</span><span class="o">,</span> <span class="mi">20161004015235</span><span class="o">,</span> <span class="mi">20161004022234</span><span class="o">,</span> <span class="mi">20161004063001</span><span class="o">,</span> <span class="mi">20161004072402</span><span class="o">,</span> <span class="mi">20161004074436</span><span class="o">,</span> <span class="mi">20161004080224</span><span class="o">,</span> <span class="mi">20161004082928</span><span class="o">,</span> <span class="mi">20161004085857</span><span class="o">,</span> <span class="mi">20161004105922</span><span class="o">,</span> <span class="mi">20161004122927</span><span class="o">,</span> <span class="mi">20161004142929</span><span class="o">,</span> <span class="mi">20161004163026</span><span class="o">,</span> <span class="mi">20161004175925</span><span class="o">,</span> <span class="mi">20161004194411</span><span class="o">,</span> <span class="mi">20161004203202</span><span class="o">,</span> <span class="mi">20161004211210</span><span class="o">,</span> <span class="mi">20161004214115</span><span class="o">,</span> <span class="mi">20161004220437</span><span class="o">,</span> <span class="mi">20161004223020</span><span class="o">,</span> <span class="mi">20161004225321</span><span class="o">,</span> <span class="mi">20161004231431</span><span class="o">,</span> <span class="mi">20161004233643</span><span class="o">,</span> <span class="mi">20161005010227</span><span class="o">,</span> <span class="mi">20161005015927</span><span class="o">,</span> <span class="mi">20161005022911</span><span class="o">,</span> <span class="mi">20161005032958</span><span class="o">,</span> <span class="mi">20161005035939</span><span class="o">,</span> <span class="mi">20161005052904</span><span class="o">,</span> <span class="mi">20161005070028</span><span class="o">,</span> <span class="mi">20161005074429</span><span class="o">,</span> <span class="mi">20161005081318</span><span class="o">,</span> <span class="mi">20161005083455</span><span class="o">,</span> <span class="mi">20161005085921</span><span class="o">,</span> <span class="mi">20161005092901</span><span class="o">,</span> <span class="mi">20161005095936</span><span class="o">,</span> <span class="mi">20161005120158</span><span class="o">,</span> <span class="mi">20161005123418</span><span class="o">,</span> <span class="mi">20161005125911</span><span class="o">,</span> <span class="mi">20161005133107</span><span class="o">,</span> <span class="mi">20161005155908</span><span class="o">,</span> <span class="mi">20161005163517</span><span class="o">,</span> <span class="mi">20161005165855</span><span class="o">,</span> <span class="mi">20161005180127</span><span class="o">,</span> <span class="mi">20161005184226</span><span class="o">,</span> <span class="mi">20161005191051</span><span class="o">,</span> <span class="mi">20161005193234</span><span class="o">,</span> <span class="mi">20161005203112</span><span class="o">,</span> <span class="mi">20161005205920</span><span class="o">,</span> <span class="mi">20161005212949</span><span class="o">,</span> <span class="mi">20161005223034</span><span class="o">,</span> <span class="mi">20161005225920</span><span class="o">]}</span>
<span class="nc">Metadata</span> <span class="k">for</span> <span class="n">table</span> <span class="n">trips</span> <span class="n">loaded</span>
<span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span>
</code></pre></div></div>

<p>Once connected to the dataset, a lot of other commands become available. The shell has contextual autocomplete help (press TAB) and below is a list of all commands, few of which are reviewed in this section
are reviewed</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">help</span>
<span class="o">*</span> <span class="o">!</span> <span class="o">-</span> <span class="nc">Allows</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">operating</span> <span class="nf">system</span> <span class="o">(</span><span class="no">OS</span><span class="o">)</span> <span class="n">commands</span>
<span class="o">*</span> <span class="c1">// - Inline comment markers (start of line only)</span>
<span class="o">*</span> <span class="o">;</span> <span class="o">-</span> <span class="nc">Inline</span> <span class="n">comment</span> <span class="nf">markers</span> <span class="o">(</span><span class="n">start</span> <span class="n">of</span> <span class="n">line</span> <span class="n">only</span><span class="o">)</span>
<span class="o">*</span> <span class="n">addpartitionmeta</span> <span class="o">-</span> <span class="nc">Add</span> <span class="n">partition</span> <span class="n">metadata</span> <span class="n">to</span> <span class="n">a</span> <span class="n">dataset</span><span class="o">,</span> <span class="k">if</span> <span class="n">not</span> <span class="n">present</span>
<span class="o">*</span> <span class="n">clear</span> <span class="o">-</span> <span class="nc">Clears</span> <span class="n">the</span> <span class="n">console</span>
<span class="o">*</span> <span class="n">cls</span> <span class="o">-</span> <span class="nc">Clears</span> <span class="n">the</span> <span class="n">console</span>
<span class="o">*</span> <span class="n">commit</span> <span class="n">rollback</span> <span class="o">-</span> <span class="nc">Rollback</span> <span class="n">a</span> <span class="n">commit</span>
<span class="o">*</span> <span class="n">commits</span> <span class="n">compare</span> <span class="o">-</span> <span class="nc">Compare</span> <span class="n">commits</span> <span class="n">with</span> <span class="n">another</span> <span class="nc">Hoodie</span> <span class="n">dataset</span>
<span class="o">*</span> <span class="n">commit</span> <span class="n">showfiles</span> <span class="o">-</span> <span class="nc">Show</span> <span class="n">file</span> <span class="n">level</span> <span class="n">details</span> <span class="n">of</span> <span class="n">a</span> <span class="n">commit</span>
<span class="o">*</span> <span class="n">commit</span> <span class="n">showpartitions</span> <span class="o">-</span> <span class="nc">Show</span> <span class="n">partition</span> <span class="n">level</span> <span class="n">details</span> <span class="n">of</span> <span class="n">a</span> <span class="n">commit</span>
<span class="o">*</span> <span class="n">commits</span> <span class="n">refresh</span> <span class="o">-</span> <span class="nc">Refresh</span> <span class="n">the</span> <span class="n">commits</span>
<span class="o">*</span> <span class="n">commits</span> <span class="n">show</span> <span class="o">-</span> <span class="nc">Show</span> <span class="n">the</span> <span class="n">commits</span>
<span class="o">*</span> <span class="n">commits</span> <span class="n">sync</span> <span class="o">-</span> <span class="nc">Compare</span> <span class="n">commits</span> <span class="n">with</span> <span class="n">another</span> <span class="nc">Hoodie</span> <span class="n">dataset</span>
<span class="o">*</span> <span class="n">connect</span> <span class="o">-</span> <span class="nc">Connect</span> <span class="n">to</span> <span class="n">a</span> <span class="n">hoodie</span> <span class="n">dataset</span>
<span class="o">*</span> <span class="n">date</span> <span class="o">-</span> <span class="nc">Displays</span> <span class="n">the</span> <span class="n">local</span> <span class="n">date</span> <span class="n">and</span> <span class="n">time</span>
<span class="o">*</span> <span class="n">exit</span> <span class="o">-</span> <span class="nc">Exits</span> <span class="n">the</span> <span class="n">shell</span>
<span class="o">*</span> <span class="n">help</span> <span class="o">-</span> <span class="nc">List</span> <span class="n">all</span> <span class="n">commands</span> <span class="n">usage</span>
<span class="o">*</span> <span class="n">quit</span> <span class="o">-</span> <span class="nc">Exits</span> <span class="n">the</span> <span class="n">shell</span>
<span class="o">*</span> <span class="n">records</span> <span class="n">deduplicate</span> <span class="o">-</span> <span class="nc">De</span><span class="o">-</span><span class="n">duplicate</span> <span class="n">a</span> <span class="n">partition</span> <span class="n">path</span> <span class="n">contains</span> <span class="n">duplicates</span> <span class="o">&amp;</span> <span class="n">produce</span> <span class="n">repaired</span> <span class="n">files</span> <span class="n">to</span> <span class="n">replace</span> <span class="n">with</span>
<span class="o">*</span> <span class="n">script</span> <span class="o">-</span> <span class="nc">Parses</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">resource</span> <span class="n">file</span> <span class="n">and</span> <span class="n">executes</span> <span class="n">its</span> <span class="n">commands</span>
<span class="o">*</span> <span class="n">stats</span> <span class="n">filesizes</span> <span class="o">-</span> <span class="nc">File</span> <span class="nc">Sizes</span><span class="o">.</span> <span class="nc">Display</span> <span class="n">summary</span> <span class="n">stats</span> <span class="n">on</span> <span class="n">sizes</span> <span class="n">of</span> <span class="n">files</span>
<span class="o">*</span> <span class="n">stats</span> <span class="n">wa</span> <span class="o">-</span> <span class="nc">Write</span> <span class="nc">Amplification</span><span class="o">.</span> <span class="nc">Ratio</span> <span class="n">of</span> <span class="n">how</span> <span class="n">many</span> <span class="n">records</span> <span class="n">were</span> <span class="n">upserted</span> <span class="n">to</span> <span class="n">how</span> <span class="n">many</span> <span class="n">records</span> <span class="n">were</span> <span class="n">actually</span> <span class="n">written</span>
<span class="o">*</span> <span class="n">sync</span> <span class="n">validate</span> <span class="o">-</span> <span class="nc">Validate</span> <span class="n">the</span> <span class="n">sync</span> <span class="n">by</span> <span class="n">counting</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">records</span>
<span class="o">*</span> <span class="n">system</span> <span class="n">properties</span> <span class="o">-</span> <span class="nc">Shows</span> <span class="n">the</span> <span class="n">shell</span><span class="err">'</span><span class="n">s</span> <span class="n">properties</span>
<span class="o">*</span> <span class="n">utils</span> <span class="n">loadClass</span> <span class="o">-</span> <span class="nc">Load</span> <span class="n">a</span> <span class="kd">class</span>
<span class="err">*</span> <span class="nc">version</span> <span class="o">-</span> <span class="nc">Displays</span> <span class="n">shell</span> <span class="n">version</span>

<span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span>
</code></pre></div></div>

<h3 id="inspecting-commits">Inspecting Commits</h3>

<p>The task of upserting or inserting a batch of incoming records is known as a <strong>commit</strong> in Hudi. A commit provides basic atomicity guarantees such that only commited data is available for querying.
Each commit has a monotonically increasing string/number called the <strong>commit number</strong>. Typically, this is the time at which we started the commit.</p>

<p>To view some basic information about the last 10 commits,</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">commits</span> <span class="n">show</span> <span class="o">--</span><span class="n">sortBy</span> <span class="s">"Total Bytes Written"</span> <span class="o">--</span><span class="n">desc</span> <span class="kc">true</span> <span class="o">--</span><span class="n">limit</span> <span class="mi">10</span>
    <span class="n">________________________________________________________________________________________________________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">CommitTime</span>    <span class="o">|</span> <span class="nc">Total</span> <span class="nc">Bytes</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Files</span> <span class="nc">Added</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Files</span> <span class="nc">Updated</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Partitions</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Records</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Update</span> <span class="nc">Records</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Errors</span><span class="o">|</span>
    <span class="o">|=======================================================================================================================================================================|</span>
    <span class="o">....</span>
    <span class="o">....</span>
    <span class="o">....</span>
<span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span>
</code></pre></div></div>

<p>At the start of each write, Hudi also writes a .inflight commit to the .hoodie folder. You can use the timestamp there to estimate how long the commit has been inflight</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">hdfs</span> <span class="n">dfs</span> <span class="o">-</span><span class="n">ls</span> <span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">uber</span><span class="o">/</span><span class="n">trips</span><span class="o">/.</span><span class="na">hoodie</span><span class="o">/*.</span><span class="na">inflight</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">vinoth</span> <span class="n">supergroup</span>     <span class="mi">321984</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">05</span> <span class="mi">23</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">uber</span><span class="o">/</span><span class="n">trips</span><span class="o">/.</span><span class="na">hoodie</span><span class="o">/</span><span class="mi">20161005225920</span><span class="o">.</span><span class="na">inflight</span>
</code></pre></div></div>

<h3 id="drilling-down-to-a-specific-commit">Drilling Down to a specific Commit</h3>

<p>To understand how the writes spread across specific partiions,</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">commit</span> <span class="n">showpartitions</span> <span class="o">--</span><span class="n">commit</span> <span class="mi">20161005165855</span> <span class="o">--</span><span class="n">sortBy</span> <span class="s">"Total Bytes Written"</span> <span class="o">--</span><span class="n">desc</span> <span class="kc">true</span> <span class="o">--</span><span class="n">limit</span> <span class="mi">10</span>
    <span class="n">__________________________________________________________________________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">Partition</span> <span class="nc">Path</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Files</span> <span class="nc">Added</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Files</span> <span class="nc">Updated</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Records</span> <span class="nc">Inserted</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Records</span> <span class="nc">Updated</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Bytes</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Errors</span><span class="o">|</span>
    <span class="o">|=========================================================================================================================================|</span>
     <span class="o">....</span>
     <span class="o">....</span>
</code></pre></div></div>

<p>If you need file level granularity , we can do the following</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">commit</span> <span class="n">showfiles</span> <span class="o">--</span><span class="n">commit</span> <span class="mi">20161005165855</span> <span class="o">--</span><span class="n">sortBy</span> <span class="s">"Partition Path"</span>
    <span class="n">________________________________________________________________________________________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">Partition</span> <span class="nc">Path</span><span class="o">|</span> <span class="nc">File</span> <span class="no">ID</span>                             <span class="o">|</span> <span class="nc">Previous</span> <span class="nc">Commit</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Records</span> <span class="nc">Updated</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Records</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Bytes</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Errors</span><span class="o">|</span>
    <span class="o">|=======================================================================================================================================================|</span>
    <span class="o">....</span>
    <span class="o">....</span>
</code></pre></div></div>

<h3 id="filesystem-view">FileSystem View</h3>

<p>Hudi views each partition as a collection of file-groups with each file-group containing a list of file-slices in commit
order (See Concepts). The below commands allow users to view the file-slices for a data-set.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nl">hoodie:</span><span class="n">stock_ticks_mor</span><span class="o">-&gt;</span><span class="n">show</span> <span class="n">fsview</span> <span class="n">all</span>
 <span class="o">....</span>
  <span class="n">_______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________</span>
 <span class="o">|</span> <span class="nc">Partition</span> <span class="o">|</span> <span class="nc">FileId</span> <span class="o">|</span> <span class="nc">Base</span><span class="o">-</span><span class="nc">Instant</span> <span class="o">|</span> <span class="nc">Data</span><span class="o">-</span><span class="nc">File</span> <span class="o">|</span> <span class="nc">Data</span><span class="o">-</span><span class="nc">File</span> <span class="nc">Size</span><span class="o">|</span> <span class="nc">Num</span> <span class="nc">Delta</span> <span class="nc">Files</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Delta</span> <span class="nc">File</span> <span class="nc">Size</span><span class="o">|</span> <span class="nc">Delta</span> <span class="nc">Files</span> <span class="o">|</span>
 <span class="o">|==============================================================================================================================================================================================================================================================================================================================================================================================================|</span>
 <span class="o">|</span> <span class="mi">2018</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">31</span><span class="o">|</span> <span class="mi">111415</span><span class="n">c3</span><span class="o">-</span><span class="n">f26d</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">86</span><span class="n">c8</span><span class="o">-</span><span class="n">f9956f245ac3</span><span class="o">|</span> <span class="mi">20181002180759</span><span class="o">|</span> <span class="nl">hdfs:</span><span class="c1">//namenode:8020/user/hive/warehouse/stock_ticks_mor/2018/08/31/111415c3-f26d-4639-86c8-f9956f245ac3_0_20181002180759.parquet| 432.5 KB | 1 | 20.8 KB | [HoodieLogFile {hdfs://namenode:8020/user/hive/warehouse/stock_ticks_mor/2018/08/31/.111415c3-f26d-4639-86c8-f9956f245ac3_20181002180759.log.1}]|</span>



 <span class="nl">hoodie:</span><span class="n">stock_ticks_mor</span><span class="o">-&gt;</span><span class="n">show</span> <span class="n">fsview</span> <span class="n">latest</span> <span class="o">--</span><span class="n">partitionPath</span> <span class="s">"2018/08/31"</span>
 <span class="o">......</span>
 <span class="n">__________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________</span>
 <span class="o">|</span> <span class="nc">Partition</span> <span class="o">|</span> <span class="nc">FileId</span> <span class="o">|</span> <span class="nc">Base</span><span class="o">-</span><span class="nc">Instant</span> <span class="o">|</span> <span class="nc">Data</span><span class="o">-</span><span class="nc">File</span> <span class="o">|</span> <span class="nc">Data</span><span class="o">-</span><span class="nc">File</span> <span class="nc">Size</span><span class="o">|</span> <span class="nc">Num</span> <span class="nc">Delta</span> <span class="nc">Files</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Delta</span> <span class="nc">Size</span><span class="o">|</span> <span class="nc">Delta</span> <span class="nc">Size</span> <span class="o">-</span> <span class="n">compaction</span> <span class="n">scheduled</span><span class="o">|</span> <span class="nc">Delta</span> <span class="nc">Size</span> <span class="o">-</span> <span class="n">compaction</span> <span class="n">unscheduled</span><span class="o">|</span> <span class="nc">Delta</span> <span class="nc">To</span> <span class="nc">Base</span> <span class="nc">Ratio</span> <span class="o">-</span> <span class="n">compaction</span> <span class="n">scheduled</span><span class="o">|</span> <span class="nc">Delta</span> <span class="nc">To</span> <span class="nc">Base</span> <span class="nc">Ratio</span> <span class="o">-</span> <span class="n">compaction</span> <span class="n">unscheduled</span><span class="o">|</span> <span class="nc">Delta</span> <span class="nc">Files</span> <span class="o">-</span> <span class="n">compaction</span> <span class="n">scheduled</span> <span class="o">|</span> <span class="nc">Delta</span> <span class="nc">Files</span> <span class="o">-</span> <span class="n">compaction</span> <span class="n">unscheduled</span><span class="o">|</span>
 <span class="o">|=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================|</span>
 <span class="o">|</span> <span class="mi">2018</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">31</span><span class="o">|</span> <span class="mi">111415</span><span class="n">c3</span><span class="o">-</span><span class="n">f26d</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">86</span><span class="n">c8</span><span class="o">-</span><span class="n">f9956f245ac3</span><span class="o">|</span> <span class="mi">20181002180759</span><span class="o">|</span> <span class="nl">hdfs:</span><span class="c1">//namenode:8020/user/hive/warehouse/stock_ticks_mor/2018/08/31/111415c3-f26d-4639-86c8-f9956f245ac3_0_20181002180759.parquet| 432.5 KB | 1 | 20.8 KB | 20.8 KB | 0.0 B | 0.0 B | 0.0 B | [HoodieLogFile {hdfs://namenode:8020/user/hive/warehouse/stock_ticks_mor/2018/08/31/.111415c3-f26d-4639-86c8-f9956f245ac3_20181002180759.log.1}]| [] |</span>

 <span class="nl">hoodie:</span><span class="n">stock_ticks_mor</span><span class="o">-&gt;</span>
</code></pre></div></div>

<h3 id="statistics">Statistics</h3>

<p>Since Hudi directly manages file sizes for DFS dataset, it might be good to get an overall picture</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">stats</span> <span class="n">filesizes</span> <span class="o">--</span><span class="n">partitionPath</span> <span class="mi">2016</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mo">01</span> <span class="o">--</span><span class="n">sortBy</span> <span class="s">"95th"</span> <span class="o">--</span><span class="n">desc</span> <span class="kc">true</span> <span class="o">--</span><span class="n">limit</span> <span class="mi">10</span>
    <span class="n">________________________________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">CommitTime</span>    <span class="o">|</span> <span class="nc">Min</span>     <span class="o">|</span> <span class="mi">10</span><span class="n">th</span>    <span class="o">|</span> <span class="mi">50</span><span class="n">th</span>    <span class="o">|</span> <span class="n">avg</span>     <span class="o">|</span> <span class="mi">95</span><span class="n">th</span>    <span class="o">|</span> <span class="nc">Max</span>     <span class="o">|</span> <span class="nc">NumFiles</span><span class="o">|</span> <span class="nc">StdDev</span>  <span class="o">|</span>
    <span class="o">|===============================================================================================|</span>
    <span class="o">|</span> <span class="o">&lt;</span><span class="no">COMMIT_ID</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="mf">93.9</span> <span class="no">MB</span> <span class="o">|</span> <span class="mf">93.9</span> <span class="no">MB</span> <span class="o">|</span> <span class="mf">93.9</span> <span class="no">MB</span> <span class="o">|</span> <span class="mf">93.9</span> <span class="no">MB</span> <span class="o">|</span> <span class="mf">93.9</span> <span class="no">MB</span> <span class="o">|</span> <span class="mf">93.9</span> <span class="no">MB</span> <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="mf">2.3</span> <span class="no">KB</span>  <span class="o">|</span>
    <span class="o">....</span>
    <span class="o">....</span>
</code></pre></div></div>

<p>In case of Hudi write taking much longer, it might be good to see the write amplification for any sudden increases</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">stats</span> <span class="n">wa</span>
    <span class="n">__________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">CommitTime</span>    <span class="o">|</span> <span class="nc">Total</span> <span class="nc">Upserted</span><span class="o">|</span> <span class="nc">Total</span> <span class="nc">Written</span><span class="o">|</span> <span class="nc">Write</span> <span class="nc">Amplifiation</span> <span class="nc">Factor</span><span class="o">|</span>
    <span class="o">|=========================================================================|</span>
    <span class="o">....</span>
    <span class="o">....</span>
</code></pre></div></div>

<h3 id="archived-commits">Archived Commits</h3>

<p>In order to limit the amount of growth of .commit files on DFS, Hudi archives older .commit files (with due respect to the cleaner policy) into a commits.archived file.
This is a sequence file that contains a mapping from commitNumber =&gt; json with raw information about the commit (same that is nicely rolled up above).</p>

<h3 id="compactions">Compactions</h3>

<p>To get an idea of the lag between compaction and writer applications, use the below command to list down all
pending compactions.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">compactions</span> <span class="n">show</span> <span class="n">all</span>
     <span class="n">___________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">Compaction</span> <span class="nc">Instant</span> <span class="nc">Time</span><span class="o">|</span> <span class="nc">State</span>    <span class="o">|</span> <span class="nc">Total</span> <span class="nc">FileIds</span> <span class="n">to</span> <span class="n">be</span> <span class="nc">Compacted</span><span class="o">|</span>
    <span class="o">|==================================================================|</span>
    <span class="o">|</span> <span class="o">&lt;</span><span class="no">INSTANT_1</span><span class="o">&gt;</span>            <span class="o">|</span> <span class="no">REQUESTED</span><span class="o">|</span> <span class="mi">35</span>                           <span class="o">|</span>
    <span class="o">|</span> <span class="o">&lt;</span><span class="no">INSTANT_2</span><span class="o">&gt;</span>            <span class="o">|</span> <span class="no">INFLIGHT</span> <span class="o">|</span> <span class="mi">27</span>                           <span class="o">|</span>
</code></pre></div></div>

<p>To inspect a specific compaction plan, use</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">compaction</span> <span class="n">show</span> <span class="o">--</span><span class="n">instant</span> <span class="o">&lt;</span><span class="no">INSTANT_1</span><span class="o">&gt;</span>
    <span class="n">_________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">Partition</span> <span class="nc">Path</span><span class="o">|</span> <span class="nc">File</span> <span class="nc">Id</span> <span class="o">|</span> <span class="nc">Base</span> <span class="nc">Instant</span>  <span class="o">|</span> <span class="nc">Data</span> <span class="nc">File</span> <span class="nc">Path</span>                                    <span class="o">|</span> <span class="nc">Total</span> <span class="nc">Delta</span> <span class="nc">Files</span><span class="o">|</span> <span class="n">getMetrics</span>                                                                                                                    <span class="o">|</span>
    <span class="o">|================================================================================================================================================================================================================================================</span>
    <span class="o">|</span> <span class="mi">2018</span><span class="o">/</span><span class="mo">07</span><span class="o">/</span><span class="mi">17</span>    <span class="o">|</span> <span class="o">&lt;</span><span class="no">UUID</span><span class="o">&gt;</span>  <span class="o">|</span> <span class="o">&lt;</span><span class="no">INSTANT_1</span><span class="o">&gt;</span>   <span class="o">|</span> <span class="nl">viewfs:</span><span class="c1">//ns-default/.../../UUID_&lt;INSTANT&gt;.parquet | 1                | {TOTAL_LOG_FILES=1.0, TOTAL_IO_READ_MB=1230.0, TOTAL_LOG_FILES_SIZE=2.51255751E8, TOTAL_IO_WRITE_MB=991.0, TOTAL_IO_MB=2221.0}|</span>

</code></pre></div></div>

<p>To manually schedule or run a compaction, use the below command. This command uses spark launcher to perform compaction
operations.</p>

<p class="notice--info"><strong>NOTE:</strong> Make sure no other application is scheduling compaction for this dataset concurrently</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">help</span> <span class="n">compaction</span> <span class="n">schedule</span>
<span class="nl">Keyword:</span>                   <span class="n">compaction</span> <span class="n">schedule</span>
<span class="nl">Description:</span>               <span class="nc">Schedule</span> <span class="nc">Compaction</span>
 <span class="nl">Keyword:</span>                  <span class="n">sparkMemory</span>
   <span class="nl">Help:</span>                   <span class="nc">Spark</span> <span class="n">executor</span> <span class="n">memory</span>
   <span class="nl">Mandatory:</span>              <span class="kc">false</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">specified:</span>   <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">unspecified:</span> <span class="err">'</span><span class="mi">1</span><span class="no">G</span><span class="err">'</span>

<span class="o">*</span> <span class="n">compaction</span> <span class="n">schedule</span> <span class="o">-</span> <span class="nc">Schedule</span> <span class="nc">Compaction</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">help</span> <span class="n">compaction</span> <span class="n">run</span>
<span class="nl">Keyword:</span>                   <span class="n">compaction</span> <span class="n">run</span>
<span class="nl">Description:</span>               <span class="nc">Run</span> <span class="nc">Compaction</span> <span class="k">for</span> <span class="n">given</span> <span class="n">instant</span> <span class="n">time</span>
 <span class="nl">Keyword:</span>                  <span class="n">tableName</span>
   <span class="nl">Help:</span>                   <span class="nc">Table</span> <span class="n">name</span>
   <span class="nl">Mandatory:</span>              <span class="kc">true</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">specified:</span>   <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">unspecified:</span> <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>

 <span class="nl">Keyword:</span>                  <span class="n">parallelism</span>
   <span class="nl">Help:</span>                   <span class="nc">Parallelism</span> <span class="k">for</span> <span class="n">hoodie</span> <span class="n">compaction</span>
   <span class="nl">Mandatory:</span>              <span class="kc">true</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">specified:</span>   <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">unspecified:</span> <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>

 <span class="nl">Keyword:</span>                  <span class="n">schemaFilePath</span>
   <span class="nl">Help:</span>                   <span class="nc">Path</span> <span class="k">for</span> <span class="nc">Avro</span> <span class="n">schema</span> <span class="n">file</span>
   <span class="nl">Mandatory:</span>              <span class="kc">true</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">specified:</span>   <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">unspecified:</span> <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>

 <span class="nl">Keyword:</span>                  <span class="n">sparkMemory</span>
   <span class="nl">Help:</span>                   <span class="nc">Spark</span> <span class="n">executor</span> <span class="n">memory</span>
   <span class="nl">Mandatory:</span>              <span class="kc">true</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">specified:</span>   <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">unspecified:</span> <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>

 <span class="nl">Keyword:</span>                  <span class="n">retry</span>
   <span class="nl">Help:</span>                   <span class="nc">Number</span> <span class="n">of</span> <span class="n">retries</span>
   <span class="nl">Mandatory:</span>              <span class="kc">true</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">specified:</span>   <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">unspecified:</span> <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>

 <span class="nl">Keyword:</span>                  <span class="n">compactionInstant</span>
   <span class="nl">Help:</span>                   <span class="nc">Base</span> <span class="n">path</span> <span class="k">for</span> <span class="n">the</span> <span class="n">target</span> <span class="n">hoodie</span> <span class="n">dataset</span>
   <span class="nl">Mandatory:</span>              <span class="kc">true</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">specified:</span>   <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>
   <span class="nc">Default</span> <span class="k">if</span> <span class="nl">unspecified:</span> <span class="err">'</span><span class="n">__NULL__</span><span class="err">'</span>

<span class="o">*</span> <span class="n">compaction</span> <span class="n">run</span> <span class="o">-</span> <span class="nc">Run</span> <span class="nc">Compaction</span> <span class="k">for</span> <span class="n">given</span> <span class="n">instant</span> <span class="n">time</span>
</code></pre></div></div>

<h3 id="validate-compaction">Validate Compaction</h3>

<p>Validating a compaction plan : Check if all the files necessary for compactions are present and are valid</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">stock_ticks_mor</span><span class="o">-&gt;</span><span class="n">compaction</span> <span class="n">validate</span> <span class="o">--</span><span class="n">instant</span> <span class="mi">20181005222611</span>
<span class="o">...</span>

   <span class="no">COMPACTION</span> <span class="no">PLAN</span> <span class="no">VALID</span>

    <span class="n">___________________________________________________________________________________________________________________________________________________________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">File</span> <span class="nc">Id</span>                             <span class="o">|</span> <span class="nc">Base</span> <span class="nc">Instant</span> <span class="nc">Time</span><span class="o">|</span> <span class="nc">Base</span> <span class="nc">Data</span> <span class="nc">File</span>                                                                                                                   <span class="o">|</span> <span class="nc">Num</span> <span class="nc">Delta</span> <span class="nc">Files</span><span class="o">|</span> <span class="nc">Valid</span><span class="o">|</span> <span class="nc">Error</span><span class="o">|</span>
    <span class="o">|==========================================================================================================================================================================================================================|</span>
    <span class="o">|</span> <span class="mo">05320</span><span class="n">e98</span><span class="o">-</span><span class="mi">9</span><span class="n">a57</span><span class="o">-</span><span class="mi">4</span><span class="n">c38</span><span class="o">-</span><span class="n">b809</span><span class="o">-</span><span class="n">a6beaaeb36bd</span><span class="o">|</span> <span class="mi">20181005222445</span>   <span class="o">|</span> <span class="nl">hdfs:</span><span class="c1">//namenode:8020/user/hive/warehouse/stock_ticks_mor/2018/08/31/05320e98-9a57-4c38-b809-a6beaaeb36bd_0_20181005222445.parquet| 1              | true |      |</span>



<span class="nl">hoodie:</span><span class="n">stock_ticks_mor</span><span class="o">-&gt;</span><span class="n">compaction</span> <span class="n">validate</span> <span class="o">--</span><span class="n">instant</span> <span class="mi">20181005222601</span>

   <span class="no">COMPACTION</span> <span class="no">PLAN</span> <span class="no">INVALID</span>

    <span class="n">_______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________</span>
    <span class="o">|</span> <span class="nc">File</span> <span class="nc">Id</span>                             <span class="o">|</span> <span class="nc">Base</span> <span class="nc">Instant</span> <span class="nc">Time</span><span class="o">|</span> <span class="nc">Base</span> <span class="nc">Data</span> <span class="nc">File</span>                                                                                                                   <span class="o">|</span> <span class="nc">Num</span> <span class="nc">Delta</span> <span class="nc">Files</span><span class="o">|</span> <span class="nc">Valid</span><span class="o">|</span> <span class="nc">Error</span>                                                                           <span class="o">|</span>
    <span class="o">|=====================================================================================================================================================================================================================================================================================================|</span>
    <span class="o">|</span> <span class="mo">05320</span><span class="n">e98</span><span class="o">-</span><span class="mi">9</span><span class="n">a57</span><span class="o">-</span><span class="mi">4</span><span class="n">c38</span><span class="o">-</span><span class="n">b809</span><span class="o">-</span><span class="n">a6beaaeb36bd</span><span class="o">|</span> <span class="mi">20181005222445</span>   <span class="o">|</span> <span class="nl">hdfs:</span><span class="c1">//namenode:8020/user/hive/warehouse/stock_ticks_mor/2018/08/31/05320e98-9a57-4c38-b809-a6beaaeb36bd_0_20181005222445.parquet| 1              | false| All log files specified in compaction operation is not present. Missing ....    |</span>
</code></pre></div></div>

<p class="notice--warning"><strong>NOTE:</strong> The following commands must be executed without any other writer/ingestion application running.</p>

<p>Sometimes, it becomes necessary to remove a fileId from a compaction-plan inorder to speed-up or unblock compaction
operation. Any new log-files that happened on this file after the compaction got scheduled will be safely renamed
so that are preserved. Hudi provides the following CLI to support it</p>

<h3 id="unscheduling-compaction">UnScheduling Compaction</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">compaction</span> <span class="n">unscheduleFileId</span> <span class="o">--</span><span class="n">fileId</span> <span class="o">&lt;</span><span class="nc">FileUUID</span><span class="o">&gt;</span>
<span class="o">....</span>
<span class="nc">No</span> <span class="nc">File</span> <span class="n">renames</span> <span class="n">needed</span> <span class="n">to</span> <span class="n">unschedule</span> <span class="n">file</span> <span class="n">from</span> <span class="n">pending</span> <span class="n">compaction</span><span class="o">.</span> <span class="nc">Operation</span> <span class="n">successful</span><span class="o">.</span>
</code></pre></div></div>

<p>In other cases, an entire compaction plan needs to be reverted. This is supported by the following CLI</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">trips</span><span class="o">-&gt;</span><span class="n">compaction</span> <span class="n">unschedule</span> <span class="o">--</span><span class="n">compactionInstant</span> <span class="o">&lt;</span><span class="n">compactionInstant</span><span class="o">&gt;</span>
<span class="o">.....</span>
<span class="nc">No</span> <span class="nc">File</span> <span class="n">renames</span> <span class="n">needed</span> <span class="n">to</span> <span class="n">unschedule</span> <span class="n">pending</span> <span class="n">compaction</span><span class="o">.</span> <span class="nc">Operation</span> <span class="n">successful</span><span class="o">.</span>
</code></pre></div></div>

<h3 id="repair-compaction">Repair Compaction</h3>

<p>The above compaction unscheduling operations could sometimes fail partially (e:g -&gt; DFS temporarily unavailable). With
partial failures, the compaction operation could become inconsistent with the state of file-slices. When you run
<code class="highlighter-rouge">compaction validate</code>, you can notice invalid compaction operations if there is one.  In these cases, the repair
command comes to the rescue, it will rearrange the file-slices so that there is no loss and the file-slices are
consistent with the compaction plan</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">hoodie:</span><span class="n">stock_ticks_mor</span><span class="o">-&gt;</span><span class="n">compaction</span> <span class="n">repair</span> <span class="o">--</span><span class="n">instant</span> <span class="mi">20181005222611</span>
<span class="o">......</span>
<span class="nc">Compaction</span> <span class="n">successfully</span> <span class="n">repaired</span>
<span class="o">.....</span>
</code></pre></div></div>

<h2 id="metrics">Metrics</h2>

<p>Once the Hudi Client is configured with the right datasetname and environment for metrics, it produces the following graphite metrics, that aid in debugging hudi datasets</p>

<ul>
  <li><strong>Commit Duration</strong> - This is amount of time it took to successfully commit a batch of records</li>
  <li><strong>Rollback Duration</strong> - Similarly, amount of time taken to undo partial data left over by a failed commit (happens everytime automatically after a failing write)</li>
  <li><strong>File Level metrics</strong> - Shows the amount of new files added, versions, deleted (cleaned) in each commit</li>
  <li><strong>Record Level Metrics</strong> - Total records inserted/updated etc per commit</li>
  <li><strong>Partition Level metrics</strong> - number of partitions upserted (super useful to understand sudden spikes in commit duration)</li>
</ul>

<p>These metrics can then be plotted on a standard tool like grafana. Below is a sample commit duration chart.</p>

<figure>
    <img class="docimage" src="/assets/images/hudi_commit_duration.png" alt="hudi_commit_duration.png" style="max-width: 100%" />
</figure>

<h2 id="troubleshooting">Troubleshooting Failures</h2>

<p>Section below generally aids in debugging Hudi failures. Off the bat, the following metadata is added to every record to help triage  issues easily using standard Hadoop SQL engines (Hive/Presto/Spark)</p>

<ul>
  <li><strong>_hoodie_record_key</strong> - Treated as a primary key within each DFS partition, basis of all updates/inserts</li>
  <li><strong>_hoodie_commit_time</strong> - Last commit that touched this record</li>
  <li><strong>_hoodie_file_name</strong> - Actual file name containing the record (super useful to triage duplicates)</li>
  <li><strong>_hoodie_partition_path</strong> - Path from basePath that identifies the partition containing this record</li>
</ul>

<p class="notice--info"><strong>NOTE:</strong> As of now, Hudi assumes the application passes in the same deterministic partitionpath for a given recordKey. i.e the uniqueness of record key is only enforced within each partition.</p>

<h3 id="missing-records">Missing records</h3>

<p>Please check if there were any write errors using the admin commands above, during the window at which the record could have been written.
If you do find errors, then the record was not actually written by Hudi, but handed back to the application to decide what to do with it.</p>

<h3 id="duplicates">Duplicates</h3>

<p>First of all, please confirm if you do indeed have duplicates <strong>AFTER</strong> ensuring the query is accessing the Hudi datasets <a href="sql_queries.html">properly</a> .</p>

<ul>
  <li>If confirmed, please use the metadata fields above, to identify the physical files &amp; partition files containing the records .</li>
  <li>If duplicates span files across partitionpath, then this means your application is generating different partitionPaths for same recordKey, Please fix your app</li>
  <li>if duplicates span multiple files within the same partitionpath, please engage with mailing list. This should not happen. You can use the <code class="highlighter-rouge">records deduplicate</code> command to fix your data.</li>
</ul>

<h3 id="spark-ui">Spark failures</h3>

<p>Typical upsert() DAG looks like below. Note that Hudi client also caches intermediate RDDs to intelligently profile workload and size files and spark parallelism.
Also Spark UI shows sortByKey twice due to the probe job also being shown, nonetheless its just a single sort.</p>

<figure>
    <img class="docimage" src="/assets/images/hudi_upsert_dag.png" alt="hudi_upsert_dag.png" style="max-width: 100%" />
</figure>

<p>At a high level, there are two steps</p>

<p><strong>Index Lookup to identify files to be changed</strong></p>

<ul>
  <li>Job 1 : Triggers the input data read, converts to HoodieRecord object and then stops at obtaining a spread of input records to target partition paths</li>
  <li>Job 2 : Load the set of file names which we need check against</li>
  <li>Job 3  &amp; 4 : Actual lookup after smart sizing of spark join parallelism, by joining RDDs in 1 &amp; 2 above</li>
  <li>Job 5 : Have a tagged RDD of recordKeys with locations</li>
</ul>

<p><strong>Performing the actual writing of data</strong></p>

<ul>
  <li>Job 6 : Lazy join of incoming records against recordKey, location to provide a final set of HoodieRecord which now contain the information about which file/partitionpath they are found at (or null if insert). Then also profile the workload again to determine sizing of files</li>
  <li>Job 7 : Actual writing of data (update + insert + insert turned to updates to maintain file size)</li>
</ul>

<p>Depending on the exception source (Hudi/Spark), the above knowledge of the DAG can be used to pinpoint the actual issue. The most often encountered failures result from YARN/DFS temporary failures.
In the future, a more sophisticated debug/management UI would be added to the project, that can help automate some of this debugging.</p>

      </section>

      <a href="#masthead__inner-wrap" class="back-to-top">Back to top &uarr;</a>


      

    </div>

  </article>

</div>

    </div>

    <div class="page__footer">
      <footer>
        
<div class="row">
  <div class="col-lg-12 footer">
    <p>
      <a class="footer-link-img" href="https://apache.org">
        <img width="250px" src="/assets/images/asf_logo.svg" alt="The Apache Software Foundation">
      </a>
    </p>
    <p>
      Copyright &copy; <span id="copyright-year">2019</span> <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
      Hudi, Apache and the Apache feather logo are trademarks of The Apache Software Foundation. <a href="/docs/privacy">Privacy Policy</a>
      <br>
      Apache Hudi is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the <a href="http://incubator.apache.org/">Apache Incubator</a>.
      Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have
      stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a
      reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
    </p>
  </div>
</div>
      </footer>
    </div>

    
<script src="/assets/js/main.min.js"></script>


  </body>
</html>